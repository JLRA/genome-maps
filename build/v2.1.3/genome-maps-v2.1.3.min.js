function Event(a){this._sender=a;this._listeners=[]}Event.prototype={addEventListener:function(a){return this._listeners.push(a)-1},removeEventListener:function(a){this._listeners.splice(a,1)},attach:function(a){this._listeners.push(a)},notify:function(a){for(var b=0;b<this._listeners.length;b++)this._listeners[b](this._sender,a)}};
var SVG={create:function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a),d;for(d in b)c.setAttribute(d,b[d]);return c},addChild:function(a,b,c,d){var b=document.createElementNS("http://www.w3.org/2000/svg",b),e;for(e in c)b.setAttribute(e,c[e]);return this._insert(a,b,d)},addChildImage:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","image"),e;for(e in b)"xlink:href"==e&&d.setAttributeNS("http://www.w3.org/1999/xlink","href",b[e]),d.setAttribute(e,b[e]);
return this._insert(a,d,c)},_insert:function(a,b,c){if(null==c)a.appendChild(b);else{var d=c+1;0==c&&(d=0);(c=a.childNodes[d])?a.insertBefore(b,c):a.appendChild(b)}return b},init:function(a,b){return this.addChild(a,"svg",b)}},Normalizer=new function(){this.normalizeArray=function(a){return this.standardizeArray(this.normal(a))};this.normal=function(a){var b=this._getMean(a),c=this._getStdDeviation(a);this._getMaxAndMin(a);for(var d=[],e=0;e<a.length;e++)0!=c?d.push((a[e]-b)/c):d.push(a[e]);return d};
this.standardizeArray=function(a){for(var b=this._getMaxAndMin(a),c=b[0],b=b[1],c=0>=c?Math.abs(c):-1*c,d=[],e=0;e<a.length;e++)0!=b+c?d.push((a[e]+c)/(b+c)):d.push(a[e]+c);return d};this._getMean=function(a){for(var b=0,c=0;c<a.length;c++)b+=parseFloat(a[c]);return b/a.length};this._getStdDeviation=function(a){for(var b=this._getMean(a),c=0,d=0;d<a.length;d++)c+=Math.pow(parseFloat(a[d])-b,2);return Math.sqrt(c/a.length)};this._getMaxAndMin=function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,
d=0;d<a.length;d++)a[d]<b&&(b=parseFloat(a[d])),a[d]>c&&(c=parseFloat(a[d]));return[b,c]}},Colors=new function(){function a(){var b=0,c=0,d=0,e=0,f=0,g=0;this.SetRGB=function(a,h,k){b=a/255;c=h/255;d=k/255;a=Math.max(Math.max(b,c),d);h=Math.min(Math.min(b,c),d);g=a;f=0;0!=a&&(f=1-h/a);e=0;h!=a&&(h=a-h,e=b==a?(c-d)/h:c==a?2+(d-b)/h:4+(b-c)/h,e*=60,0>e&&(e+=360))};this.Red=function(){return Math.round(255*b)};this.Green=function(){return Math.round(255*c)};this.Blue=function(){return Math.round(255*
d)};this.SetHSV=function(a,h,k){e=a;f=h;g=k;d=c=b=g;if(!(0==g||0==f)){var h=e/60,a=Math.floor(h),l=h-a,h=g*(1-f),k=g*(1-f*l),l=g*(1-f*(1-l));switch(a){case 0:b=g;c=l;d=h;break;case 1:b=k;c=g;d=h;break;case 2:b=h;c=g;d=l;break;case 3:b=h;c=k;d=g;break;case 4:b=l;c=h;d=g;break;default:b=g,c=h,d=k}}};this.Hue=function(){return e};this.Saturation=function(){return f};this.Value=function(){return g};this.SetHexString=function(a){if(null==a||"string"!=typeof a)this.SetRGB(0,0,0);else if("#"==a.substr(0,
1)&&(a=a.substr(1)),6!=a.length)this.SetRGB(0,0,0);else{var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),a=parseInt(a.substr(4,2),16);isNaN(b)||isNaN(c)||isNaN(a)?this.SetRGB(0,0,0):this.SetRGB(b,c,a)}};this.HexString=function(){var a=this.Red().toString(16);1==a.length&&(a="0"+a);var b=this.Green().toString(16);1==b.length&&(b="0"+b);var c=this.Blue().toString(16);1==c.length&&(c="0"+c);return("#"+a+b+c).toUpperCase()};this.Complement=function(){var b=180<=e?e-180:e+180,c=g*(f-1)+1,
d=g*f/c,l=new a;l.SetHSV(b,d,c);return l}}this.hashColor=[];this.getColorByScoreArrayValue=function(a){for(var c=[],d=0;d<a.length;d++){var e=this.getColorByScoreValue(a[d]);c.push(e)}return c};this.getHexStringByScoreArrayValue=function(a){for(var a=this.getColorByScoreArrayValue(a),c=[],d=0;d<a.length;d++)c.push(a[d].HexString());return c};this.getColorByScoreValue=function(a){var c=a.toString().substr(0,4);if(null!=this.hashColor[c])return this.hashColor[c];if(isNaN(a))return Colors.ColorFromRGB(0,
0,0);var d,e,f;0.5>a?(e=Colors.ColorFromRGB(0,0,255),f=Colors.ColorFromRGB(255,255,255),d=2*a):(e=Colors.ColorFromRGB(255,255,255),f=Colors.ColorFromRGB(255,0,0),d=2*a-1);a=d;d=1-d;e=Colors.ColorFromRGB(d*e.Red()+a*f.Red(),d*e.Green()+a*f.Green(),d*e.Blue()+a*f.Blue());return this.hashColor[c]=e};this.ColorFromHSV=function(b,c,d){var e=new a;e.SetHSV(b,c,d);return e};this.ColorFromRGB=function(b,c,d){var e=new a;e.SetRGB(b,c,d);return e};this.ColorFromHex=function(b){var c=new a;c.SetHexString(b);
return c}};
function HeaderWidget(a){var b=this;this.id="HeaderWidget"+Math.round(1E7*Math.random());this.targetId=null;this.height=67;this.args={};this.args.appname="My new App";this.args.description="My app description";this.args.suiteId=-1;if(null!=a&&(null!=a.appname&&(this.args.appname=a.appname),null!=a.description&&(this.args.description=a.description),null!=a.suiteId))this.args.suiteId=a.suiteId;this.adapter=new WumAdapter;this.onLogin=new Event;this.onLogout=new Event;this.loginWidget=new LoginWidget(this.args.suiteId);this.userBarWidget=
new UserBarWidget;this.editUserWidget=new EditUserWidget;this.uploadWidget=new UploadWidget({suiteId:this.args.suiteId});this.projectManager=new ManageProjectsWidget({width:800,height:500,suiteId:this.args.suiteId});this.loginWidget.onSessionInitiated.addEventListener(function(){b.btnLogout.disable();b.sessionInitiated();b.onLogin.notify()});this.userBarWidget.onItemsReady.addEventListener(function(){b.responseItemsReady()});this.projectManager.onRefreshProjectList.addEventListener(function(a,d){b.userBarWidget.createProjectMenuItems(d)});
this.adapter.onLogout.addEventListener(function(){$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"});b.sessionFinished();b.onLogout.notify()})}HeaderWidget.prototype.responseItemsReady=function(){for(var a=0;a<this.userBarWidget.items.length;a++)this.userbar.insert(this.userbarInsertPos+a,this.userBarWidget.items[a]);this.btnLogout.enable()};
HeaderWidget.prototype.sessionInitiated=function(){this.loginWidget.clean();this.btnSignin.hide();this._enableMenubarItems();this.userBarWidget.draw(this.userbar);this.btnLogout.show();this.btnEdit.show()};HeaderWidget.prototype.sessionFinished=function(){this._disableMenubarItems();this.userBarWidget.clean(this.userbar);this.btnLogout.hide();this.btnEdit.hide();this.btnSignin.show()};HeaderWidget.prototype.draw=function(){this.render();null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished()};
HeaderWidget.prototype.render=function(){var a=this;if(null==this.panel){this.species=Ext.create("Ext.toolbar.TextItem",{id:this.id+"speciesTextItem",text:""});this.assembly=Ext.create("Ext.toolbar.TextItem",{id:this.id+"assemblyTextItem",text:""});switch(this.args.suiteId){case 11:this.homeLink="http://renato.bioinfo.cipf.es";this.helpLink="http://bioinfo.cipf.es/docs/renato/";this.tutorialLink="http://bioinfo.cipf.es/docs/renato/tutorial";this.aboutText="";break;case 6:this.homeLink="http://variant.bioinfo.cipf.es";
this.helpLink="http://docs.bioinfo.cipf.es/projects/variant";this.tutorialLink="http://docs.bioinfo.cipf.es/projects/variant/wiki/Tutorial";this.aboutText="";break;case 9:this.homeLink="http://www.genomemaps.org";this.helpLink="http://docs.bioinfo.cipf.es/projects/genomemaps";this.tutorialLink="http://docs.bioinfo.cipf.es/projects/genomemaps/wiki/Tutorial";this.aboutText='Genome Maps is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers. We\u2019ve focused on providing the best user experience possible with a modern drag navigation and many features included.<br><br>Genome Maps project has been developed in the <b>Computational Biology Unit</b> led by <b>Ignacio Medina</b>, at <b>Computational Genomic Institute</b> led by <b>Joaquin Dopazo</b> at CIPF. Two people from my lab deserve special mention for their fantastic job done: <br><b>Franscisco Salavert</b> and <b>Alejandro de Maria</b>.<br><br>Genome Maps has been designed to be easily be embedded in any project with a couple of lines of code, and it has been implemented as a plugin framework to extend the standard features.<br><br>Supported browsers include: Google Chrome 14+, Apple Safari 5+, Opera 12+ and Mozilla Firefox 14+ (works slower than in the other browsers). Internet Explorer 10 is under RC and seems to work properly.<br><br>For more information or suggestions about Genome Maps please contact <br><b>Ignacio Medina</b>:  <span class="info">imedina@cipf.es</span>';
break;case 10:this.homeLink="http://www.cellbrowser.org";this.tutorialLink=this.helpLink="http://docs.bioinfo.cipf.es";this.aboutText="";break;case 12:this.homeLink="http://bioinfo.cipf.es/apps/untbgen";this.tutorialLink=this.helpLink="http://bioinfo.cipf.es/ecolopy/";this.aboutText="";break;default:this.tutorialLink=this.helpLink=this.homeLink="http://docs.bioinfo.cipf.es",this.aboutText=""}this.linkbar=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"linkbarToolbar",dock:"top",cls:"bio-linkbar",
height:40,minHeight:40,maxHeight:40,items:[{id:this.id+"appTextItem",xtype:"tbtext",text:'<span class="appName">'+this.args.appname+'</span> <span id="'+this.id+'description" class="appDesc">'+this.args.description+"</span>",padding:"0 0 0 10"},this.species,this.assembly,"->",{id:this.id+"homeButton",text:"home",handler:function(){window.location.href=a.homeLink}},{id:this.id+"helpButton",text:"help",handler:function(){window.open(a.helpLink)}},{id:this.id+"tutorialButton",text:"tutorial",handler:function(){window.open(a.tutorialLink)}},
{id:this.id+"aboutButton",text:"about",handler:function(){Ext.create("Ext.window.Window",{id:a.id+"aboutWindow",bodyStyle:"background:#fff; color:#333;",bodyPadding:10,title:"About",height:340,width:500,modal:!0,layout:"fit",html:a.aboutText}).show()}}]});this.userbar=new Ext.create("Ext.toolbar.Toolbar",{id:this.userBarId,dock:"top",border:!0,cls:"bio-userbar",height:27,minHeight:27,maxHeight:27});this.userbar.add("->");this.userbarInsertPos=this.userbar.items.items.length;this.btnSignin=Ext.create("Ext.Button",
{id:this.id+"btnSignin",text:'<span class="emph">sign in</span>',scope:this,listeners:{scope:this,click:function(){this.loginWidget.draw()}}});this.btnEdit=Ext.create("Ext.Button",{id:this.id+"btnEdit",text:'<span class="emph">edit</span>',scope:this,listeners:{scope:this,click:function(){this.editUserWidget.draw()}}});this.btnLogout=Ext.create("Ext.Button",{id:this.id+"btnLogout",text:'<span class="emph">logout</span>',scope:this,listeners:{scope:this,click:function(){this.adapter.logout($.cookie("bioinfo_sid"))}}});
this.userbar.add(this.btnEdit);this.userbar.add(this.btnLogout);this.userbar.add(this.btnSignin);this.linkbar.add(this._getMenubarItems());this.panel=Ext.create("Ext.panel.Panel",{id:this.id+"panel",region:"north",border:!1,renderTo:this.targetId,height:this.height,minHeight:this.height,maxHeigth:this.height});this.panel.add(this.userbar);this.panel.add(this.linkbar)}};HeaderWidget.prototype.getPanel=function(){this.draw();return this.panel};
HeaderWidget.prototype._getMenubarItems=function(){var a=this;this.btnUpload=Ext.create("Ext.Button",{id:this.id+"btnUpload",text:"Upload data",iconCls:"icon-upload",disabled:!0,listeners:{scope:this,click:function(){this.uploadWidget.draw()}}});this.manageProjectsButton=Ext.create("Ext.Button",{id:this.id+"manageProjectsButton",text:"Projects",iconCls:"icon-project-manager",disabled:!0,handler:function(){a.projectManager.draw()}});return[this.manageProjectsButton,this.btnUpload]};
HeaderWidget.prototype._enableMenubarItems=function(){this.btnUpload.enable();this.manageProjectsButton.enable()};HeaderWidget.prototype._disableMenubarItems=function(){this.btnUpload.disable();this.manageProjectsButton.disable()};HeaderWidget.prototype.setDescription=function(a){$("#"+this.id+"description").text(a)};HeaderWidget.prototype.setWidth=function(a){this.width=a;this.getPanel().setWidth(a);this.getPanel().updateLayout()};
function UserListWidget(a){this.id="UserListWidget_"+Math.round(1E7*Math.random());this.data=[];this.args={};this.timeout=4E3;this.pagedViewList=a.pagedViewList;this.suiteId=-1;if(null!=a&&(null!=a.timeout&&4E3<a.timeout&&(this.timeout=a.timeout),null!=a.suiteId))this.suiteId=a.suiteId}UserListWidget.prototype.draw=function(){var a=this;this.getResponse();this.interval=setInterval(function(){a.getResponse()},this.timeout)};UserListWidget.prototype.getData=function(){return this.data};
UserListWidget.prototype.getCount=function(){return this.data.length};UserListWidget.prototype.getResponse=function(){throw"abstract method must be implemented in child classes";};UserListWidget.prototype.render=function(){throw"abstract method must be implemented in child classes";};JobListWidget.prototype.draw=UserListWidget.prototype.draw;JobListWidget.prototype.getData=UserListWidget.prototype.getData;JobListWidget.prototype.getCount=UserListWidget.prototype.getCount;
function JobListWidget(a){UserListWidget.prototype.constructor.call(this,a);this.counter=null;var b=this;this.pagedViewList.storeFields="commandLine creationTime description diskUsage finishTime inputData jobId message name outputData ownerId percentage projectId toolName visites".split(" ");this.pagedViewList.template='<tpl for=".">,<div class="joblist-item">,<p style="color:<tpl if="visites == 0">green</tpl><tpl if="visites &gt; 0">blue</tpl><tpl if="visites == -1">red</tpl><tpl if="visites == -2">Darkorange</tpl>">{name}</p>,<p style="color: #15428B"><i>{creationTime}</i></p>,<p style="color:steelblue"><i>- {toolName} -</i></p>,<p style="color:grey"><i>,<tpl if="visites == -1">,<div style="height:10px;width:{percentage/100*180}px;background:url(\'http://jsapi.bioinfo.cipf.es/ext/sencha/4.0.2/resources/themes/images/default/progress/progress-default-bg.gif\') repeat-x;">,&#160;</div>{percentage}%,</tpl>,<tpl if="visites == -2">waiting in the queue...</tpl>,<i></p>,</div>,</tpl>'.split(",");
if(null!=a.pagedViewList&&(null!=a.pagedViewList.storeFields&&(this.pagedViewList.storeFields=a.pagedViewList.storeFields),null!=a.pagedViewList.template))this.pagedViewList.template=a.pagedViewList.template;this.pagedListViewWidget=new PagedViewListWidget(this.pagedViewList);this.btnAllId=this.id+"_btnAll";this.btnActivePrjId=this.id+"_btnActivePrj";this.btnFinishedId=this.id+"_btnFinished";this.btnVisitedId=this.id+"_btnVisited";this.btnRunningId=this.id+"_btnRunning";this.btnQueuedId=this.id+"_btnQueued";
this.projectFilterButton=Ext.create("Ext.button.Button",{id:this.btnActivePrjId,iconCls:"icon-project-all",tooltip:"Toggle jobs from all projects or active project",enableToggle:!0,pressed:!1,listeners:{toggle:function(){b.selectProjectData();b.render()}}});this.bar=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"jobsFilterBar",style:"border : 0",dock:"top",items:[this.projectFilterButton,{id:this.btnAllId,text:" ",tooltip:"Total jobs"},{id:this.btnFinishedId,text:" ",tooltip:"Finished jobs"},{id:this.btnVisitedId,
text:" ",tooltip:"Visited jobs"},{id:this.btnRunningId,text:" ",tooltip:"Running jobs"},{id:this.btnQueuedId,text:" ",tooltip:"Queued jobs"}]});Ext.getCmp(this.btnAllId).on("click",this.filter,this);Ext.getCmp(this.btnFinishedId).on("click",this.filter,this);Ext.getCmp(this.btnVisitedId).on("click",this.filter,this);Ext.getCmp(this.btnRunningId).on("click",this.filter,this);Ext.getCmp(this.btnQueuedId).on("click",this.filter,this);this.allData=[];this.adapter=new WumAdapter;this.adapter.onListProject.addEventListener(function(a,
d){b.allData=JSON.parse(d);b.selectProjectData();b.render()})}JobListWidget.prototype.clean=function(){clearInterval(this.interval);!0==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).removeDocked(this.bar,!1);this.pagedListViewWidget.clean()};JobListWidget.prototype.getResponse=function(){this.adapter.listProject($.cookie("bioinfo_sid"),this.suiteId)};
JobListWidget.prototype.render=function(){this.pagedListViewWidget.draw(this.getData());!1==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).addDocked(this.bar);var a=this.getJobCounter();0==a.all?Ext.getCmp(this.btnAllId).hide():Ext.getCmp(this.btnAllId).show();0==a.finished?Ext.getCmp(this.btnFinishedId).hide():Ext.getCmp(this.btnFinishedId).show();0==a.visited?Ext.getCmp(this.btnVisitedId).hide():Ext.getCmp(this.btnVisitedId).show();
0==a.running?Ext.getCmp(this.btnRunningId).hide():Ext.getCmp(this.btnRunningId).show();0==a.queued?Ext.getCmp(this.btnQueuedId).hide():Ext.getCmp(this.btnQueuedId).show();Ext.getCmp(this.btnAllId).setText('<b style="color:black;font-size: 1.3em;">'+a.all+"</b>");Ext.getCmp(this.btnFinishedId).setText('<b style="color:green;font-size: 1.3em;">'+a.finished+"</b>");Ext.getCmp(this.btnVisitedId).setText('<b style="color:blue;font-size: 1.3em;">'+a.visited+"</b>");Ext.getCmp(this.btnRunningId).setText('<b style="color:red;font-size: 1.3em;">'+
a.running+"</b>");Ext.getCmp(this.btnQueuedId).setText('<b style="color:Darkorange;font-size: 1.3em;">'+a.queued+"</b>")};JobListWidget.prototype.getJobCounter=function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.getData().length;e++)0<this.getData()[e].visites?b++:(0==this.getData()[e].visites&&a++,-1==this.getData()[e].visites&&c++,-2==this.getData()[e].visites&&d++);return{all:this.getData().length,visited:b,finished:a,running:c,queued:d}};
JobListWidget.prototype.filter=function(a){switch(a.id){case this.btnFinishedId:this.pagedListViewWidget.setFilter(function(a){return 0==a.data.visites});break;case this.btnVisitedId:this.pagedListViewWidget.setFilter(function(a){return 0<a.data.visites});break;case this.btnRunningId:this.pagedListViewWidget.setFilter(function(a){return-1==a.data.visites});break;case this.btnQueuedId:this.pagedListViewWidget.setFilter(function(a){return-2==a.data.visites});break;default:this.pagedListViewWidget.setFilter(function(){return!0})}this.pagedListViewWidget.draw(this.getData())};
JobListWidget.prototype.selectProjectData=function(){if(this.projectFilterButton.pressed){for(var a=[],b=0;b<this.allData.length;b++)if(null!=this.allData[b].jobs)for(var c=0;c<this.allData[b].jobs.length;c++)a.push(this.allData[b].jobs[c]);this.data=a}else for(var b=0;b<this.allData.length;b++)if(this.allData[b].active){this.data=this.allData[b].jobs;break}null==this.data&&(this.data=[]);this.pagedListViewWidget.draw(this.getData())};DataListWidget.prototype.draw=UserListWidget.prototype.draw;
DataListWidget.prototype.getData=UserListWidget.prototype.getData;DataListWidget.prototype.getCount=UserListWidget.prototype.getCount;
function DataListWidget(a){UserListWidget.prototype.constructor.call(this,a);var b=this;this.pagedViewList.storeFields="commandLine creationTime dataFiles dataId date description diskUsage enabled finishTime jobId message multiple name organization ownerId percentage projectId responsible status statusMessage suiteId tags toolName visites write".split(" ");this.pagedViewList.template='<tpl for=".">;<div class="joblist-item">;<p><span>{name}</span><i style="color:green"> ({status}) </i></p>;<tpl for="dataFiles">;<p><i style="color:grey">{filename}</i><span style="color:blue"> {diskUsage}kB</span></p>;</tpl>;<tpl for="tags">;<span style="color:limegreen"> {.},</span>;</tpl>;<p><i>{creationTime}</i></p>;</div>;</tpl>'.split(";");
if(null!=a.pagedViewList&&(null!=a.pagedViewList.storeFields&&(this.pagedViewList.storeFields=a.pagedViewList.storeFields),null!=a.pagedViewList.template))this.pagedViewList.template=a.pagedViewList.template;this.pagedListViewWidget=new PagedViewListWidget(this.pagedViewList);this.adapter=new WumAdapter;this.adapter.onGetData.addEventListener(function(a,d){var e=null;try{e=JSON.parse(d)}catch(f){console.log("Data received is not a JSON valid."),e=[]}b.render(e)})}
DataListWidget.prototype.clean=function(){clearInterval(this.interval);this.pagedListViewWidget.clean()};DataListWidget.prototype.getResponse=function(){this.adapter.getData($.cookie("bioinfo_sid"),this.suiteId)};DataListWidget.prototype.render=function(a){this.data=a;this.pagedListViewWidget.draw(a)};
function PagedViewListWidget(a){var b=this;this._data=null;this.id="PagedViewListWidget_"+Math.round(1E4*Math.random());this.targetId=null;this.pageSize=6;this.storeFields={};this.template={};this.width=280;this.height=550;this.title="";this.border=this.order=0;this.mode="view";this.sort="DESC";if(null!=a&&(null!=a.pageSize&&(this.pageSize=a.pageSize),null!=a.storeFields&&(this.storeFields=a.storeFields),null!=a.template&&(this.template=a.template),null!=a.targetId&&(this.targetId=a.targetId),null!=
a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title),null!=a.order&&(this.order=a.order),null!=a.border&&(this.border=a.border),null!=a.mode))this.mode=a.mode;this.currentPage=1;this.pageFieldId=this.id+"_pageField";this.pageLabelId=this.id+"_pageLabel";this.pagbarId=this.id+"_pagbar";this.panelId=this.id+"_panel";this.onItemClick=new Event(this);this.textFilterFunction=function(a){var d=Ext.getCmp(b.id+"searchField").getValue().toLowerCase();return 0>
a.data.name.toLowerCase().indexOf(d)?!1:!0}}PagedViewListWidget.prototype.getData=function(){return this._data};PagedViewListWidget.prototype._setData=function(a){this._data=a};PagedViewListWidget.prototype.setFilter=function(a){this.store.clearFilter();null!=a?(this.filterFunction=a,this.store.filter([a,this.textFilterFunction])):this.store.filter([this.textFilterFunction])};
PagedViewListWidget.prototype.draw=function(a){this._setData(a);this.render();this.store.loadData(this.getData());null!=this.filterFunction&&this.setFilter(this.filterFunction)};PagedViewListWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel)};
PagedViewListWidget.prototype.render=function(){var a=this;if(null==this.panel){this.tpl=new Ext.XTemplate(this.template);this.store=Ext.create("Ext.data.Store",{fields:this.storeFields,sorters:[{property:"creationTime",direction:"DESC"}],autoLoad:!1});var b=null;"view"==this.mode&&(b=this.view=Ext.create("Ext.view.View",{id:this.id+"view",padding:15,store:this.store,tpl:this.tpl,height:$(document).height()-200,trackOver:!0,autoScroll:!0,overItemCls:"list-item-hover",itemSelector:".joblist-item",
listeners:{scope:this,itemclick:function(a,b){console.log("jobId: "+b.data.jobId+"   dataId: "+b.data.dataId);this.onItemClick.notify(b)}}}));if("grid"==this.mode){for(var b=[],c=0;c<this.storeFields.length;c++)b.push({header:this.storeFields[c],dataIndex:this.storeFields[c],flex:1});b=this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:b,border:0})}var d=Ext.create("Ext.form.field.Text",{id:this.id+"searchField",flex:1,margin:"0 1 0 0",emptyText:"enter search term",enableKeyEvents:!0,
listeners:{change:function(){a.setFilter(null)}}});this.pagBar=Ext.create("Ext.toolbar.Toolbar",{id:this.pagbarId,style:"border: "+this.border,items:[{id:this.id+"btnSort",iconCls:"icon-order-desc",tooltip:"Change order",handler:function(){if(a.sort=="DESC"){a.sort="ASC";a.store.sort("creationTime","ASC");this.setIconCls("icon-order-asc")}else{a.sort="DESC";a.store.sort("creationTime","DESC");this.setIconCls("icon-order-desc")}}},d,{id:this.id+"btnClear",text:"X",margin:"0 2 0 0",tooltip:"Clear search box",
handler:function(){d.reset()}}]});this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,title:this.title,border:this.border,width:this.width,tbar:this.pagBar,items:[b]});c=Ext.getCmp(this.targetId);c instanceof Ext.panel.Panel?(c.insert(this.order,this.panel),c.setActiveTab(1),c.setActiveTab(0),b.setHeight=this.panel.getHeight()):this.panel.render(this.targetId)}};
function UserBarWidget(a){var b=this;this.id="UserBarWidget_";this.targetId=null;null!=a&&null!=a.targetId&&(this.targetId=a.targetId);this.spltbtnActiveProjectId=this.id+"_spltbtnActiveProjectID";this.adapter=new WumAdapter;this.onItemsReady=new Event(this);this.onProjectChange=new Event(this);this.adapter.onGetUserInfo.addEventListener(function(a,d){b.responseGetUserInfo(d)});this.adapter.onActiveProject.addEventListener(function(){b.responseActiveProject()})}
UserBarWidget.prototype.responseActiveProject=function(){Ext.getBody().unmask();Ext.getCmp(this.spltbtnActiveProjectId).setText('<b class="emph">'+this.workingProject+"</b>");this.onProjectChange.notify()};
UserBarWidget.prototype.responseGetUserInfo=function(a){this.pdata=JSON.parse(a);var a=(this.pdata.diskUsage/1024).toFixed(2),b=this.pdata.diskQuota/1024/1024,c=(100*(this.pdata.diskUsage/this.pdata.diskQuota)).toFixed(2);this.workingProject='<b class="emph">'+this.pdata.activeProjectName+"</b>";this.createProjectMenuItems(this.pdata.ownedProjects);this.userInfo='<b style="color:darkred">'+this.pdata.email+"</b>&nbsp;working&nbsp;on&nbsp;project";this.userInfo2=' using&nbsp;<b style="color:chocolate">'+
a+'</b>&nbsp;MB&nbsp;of&nbsp;<b style="color:blue">'+b+"</b>&nbsp;GB&nbsp;(<b>"+c+"%</b>)&nbsp;";this.render();this.onItemsReady.notify()};UserBarWidget.prototype.draw=function(a){this.clean(a);this.adapter.getUserInfo($.cookie("bioinfo_sid"))};UserBarWidget.prototype.clean=function(a){if(null!=this.items){for(var b=0;b<this.items.length;b++)a.remove(this.items[b]);delete this.items}};
UserBarWidget.prototype.render=function(){if(null==this.items){this.projectMenu=Ext.create("Ext.menu.Menu",{plain:!0,items:this.projects});var a=Ext.create("Ext.button.Button",{id:this.spltbtnActiveProjectId,text:this.workingProject,menu:this.projectMenu}),b=Ext.create("Ext.container.Container",{html:this.userInfo}),c=Ext.create("Ext.container.Container",{html:this.userInfo2});this.items=[b,a,c]}};
UserBarWidget.prototype.createProjectMenuItems=function(a){this.projects=[];for(var b=0;b<a.length;b++)this.projects[b]={text:a[b].name,index:b,iconCls:"icon-change-project",listeners:{scope:this,click:function(b){Ext.getBody().mask("Changing project...");console.log("cliked on project id -> "+a[b.index].projectId);this.workingProject=a[b.index].name;this.workingProjectId=a[b.index].projectId;this.adapter.activeProject(a[b.index].projectId,$.cookie("bioinfo_sid"))}}};null!=this.projectMenu&&(this.projectMenu.removeAll(),
this.projectMenu.add(this.projects))};function UploadWidget(a){this.id="uploadWidget_"+Math.round(1E7*Math.random());this.suiteId=this.targetId=null;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.suiteId))this.suiteId=a.suiteId;this.adapter=new WumAdapter;this.uploadButtonId=this.id+"_uploadButton";this.uploadFieldId=this.id+"_uploadField";this.selectedDataType=null}
UploadWidget.prototype.draw=function(){var a={9:[{text:"ID List",children:[{text:"SNP",tag:"idlist:snp"},{text:"Gene/Transcript",tag:"idlist:gene:transcript"}]},{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"Expression",tag:"expression"}]}],6:[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"}]}],
11:[{text:"Annotation",tag:"annotation"},{text:"ID List",children:[{text:"Gene",tag:"idlist:gene"},{text:"Ranked",tag:"ranked"}]}],12:[{text:"Abundances",tag:"abundances"}],100:[{text:"Sequence",tag:"sequence"}]};switch(this.suiteId){case 9:this.checkDataTypes(a["9"]);this.render(a["9"]);break;case 6:this.checkDataTypes(a["6"]);this.render(a["6"]);break;case 11:this.checkDataTypes(a["11"]);this.render(a["11"]);break;case 12:this.checkDataTypes(a["12"]);this.render(a["12"]);break;case 100:this.checkDataTypes(a["100"]);
this.render(a["100"]);break;case -1:break;default:this.render([{text:"No data types defined"}])}};UploadWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))};UploadWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)};
UploadWidget.prototype.render=function(a){var b=this;if(null==this.panel){var a=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Data type",children:a}}),c=20*Object.keys(a.tree.nodeHash).length;250>c&&(c=250);a=Ext.create("Ext.tree.Panel",{title:"Select your data type",bodyPadding:10,height:c,border:!1,cls:"panel-border-right",width:250,store:a,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){b.data.leaf?(this.selectedDataType=b.raw.tag,this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',
!1)):(this.selectedDataType=null,this.dataTypeLabel.setText('<span class="info">Select a data type</span><span class="err"> !!!</span>',!1));this.validate()}}});this.nameField=Ext.create("Ext.form.field.Text",{name:"datalabel",fieldLabel:"Data name",labelWidth:110,msgTarget:"side",allowBlank:!1,enableKeyEvents:!0,listeners:{scope:this,change:function(a){""!=a.getValue()?this.dataNameLabel.setText('<span class="info">Name:</span><span class="ok"> OK </span>',!1):this.dataNameLabel.setText('<span class="info">Enter the data name</span><span class="err"> !!!</span>',
!1);this.validate()}}});this.textArea=Ext.create("Ext.form.field.TextArea",{name:"datadescription",fieldLabel:"Data description",labelWidth:110,msgTarget:"side"});this.organizationField=Ext.create("Ext.form.field.Text",{name:"organization",fieldLabel:"Organization",labelWidth:110,msgTarget:"side"});this.responsableField=Ext.create("Ext.form.field.Text",{name:"responsable",fieldLabel:"Responsible",labelWidth:110,msgTarget:"side"});this.acquisitiondate=Ext.create("Ext.form.field.Text",{name:"acquisitiondate",
fieldLabel:"Acquisition date",labelWidth:110,msgTarget:"side"});c=Ext.create("Ext.panel.Panel",{title:"Some aditional data",width:350,border:!1,height:c,bodyPadding:15,items:[this.nameField,this.textArea,this.organizationField,this.responsableField,this.acquisitiondate]});this.dataTypeLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data type</span>'});this.dataNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Enter the data name</span>'});this.dataFieldLabel=
Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data file</span>'});this.originCheck=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",margin:"0 0 5 5",boxLabel:"Text mode",listeners:{scope:this,change:function(){this.originCheck.getValue()?(this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span><span class="info"> chars</span>',!1),this.uploadBar.hide(),this.editor.show(),this.uploadField.destroy(),this.uploadField.setRawValue(null)):(this.dataFieldLabel.setText('<span class="info">Select a data file</span>',
!1),this.editor.hide(),this.uploadBar.show(),this.editor.setRawValue(null),this.createUploadField());this.validate()}}});var d=Ext.create("Ext.button.Button",{id:this.uploadButtonId,text:"Upload",disabled:!0,handler:function(){b.uploadFile()}});this.editor=Ext.create("Ext.form.field.TextArea",{xtype:"textarea",width:602,flex:1,height:100,emptyText:"Paste or write your file directly",hidden:!0,name:"file",margin:"-1",enableKeyEvents:!0,listeners:{scope:this,change:function(){this.dataFieldLabel.setText('<span class="ok">'+
this.editor.getValue().length+'</span> <span class="info"> chars</span>',!1);this.validate()}}});this.uploadBar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});this.createUploadField();this.modebar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",height:28,border:!1,items:[this.originCheck,"->",this.dataTypeLabel,"-",this.dataNameLabel,"-",this.dataFieldLabel]});var e=Ext.create("Ext.panel.Panel",{title:"File origin",colspan:2,border:!1,width:600,cls:"panel-border-top",items:[this.uploadBar,
this.editor],bbar:this.modebar});this.panel=Ext.create("Ext.window.Window",{title:'Upload a data file -  <span class="err">ZIP files will be allowed shortly</span>',iconCls:"icon-upload",resizable:!1,constrain:!0,closable:!1,modal:!0,layout:{type:"table",columns:2,rows:2},items:[a,c,e],buttonAlign:"right",buttons:[{text:"Close",handler:function(){b.panel.destroy()}},d],listeners:{scope:this,minimize:function(){this.panel.destroy()},destroy:function(){delete this.panel}}})}this.panel.show()};
UploadWidget.prototype.createUploadField=function(){this.uploadField=Ext.create("Ext.form.field.File",{id:this.uploadFieldId,xtype:"filefield",name:"file",flex:1,padding:1,msgTarget:"side",emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Open file...",listeners:{scope:this,change:function(){this.fileSelected();this.validate()}}});this.uploadBar.add(this.uploadField)};
UploadWidget.prototype.validate=function(){null!=this.selectedDataType&&""!=this.nameField.getValue()&&(""!=this.uploadField.getRawValue()||""!=this.editor.getValue())?Ext.getCmp(this.uploadButtonId).enable():Ext.getCmp(this.uploadButtonId).disable()};
UploadWidget.prototype.fileSelected=function(){var a=document.getElementById(this.uploadField.fileInputEl.id).files[0];if(a){var b=0,b=1048576<a.size?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB";this.dataFieldLabel.setText('<span class="info">Size: </span><span class="ok">'+b+"</span>",!1)}};
UploadWidget.prototype.uploadFile=function(){var a=this;Ext.getBody().mask("Uploading file...");this.panel.disable();var b=new FormData;this.originCheck.getValue()?b.append("file",this.editor.getValue()):b.append("file",document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0]);var c=$.cookie("bioinfo_sid");b.append("name",this.nameField.getValue());b.append("tags",this.selectedDataType);b.append("responsible",this.responsableField.getValue());b.append("organization",this.organizationField.getValue());
b.append("date",this.acquisitiondate.getValue());b.append("description",this.textArea.getValue());b.append("sessionid",c);b=$.ajax({url:this.adapter.getHost()+"/data/upload",type:"POST",data:b,processData:!1,contentType:!1});b.done(function(b){a.uploadComplete(b)});b.fail(function(b){a.uploadFailed(b)})};UploadWidget.prototype.uploadProgress=function(a){console.log("Progress...");a.lengthComputable?(a=Math.round(100*a.loaded/a.total),console.log(a)):console.log("unable to compute")};
UploadWidget.prototype.uploadComplete=function(a){var b="Uploaded sucessfully";-1!=a.indexOf("ERROR")&&(b=a);Ext.Msg.show({title:"Upload status",msg:b});this.panel.enable();Ext.getBody().unmask();"Uploaded sucessfully"==b&&this.panel.close()};UploadWidget.prototype.uploadFailed=function(a){console.log(a);Ext.Msg.show({title:"Upload status",msg:"There was an error attempting to upload the file."});this.panel.enable();Ext.getBody().unmask()};
UploadWidget.prototype.uploadCanceled=function(a){console.log(a);Ext.Msg.show({title:"Upload status",msg:"The upload has been canceled by the user or the browser dropped the connection."});this.panel.enable();Ext.getBody().unmask()};
function LoginWidget(a,b){var c=this;this.id="LoginWidget_";this.targetId=null;this.suiteId=a;null!=b&&null!=b.targetId&&(this.targetId=b.targetId);this.onSessionInitiated=new Event(this);this.adapter=new WumAdapter;this.adapter.onLogin.addEventListener(function(a,b){c.panel.setLoading(false);console.log(b);b=b.replace(/^\s+|\s+$/g,"");if(b.length==64){$.cookie("bioinfo_sid",b);c.onSessionInitiated.notify()}else if(b.indexOf("ERROR")==-1){var f=JSON.parse(b);if(f.currentSessionId!=null){$.cookie("bioinfo_sid",
f.currentSessionId);c.onSessionInitiated.notify()}}else{Ext.getCmp(c.labelPassId).setText('<span class="err">'+b+"</span>",false);$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"})}});this.adapter.onRegister.addEventListener(function(a,b){c.panel.setLoading(false);b=b.replace(/^\s+|\s+$/g,"");if(b.length==64){$.cookie("bioinfo_sid",b);c.onSessionInitiated.notify()}else{b=b.replace(/ERROR: /gi," ");Ext.getCmp(c.labelPassId).setText('<span class="err">'+b+"</span>",false);$.cookie("bioinfo_sid",
null);$.cookie("bioinfo_sid",null,{path:"/"})}});this.adapter.onReset.addEventListener(function(a,b){c.panel.setLoading(false);Ext.getCmp(c.labelPassId).setText('<span class="emph">'+b+"</span>",false)});this.labelEmailId=this.id+"labelEmail";this.labelPassId=this.id+"labelPass";this.fldEmailId=this.id+"fldEmail";this.fldPasswordId=this.id+"fldPassword";this.fldNpass1Id=this.id+"fldNpass1";this.fldNpass2Id=this.id+"fldNpass2";this.btnSignId=this.id+"fldSign";this.btnAnonymousId=this.id+"btnAnonymous";
this.btnForgotId=this.id+"btnForgot";this.btnNewaccId=this.id+"btnNewacc";this.btnSendId=this.id+"btnSend";this.btnBackId=this.id+"btnBack";this.btnRegisterId=this.id+"btnRegister"}
LoginWidget.prototype.sign=function(){Ext.getCmp(this.btnAnonymousId).getValue()?(this.adapter.login("anonymous","",this.suiteId),this.panel.setLoading("Waiting server...")):this.checkemail()&&(-1!=this.getLogin().indexOf("@")?this.adapter.login(this.getLogin(),this.getPassword(),this.suiteId):this.adapter.login(this.getLogin()+"@cipf.es",this.getPassword(),this.suiteId),this.panel.setLoading("Waiting server..."),$.cookie("bioinfo_user",this.getLogin(),{path:"/",expires:7}))};
LoginWidget.prototype.register=function(){this.checkemail()&&this.checkpass()&&this.adapter.register(this.getLogin(),this.getPasswordReg(),this.suiteId)};LoginWidget.prototype.sendRecover=function(){this.checkemail()&&(this.adapter.reset(this.getLogin()),this.panel.setLoading("Waiting server..."))};LoginWidget.prototype.getLogin=function(){return Ext.getCmp(this.fldEmailId).getValue()};LoginWidget.prototype.getPassword=function(){return $.sha1(Ext.getCmp(this.fldPasswordId).getValue())};
LoginWidget.prototype.getPasswordReg=function(){return $.sha1(Ext.getCmp(this.fldNpass1Id).getValue())};LoginWidget.prototype.draw=function(){this.render()};LoginWidget.prototype.clean=function(){null!=this.panel&&this.panel.destroy()};
LoginWidget.prototype.render=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.TextItem",{id:this.labelEmailId,padding:3,text:'<span class="info">Type your email</span>'}),c=Ext.create("Ext.toolbar.TextItem",{id:this.labelPassId,padding:3,text:'<span class="info">Type your password</span>'});this.pan=Ext.create("Ext.form.Panel",{id:this.id+"formPanel",bodyPadding:20,width:350,height:145,border:!1,bbar:{items:[b,"-",c]},items:[{id:this.fldEmailId,xtype:"textfield",value:$.cookie("bioinfo_user"),
fieldLabel:"e-mail",listeners:{change:function(){a.checkemail()},specialkey:function(b,c){c.getKey()==c.ENTER&&a.sign()}}},{id:this.fldPasswordId,xtype:"textfield",fieldLabel:"password",inputType:"password",listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a.sign()}}},{id:this.fldNpass1Id,xtype:"textfield",fieldLabel:"password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.fldNpass2Id,xtype:"textfield",fieldLabel:"re-password",inputType:"password",hidden:!0,
listeners:{scope:this,change:this.checkpass}},{id:this.btnAnonymousId,xtype:"checkboxfield",padding:"10 0 0 0",boxLabel:'Anonymous login <p class="tip s90">Your work will be lost after logout</p>',margin:"0 0 0 50"}]});this.panel=Ext.create("Ext.window.Window",{id:this.id+"windowPanel",title:"Sign in",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,items:[this.pan],buttonAlign:"center",buttons:[{id:this.btnSignId,text:"Sign in"},{id:this.btnForgotId,text:"Forgot yout password?",width:130,
minWidth:130},{id:this.btnNewaccId,text:"New account",width:100,minWidth:100},{id:this.btnSendId,text:"Send",hidden:!0},{id:this.btnRegisterId,text:"Register",hidden:!0},{id:this.btnBackId,text:"Back",hidden:!0}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}});Ext.getCmp(this.btnForgotId).on("click",this.ShowForgot,this);Ext.getCmp(this.btnBackId).on("click",this.ShowBack,this);Ext.getCmp(this.btnNewaccId).on("click",this.ShowNewacc,this);Ext.getCmp(this.btnSignId).on("click",
this.sign,this);Ext.getCmp(this.btnSendId).on("click",this.sendRecover,this);Ext.getCmp(this.btnRegisterId).on("click",this.register,this);Ext.getCmp(this.btnAnonymousId).on("change",this.anonymousSelected,this)}this.panel.show()};
LoginWidget.prototype.ShowForgot=function(){Ext.getCmp(this.fldEmailId).reset();Ext.getCmp(this.fldPasswordId).reset();Ext.getCmp(this.btnAnonymousId).reset();Ext.getCmp(this.fldNpass1Id).reset();Ext.getCmp(this.fldNpass2Id).reset();Ext.getCmp(this.fldPasswordId).hide();Ext.getCmp(this.btnAnonymousId).hide();Ext.getCmp(this.fldNpass1Id).hide();Ext.getCmp(this.fldNpass2Id).hide();Ext.getCmp(this.btnSignId).hide();Ext.getCmp(this.btnForgotId).hide();Ext.getCmp(this.btnNewaccId).hide();Ext.getCmp(this.btnSendId).show();
Ext.getCmp(this.btnBackId).show();Ext.getCmp(this.btnRegisterId).hide();Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your email to send a new password</span>',!1);Ext.getCmp(this.labelPassId).setText("&nbsp;",!1)};
LoginWidget.prototype.ShowBack=function(){Ext.getCmp(this.fldEmailId).reset();Ext.getCmp(this.fldPasswordId).reset();Ext.getCmp(this.btnAnonymousId).reset();Ext.getCmp(this.fldNpass1Id).reset();Ext.getCmp(this.fldNpass2Id).reset();Ext.getCmp(this.fldPasswordId).show();Ext.getCmp(this.btnAnonymousId).show();Ext.getCmp(this.fldNpass1Id).hide();Ext.getCmp(this.fldNpass2Id).hide();Ext.getCmp(this.btnSignId).show();Ext.getCmp(this.btnForgotId).show();Ext.getCmp(this.btnNewaccId).show();Ext.getCmp(this.btnSendId).hide();
Ext.getCmp(this.btnBackId).hide();Ext.getCmp(this.btnRegisterId).hide();Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your email</span>',!1);Ext.getCmp(this.labelPassId).setText('<span class="info">Type your password</span>',!1)};
LoginWidget.prototype.ShowNewacc=function(){Ext.getCmp(this.fldEmailId).reset();Ext.getCmp(this.fldPasswordId).reset();Ext.getCmp(this.btnAnonymousId).reset();Ext.getCmp(this.fldNpass1Id).reset();Ext.getCmp(this.fldNpass2Id).reset();Ext.getCmp(this.fldPasswordId).hide();Ext.getCmp(this.btnAnonymousId).hide();Ext.getCmp(this.fldNpass1Id).show();Ext.getCmp(this.fldNpass2Id).show();Ext.getCmp(this.btnSignId).hide();Ext.getCmp(this.btnForgotId).hide();Ext.getCmp(this.btnNewaccId).hide();Ext.getCmp(this.btnSendId).hide();
Ext.getCmp(this.btnBackId).show();Ext.getCmp(this.btnRegisterId).show();Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your email</span>',!1);Ext.getCmp(this.labelPassId).setText('<span class="info">Type your password</span>',!1)};
LoginWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNpass1Id).getValue(),b=Ext.getCmp(this.fldNpass2Id).getValue();if(!/[ *]/.test(a)&&3<a.length){if(a==b)return Ext.getCmp(this.labelPassId).setText('<span class="ok">Passwords match</span>',!1),!0;Ext.getCmp(this.labelPassId).setText('<span class="err">Password does not match</span>',!1);return!1}Ext.getCmp(this.labelPassId).setText('<span class="err">Password must be at least 4 characters</span>',!1);return!1};
LoginWidget.prototype.anonymousSelected=function(a,b){b?(Ext.getCmp(this.labelEmailId).setText('<span class="ok">Anonymous selected</span>',!1),Ext.getCmp(this.labelPassId).setText('<span class="ok">No password required</span>',!1)):(Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your email</span>',!1),Ext.getCmp(this.labelPassId).setText('<span class="info">Type your password</span>',!1))};
LoginWidget.prototype.checkemail=function(){Ext.getCmp(this.btnAnonymousId).reset();var a=Ext.getCmp(this.fldEmailId).getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(-1!=a.indexOf("@")){if(b.test(a))return Ext.getCmp(this.labelEmailId).setText('<span class="ok">E-mail format valid</span>',!1),!0;Ext.getCmp(this.labelEmailId).setText('<span class="err">E-mail format not valid</span>',!1);return!1}Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your email</span>',
!1);return!0};
function EditUserWidget(a){var b=this;this.id="EditUserWidget_"+Math.round(1E7*Math.random());this.targetId=null;null!=a&&null!=a.targetId&&(this.targetId=a.targetId);this.adapter=new WumAdapter;this.adapter.onEditPassword.addEventListener(function(a,d){b.panel.setLoading(false);console.log(b.id+" EDIT PASS RESPONSE -> "+d);Ext.getCmp(b.labelPassId).setText(d,false)});this.fldOldId=this.id+"fldOld";this.fldNew1Id=this.id+"fldNew1";this.fldNew2Id=this.id+"fldNew2";this.btnChangeId=this.id+"btnChange";
this.labelPassId=this.id+"labelPass"}EditUserWidget.prototype.getOldPassword=function(){return $.sha1(Ext.getCmp(this.fldOldId).getValue())};EditUserWidget.prototype.getNewPassword=function(){console.log($.sha1(Ext.getCmp(this.fldNew1Id).getValue()));return $.sha1(Ext.getCmp(this.fldNew1Id).getValue())};EditUserWidget.prototype.change=function(){this.checkpass()&&(this.adapter.editPassword(this.getOldPassword(),this.getNewPassword(),$.cookie("bioinfo_sid")),this.panel.setLoading("Waiting for the server to respond..."))};
EditUserWidget.prototype.draw=function(){this.render()};EditUserWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))};
EditUserWidget.prototype.render=function(){if(null==this.panel){console.log(this.id+" CREATING PANEL");var a=Ext.create("Ext.toolbar.TextItem",{id:this.labelPassId,padding:3,text:'<span class="info">Type the old and the new password</span>'});this.pan=Ext.create("Ext.panel.Panel",{bodyPadding:20,width:350,height:135,border:!1,bbar:{items:[a]},items:[{id:this.fldOldId,xtype:"textfield",fieldLabel:"Old password",inputType:"password"},{id:this.fldNew1Id,xtype:"textfield",fieldLabel:"New password",inputType:"password",
listeners:{scope:this,change:this.checkpass}},{id:this.fldNew2Id,xtype:"textfield",fieldLabel:"Confirm new",inputType:"password",listeners:{scope:this,change:this.checkpass}}]});this.panel=Ext.create("Ext.window.Window",{title:"Change your password",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,items:[this.pan],buttonAlign:"center",buttons:[{id:this.btnChangeId,text:"Change"}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}});Ext.getCmp(this.btnChangeId).on("click",
this.change,this)}this.panel.show()};EditUserWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNew1Id).getValue(),b=Ext.getCmp(this.fldNew2Id).getValue();if(!/[ *]/.test(a)&&3<a.length){if(a==b)return Ext.getCmp(this.labelPassId).setText('<p class="ok">Passwords match</p>',!1),!0;Ext.getCmp(this.labelPassId).setText('<p class="err">Passwords does not match</p>',!1);return!1}Ext.getCmp(this.labelPassId).setText('<p class="err">Password must be at least 4 characters</p>',!1);return!1};
function ResultWidget(a){var b=this;this.id="ResultWidget"+Math.round(1E4*Math.random());this.targetId=null;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.application&&(this.application=a.application),null!=a.app))this.app=a.app;this.adapter=new WumAdapter;this.adapter.onJobResult.addEventListener(function(a,d){b.data=JSON.parse(d);Ext.getBody().unmask();b.panel.setLoading(!1);b.render()});this.genomeMapsId=this.networkViewerId=this.panelId=null;this.resultTables={};this.resultHistograms=
{};this.resultGCharts={};this.variantFiles={};this.onViewRendered=new Event;this.onViewRendered.addEventListener(function(){b.drawTables();b.drawHistograms();b.drawGCharts();b.drawApplicationItems()})}
ResultWidget.prototype.draw=function(a,b){this.record=b;this.jobId=this.record.data.jobId;this.id=this.jobId+this.id;this.panelId="ResultWidget_"+this.jobId;this.networkViewerId=this.panelId+"_CellBrowserId";this.genomeMapsId=this.panelId+"_GenomeMapsId";this.panel=Ext.getCmp(this.panelId);null==this.panel?(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:this.record.data.name,closable:!0,autoScroll:!0}),Ext.getCmp(this.targetId).add(this.panel),Ext.getCmp(this.targetId).setActiveTab(this.panel),
this.panel.setLoading("Loading job info..."),Ext.getBody().mask(),this.adapter.jobResult(this.jobId,"json",a)):Ext.getCmp(this.targetId).setActiveTab(this.panel)};
ResultWidget.prototype.render=function(){var a=this;console.log(this.application);if(0!=this.data.outputItems.length){for(var b=this.data.inputItems.concat(this.data.outputItems),c={},d=0;d<b.length;d++){var e=b[d].group;if(""!=e)if(-1!=e.indexOf(".")){var f=e.split(".")[0],e=e.split(".")[1];null==c[f]&&(c[f]={});null==c[f][e]&&(c[f][e]=[]);this.checkPValue(b[d].title)&&c[f][e].push(b[d])}else null==c[e]&&(c[e]={},c[e].items=[]),this.renamePValue(b[d]),c[e].items.push(b[d])}console.log(c);b=Ext.create("Ext.container.Container",
{html:'<a name="'+this.jobId+'top"></a>'});f=Ext.create("Ext.container.Container",{margin:"15 0 5 15",html:'<p >The job named <span class="info">'+this.record.data.name+' </span>was launched on <span class="err">'+this.record.data.creationTime+' </span>and has been visited <span class="dis">'+this.record.data.visites+" times</span></p>You can download the job results by pressing the <b>download</b> button."});e=[];d=1;for(key in c){var g=Ext.create("Ext.container.Container",{padding:"0 0 2 15",html:'<p class="s110 emph">'+
d+'. <a href="#'+key+'">'+key+"</a></p>"});e.push(g);d++}d=1;for(key in c){g=(this.jobId+key+"info").replace(/ /gi,"");g=Ext.create("Ext.container.Container",{infoId:g,groupName:key,padding:"60 15 5 15",html:'<p class="panel-border-bottom"><span class="s140 emph">'+d+'. <a name="'+key+'" href="#'+this.jobId+'top">'+key+'</a> </span><span class="info" id="'+g+'"></span></p>',listeners:{afterrender:function(){var b=a.getInfo(this.groupName);if(""!=b){$("#"+this.infoId).html("+info");var c=Ext.create("Ext.tip.Tip",
{html:b,listeners:{show:function(){var a=this;this.getEl().on("mouseleave",function(){a.hide()})}}});$("#"+this.infoId).mouseover(function(a){$(this).css({cursor:"pointer"});c.showAt(a.clientX,a.clientY)});$("#"+this.infoId).click(function(){c.hide()})}}}});e.push(g);e.push(this.getResults(c[key].items));var j=1;for(clave in c[key])"items"!=clave&&(g=Ext.create("Ext.container.Container",{padding:"15 15 5 30",cls:"inlineblock",html:'<p class="panel-border-bottom s120 emph">'+d+"."+j+" "+clave+"</p>"}),
e.push(g),e.push(this.getResults(c[key][clave])),j++);d++}c=Ext.create("Ext.button.Button",{text:"Download",margin:"0 0 25 15",handler:function(){a.adapter.download(a.jobId,$.cookie("bioinfo_sid"))}});d=Ext.create("Ext.button.Button",{text:"Delete",margin:"0 0 25 30",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(b){"yes"==b&&(a.adapter.onDeleteJob.addEventListener(function(b,c){var d="";-1!=c.response.indexOf("OK")?(Ext.getCmp(a.targetId).getActiveTab().close(),
d="The job has been succesfully deleted."):d="ERROR: could not delete job.";Ext.Msg.alert("Delete job",d)}),a.adapter.deleteJob(a.jobId,$.cookie("bioinfo_sid")))})}});this.panel.add(b);this.panel.add(f);this.panel.add(c);this.panel.add(d);this.panel.add(e);a.onViewRendered.notify()}};
ResultWidget.prototype.getResults=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.showInfo(d);b.push(e);(e=this.showTypeInfo(d))&&b.push(e);e=this.showTagInfo(d);null!=e&&b.push(e)}return Ext.create("Ext.container.Container",{layout:{type:"table",columns:1,tableAttrs:{style:{width:"100%"}}},items:b})};
ResultWidget.prototype.showInfo=function(a){var b=this,c=new Ext.XTemplate('<span class="key">{title} </span>','<span class="{[ this.setCSS(values) ]}">{value}</span><br>',{disableFormats:!0,setCSS:function(a){switch(a.type){case "FILE":return"file";case "MESSAGE":return"species"==a.name&&(b.species=a.value),"message"}}});return itemBox=Ext.create("Ext.container.Container",{data:a,datos:a,margin:"0 10 0 20",padding:5,tpl:c,cls:"inlineblock",listeners:{afterrender:function(){var a=this.datos;"FILE"==
this.datos.type&&(this.getEl().addClsOnOver("encima"),this.getEl().addCls("whiteborder"),"variant"==b.application&&-1!=a.title.toLowerCase().indexOf("filter")&&(b.filteredVcfFile=a.value),this.getEl().on("click",function(){console.log(a);b.adapter.poll(b.jobId,a.value,true,$.cookie("bioinfo_sid"))}))}}})};
ResultWidget.prototype.showTypeInfo=function(a){var b=Ext.create("Ext.container.Container",{margin:"0 10 0 10",padding:5});switch(a.type){case "IMAGE":return b.html='<div><img width="900" src="'+this.adapter.pollurl(this.jobId,a.value,$.cookie("bioinfo_sid"))+'"></div>',b;default:return null}};
ResultWidget.prototype.showTagInfo=function(a){for(var b=Ext.create("Ext.container.Container",{margin:"0 10 0 10",flex:1,padding:5,html:""}),c=0;c<a.tags.length;c++)switch(a.tags[c]){case "TABLE":return c=this.jobId+a.value+a.tags,this.resultTables[c]=new ResultTable(this.jobId,a.value,a.tags,{targetId:"resultTable_"+c}),b.html+='<div id="resultTable_'+c+'" style="padding:5px;"></div>',b;case "HISTOGRAM":return c="histogram_"+this.jobId+a.value+a.tags,this.resultHistograms[c]=a.value,b.html='<div id="'+
c+'" style="padding:5px;"></div>',b;case "GCHART":return c="gchart_"+a.name,this.resultGCharts[c]=a.value,b.html='<div id="'+c+'"></div>',b;case "CONSEQUENCE_TYPE_VARIANTS":this.variantFiles[a.name]=a.title}return null};ResultWidget.prototype.drawTables=function(){for(id in this.resultTables)this.resultTables[id].draw()};
ResultWidget.prototype.drawHistograms=function(){for(id in this.resultHistograms){var a=new WumAdapter;a.onPoll.addEventListener(function(a,c){if(""!=c){for(var d=c.split("\n"),e=[],f=[],g=[],j=[],h=0,k=0;k<d.length;k++)e.push(d[k].split("\t")),""!=e[k][0]&&f.push(e[k][0]),null!=e[k][1]&&(h+=parseFloat(e[k][1]),g.push(e[k][1]));for(k=0;k<g.length;k++)j.push(Math.round(100*(parseFloat(g[k])/h)));f=f.toString().replace(/,/gi,"|");document.getElementById(id).innerHTML='<img src="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:'+
j+"&chl="+f+'&chtt=Consequence+types&chts=000000,14.5">'}});a.poll(this.jobId,this.resultHistograms[id],!1,$.cookie("bioinfo_sid"))}};ResultWidget.prototype.drawGCharts=function(){for(id in this.resultGCharts)drawChart(id,this.resultGCharts[id])};
ResultWidget.prototype.drawApplicationItems=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.application+this.id+"Container",border:!0,margin:"50 50 0 50",height:700,cls:"greyborder",html:'<div id="'+this.id+'Container"></div>'});switch(this.application){case "variant":b.on("afterrender",function(){a.createGenomeViewer(a.id+"Container")});break;case "renato":var c=Ext.create("Ext.ProgressBar",{id:this.id+"pbar",margin:"5 0 0 50",width:500});c.wait({interval:500,duration:5E4,increment:15,
text:"Getting database information and drawing the network, please wait...",scope:this,fn:function(){c.updateText("Done!")}});this.panel.add(c);b.on("afterrender",function(){a.createCellBrowser(a.id+"Container")});break;default:return null}this.panel.add(b)};
ResultWidget.prototype.createGenomeViewer=function(a){var b=this,c=Ext.getCmp(this.application+a).getWidth(),d=Ext.getCmp(this.application+a).getHeight(),e=new GenomeViewer(a,AVAILABLE_SPECIES[0],{version:"",zoom:75,width:c-2,height:d-2});e.setMenuBar(this.getGenomeViewerResultBar(e));e.afterRender.addEventListener(function(){b.app.setTracks(e)});e.draw();a=new WumRestAdapter;a.onPoll.addEventListener(function(a,b){var c=new VCFDataAdapter(new StringDataSource(b),{async:!1,species:e.species}),d=new TrackData("VCF file",
{adapter:c});e.addTrack(d,{id:"VCF file",featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});c=c.featureCache.getFirstFeature();e.setLoc({sender:"",chromosome:c.chromosome,position:c.start})});null!=this.filteredVcfFile?a.poll(b.jobId,this.filteredVcfFile,!1,$.cookie("bioinfo_sid")):console.log("No filtered VCF file.")};var mostSignificativesFeatures=[];
ResultWidget.prototype.createCellBrowser=function(a){var b=this;record=this.record;Ext.getCmp(this.application+a).disable();var c=Ext.getCmp(this.application+a).getWidth(),d=Ext.getCmp(this.application+a).getHeight();this.networkViewer=new NetworkViewer(a,this.getSpeciesItem(this.species),{width:c-2,height:d-2});this.networkViewer.draw();var e=new GraphDataset,f=new LayoutDataset,g=new NetworkDataSetFormatter({defaultFormat:{type:"LineEdgeNetworkFormatter",opacity:1,fill:"#000000",radius:"5",strokeWidth:"1",
stroke:"#000000",size:"2",title:{fontSize:10,fill:"#000000"}},selected:{opacity:0.9,fill:"#FF0000",radius:"5",stroke:"#000000",size:"2"},over:{opacity:1,fill:"#DF0101",radius:"5",stroke:"#000000",size:"2",strokeWidth:"1"}},{defaultFormat:{opacity:0.8,stroke:"#000000",strokeWidth:"1",strokeOpacity:0.5,title:{fontSize:6,fontColor:"#000000"}},selected:{stroke:"#DF0101",fill:"#FF0000"},over:{stroke:"#DF0101",strokeOpacity:1,strokeWidth:"4"}},{labeled:!1,backgroundColor:"#FFFFFF",balanceNodes:!1,nodesMaxSize:4,
nodesMinSize:2});g.dataBind(e);f.dataBind(e);g.setHeight(d-140);g.setWidth(c-2-13);this.networkViewer.drawNetwork(e,g,f);c=new WumRestAdapter;c.onPoll.addEventListener(function(c,d){for(var e=d.split("\n"),f=[],g=1;g<e.length;g++){var n=13;"fatiscan"==record.data.toolName&&7==e[g].split("\t").length&&(n=6);1E6>e[g].split("\t")[n]&&f.push(e[g].split("\t")[0])}console.log("significativesFeatures.length: "+f.length);e=new WumRestAdapter;e.onPoll.addEventListener(function(c,d){var e=d.split("\n");e.pop();
console.log("genes.length: "+e.length);b.loadNetworkOnCellBrowser(e,f,a)});g="clean_list1.txt";"fatiscan"==record.data.toolName&&(g="id_list.txt");e.poll(b.jobId,g,!1,$.cookie("bioinfo_sid"))});c.poll(this.jobId,"significant_your_annotation_0.05.txt",!1,$.cookie("bioinfo_sid"));console.log("getting ranked_list...");c=new WumRestAdapter;c.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top clean_list...");for(var f=0;50>e&&f<d;f++)0>c[f].indexOf("#")&&
(mostSignificativesFeatures[c[f].split("\t")[0]]=!0,e++);e=0;console.log("getting bottom clean_list...");for(f=d-1;50>e&&0<f;f--)0>c[f].indexOf("#")&&(mostSignificativesFeatures[c[f].split("\t")[0]]=!0,e++)});c.poll(this.jobId,"clean_list1.txt",!1,$.cookie("bioinfo_sid"));console.log("getting ranked_list...");c=new WumRestAdapter;c.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top ranked_list...");for(var f=0;50>e&&f<d;f++)0>c[f].indexOf("#")&&(mostSignificativesFeatures[c[f].split("\t")[0]]=
!0,e++);e=0;console.log("getting bottom ranked_list...");for(f=d-1;50>e&&0<f;f--)0>c[f].indexOf("#")&&(mostSignificativesFeatures[c[f].split("\t")[0]]=!0,e++)});c.poll(this.jobId,"ranked_list.txt",!1,$.cookie("bioinfo_sid"))};
ResultWidget.prototype.loadNetworkOnCellBrowser=function(a,b,c){var d=this,e=0,f=new CellBaseManager(this.networkViewer.species);f.success.addEventListener(function(f,j){for(var h=j.result,k={},l=0;l<h.length;l++)for(var m=0;m<h[l].length;m++)-1!=b.toString().indexOf(h[l][m].tfName)&&(null==k[h[l][m].tfName]&&(k[h[l][m].tfName]={}),null==k[h[l][m].tfName][a[l]]&&(k[h[l][m].tfName][a[l]]=!0));console.log(k);console.log(h.length);console.log("contando TFBSs...");var h=0,n;for(n in k){if(500<h)break;
for(var o in k[n])h++}console.log("menos de 500: "+h);for(n in k)for(o in d.networkViewer.networkWidget.getDataset().addNode(n,{type:"tf"}),l=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1,d.networkViewer.networkWidget.getFormatter().getVertexById(l).getDefault().setFill("#DF0101"),k[n])if(500>h||!0==mostSignificativesFeatures[o])0==d.networkViewer.networkWidget.getDataset().getVertexByName(o).length&&d.networkViewer.networkWidget.getDataset().addNode(o,{type:"gene"}),l=d.networkViewer.networkWidget.getDataset().getVertexByName(o)[0].id,
m=d.networkViewer.networkWidget.getDataset().getVertexByName(n)[0].id,d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+l+"_"+m,m,l),d.networkViewer.networkWidget.getFormatter().getVertexById(l).getDefault().setFill("#0000FF");d.networkViewer.networkWidget.getLayout().getLayout("neato");d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(){e++;2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})});0<a.length&&f.get("feature","gene",a,
"tfbs");f=new CellBaseManager(this.networkViewer.species);f.success.addEventListener(function(f,j){for(var h=j.result,k={},l=0;l<h.length;l++)for(var m=0;m<h[l].length;m++)-1!=b.toString().indexOf(h[l][m].mirbaseId)&&(null==k[h[l][m].mirbaseId]&&(k[h[l][m].mirbaseId]={}),null==k[h[l][m].mirbaseId][a[l]]&&(k[h[l][m].mirbaseId][a[l]]=!0));console.log(k);console.log(h.length);console.log("contando miRNAs...");var h=0,n;for(n in k){if(500<h)break;for(var o in k[n])h++}console.log("menos de 500: "+h);
for(var p in k)for(o in d.networkViewer.networkWidget.getDataset().addNode(p,{type:"mirna"}),n=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1,d.networkViewer.networkWidget.getFormatter().getVertexById(n).getDefault().setFill("red"),k[p])if(500>h||!0==mostSignificativesFeatures[o])0==d.networkViewer.networkWidget.getDataset().getVertexByName(o).length&&d.networkViewer.networkWidget.getDataset().addNode(o,{type:"gene"}),n=d.networkViewer.networkWidget.getDataset().getVertexByName(o)[0].id,
l=d.networkViewer.networkWidget.getDataset().getVertexByName(p)[0].id,d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+n+"_"+l,l,n),d.networkViewer.networkWidget.getFormatter().getVertexById(n).getDefault().setFill("blue"),n=d.networkViewer.networkWidget.getDataset().getEdgesCount()-1,d.networkViewer.networkWidget.getFormatter().changeEdgeType(n,"CutDirectedLineEdgeNetworkFormatter");d.networkViewer.networkWidget.getLayout().getLayout("neato");d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(){e++;
2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})});0<a.length?f.get("feature","gene",a,"mirna_target"):(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())};
ResultWidget.prototype.getGenomeViewerResultBar=function(a){var b=this;switch(this.application){case "variant":return Ext.create("Ext.container.Container",{cls:"bio-toolbar",defaults:{margin:"1 0 0 2"},layout:"vbox",height:27,items:[{xtype:"button",text:'<span class="info">Variant filter tool...</span>',handler:function(){new VariantFilterWidget(b.jobId,{viewer:a,fileNames:b.variantFiles})}}]});default:return null}};
ResultWidget.prototype.getSpeciesItem=function(a){for(var b=0;b<AVAILABLE_SPECIES.length;b++)if(AVAILABLE_SPECIES[b].species==a)return AVAILABLE_SPECIES[b]};ResultWidget.prototype.checkPValue=function(a){return-1!=a.indexOf("pvalue<0.005")||-1!=a.indexOf("pvalue<0.01")||-1!=a.indexOf("pvalue<0.1")?!1:!0};ResultWidget.prototype.renamePValue=function(a){-1!=a.value.indexOf("${pvalue}")&&(a.value=a.value.replace(/\$\{pvalue\}/gi,"0.05"))};
ResultWidget.prototype.setPValue=function(a){console.log(this.id);$("#pvalue"+this.id).html(a)};
ResultWidget.prototype.getInfo=function(a){switch(this.application){case "renato":switch(a){case "Input data":return"This section is a reminder of the parameters or settings you have submitted to run the analysis.";case "Summary":return"<p>This section shows the number of genes annotated to each database in each list.</p><br><p>Gene list: contains three elements, the number of genes in your gene list annotated in the database over the total number of genes remaining in your gene list after the duplicates management, a percentage of genes in your gene list annotated in the database and the ratio of regulators per gene.<br> Genome: the same structure explained above but applied to the whole genome (TFBS or miRNA) or Your Annotations after the duplicates management.</p>";case "Significant Results":return"<p>We consider a significant enrichment after correcting the results by a multiple testing correction method. Enrichment p-values are corrected applying the False discovery rate (FDR) method (Benjamini et al., 1995; Storey andTibshirani, 2003). The threshold of signification applied to the correction has been set to 0.05.</p><br><p>The table provided summarizes the information about the enrichment test for each of the significant regulatory elements that have an Adjusted p-value < 0.05. The table is originally sorted by adjusted p-value and can be sorted up and down by clicking in any of the other column headings. When the number of significant results in a table is higher than five, results are split into different pages. You can move forward or backward in the page list using the arrow buttons.</p>";
case "All results":return"This section contains a downloadable individual text file containing all results for all significant and not significant regulators. This file follows the same structure described above.";case "Annotation files":return"<p>When significant results are obtained, we can suppose that there is one or several regulatory elements behaving different when comparing groups. The list of genes included in the analysis have pointed to a significantly over-represented set of common regulators to these genes. The interpretation of the results will be different in the case of TFs (transcription factors) and miRNAs given that (generally) the first are positive regulators and the latter are negative regulators.</p><br><p>TFs generally bind to the promoter region of their target genes to assist and promote the transcription. miRNAs, on the other hand, bind to transcript products preventing them from being translated. Significant TF and miRNAs can be pointed to be responsible for the differential expression of the genes observed in the list. We must take special care in the interpretation of over-expressed or under-expressed genes in a functional analysis. In the case of TFs, if we are working with the list of over-expressed genes, the significant results makes reference to active TFs in one condition with respect to the other; while significant results of under-expressed genes makes reference to inactive TFs. In miRNAs, significant results of over-expressed genes will point to inactive miRNAs, while significant results of under-expressed genes will point to active miRNAs when comparing conditions.</p>";
default:return""}case "variant":switch(a){case "Variants by Consequence Type":return"Click this link: <a class='ok' target='_blank' href='http://docs.bioinfo.cipf.es/projects/variant/wiki/Output_columns'>Output columns</a>";default:return""}default:return""}};
function ResultTable(a,b,c,d){var e=this;this.id="ResultTable"+Math.round(1E7*Math.random());this.targetId=null;this.jobId=a;this.fileName=b;this.tags=c;this.numRows=5;this.flex=null;this.border=this.collapsible=!0;this.cls=null;if(null!=d&&(null!=d.targetId&&(this.targetId=d.targetId),null!=d.numRows&&(this.numRows=d.numRows),null!=d.flex&&(this.flex=d.flex),null!=d.collapsible&&(this.collapsible=d.collapsible),null!=d.border&&(this.border=d.border),null!=d.cls))this.cls=d.cls;this.adapter=new WumAdapter;
this.table=null;this.onRendered=new Event;this.onRendered.addEventListener(function(){e.draw()})}ResultTable.prototype.draw=function(){this.render()};
ResultTable.prototype.render=function(){for(var a=this,b=null,c=[],d=[],e=0;e<tables.length;e++)if(-1!=this.tags.indexOf(tables[e].name)){this.tableSkel=tables[e];this.colNames=tables[e].colNames;this.colVisibilty=tables[e].colVisibility;this.colTypes=tables[e].colTypes;b=tables[e].numRows;c=[];d=[];for(e=0;e<this.colNames.length;e++)1==this.colVisibilty[e]&&(c.push({header:this.colNames[e],dataIndex:this.colNames[e],flex:1}),d.push({name:this.colNames[e],type:this.colTypes[e]}));break}"text"==this.tableSkel.type?
(c=new WumAdapter,c.poll(this.jobId,this.fileName,!1,$.cookie("bioinfo_sid")),c.onPoll.addEventListener(function(b,c){for(var d=a.parse(c),e=[],k=0;k<d.length;k++){var l=Ext.create("Ext.container.Container",{data:d[0],tpl:a.getTemplate(a.tableSkel.colNames)});e.push(l)}this.table=Ext.create("Ext.container.Container",{items:e,margin:"0 0 0 50",renderTo:a.targetId})})):(e=this.adapter.tableurl(this.jobId,this.fileName,this.colNames,this.colVisibilty,$.cookie("bioinfo_sid")),null==b&&(b=this.numRows),
this.st=Ext.create("Ext.data.Store",{fields:d,pageSize:b,remoteSort:!0,proxy:{type:"jsonp",url:e,reader:{type:"json",root:"items",totalProperty:"total"}}}),this.st.loadPage(1),this.table=Ext.create("Ext.grid.Panel",{title:this.fileName,collapsible:this.collapsible,flex:this.flex,store:this.st,border:this.border,cls:this.cls,columns:c,height:75+22*b,dockedItems:[{xtype:"pagingtoolbar",store:this.st,dock:"top",displayInfo:!0}],renderTo:this.targetId}))};
ResultTable.prototype.parse=function(a){for(var a=a.split("\n"),b=[],c=0;c<a.length;c++)if("#"!=a[c].charAt(0)&&""!=a[c]){for(var d=a[c].split("\t"),e={},f=0;f<d.length;f++)""!=d[f]&&(e[this.tableSkel.colNames[f].replace(/ /g,"_")]=d[f]);b.push(e)}return b};ResultTable.prototype.getTemplate=function(a){for(var b="<p>",c=0;c<a.length;c++)b+='<span class="dis s90">'+a[c]+" </span> {"+a[c].replace(/ /g,"_")+"} &nbsp; &nbsp; &nbsp;";return new Ext.XTemplate(b+"</p>")};
function BrowserDataWidget(a){var b=this;this.id="BrowserDataWidget_"+Math.round(1E7*Math.random());this.tags=this.targetId=null;this.width=900;this.height=500;this.retrieveData=!0;this.notAvailableSuiteList=["SEA","GSnow"];if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.retrieveData&&(this.retrieveData=a.retrieveData),null!=a.notAvailableSuites))for(var c=0;c<a.notAvailableSuites.length;c++)this.notAvailableSuiteList.push(a.notAvailableSuites[c]);
this.adapter=new WumAdapter;this.adapter.onGetData.addEventListener(function(a,c){b.data=c;b.adapter.getSuiteList()});this.adapter.onSuiteList.addEventListener(function(a,c){b.suiteList=c;Ext.getBody().unmask();b.render()});this.onSelect=new Event(this);this.searchFieldId=this.id+"_searchField"}BrowserDataWidget.prototype.draw=function(a,b){this.tags=b;Ext.getBody().mask("Loading...");this.adapter.getData(a,-1)};
BrowserDataWidget.prototype.render=function(){var a=this;if(null==this.panel){for(var b=JSON.parse(this.data),c={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},d=0;d<b.length;d++){var e=b[d].creationTime.substring(0,4),f=b[d].creationTime.substring(5,7),g=b[d].creationTime.substring(8,10),j=b[d].creationTime.substring(11,16);b[d].yearMonth=e+" - "+f+" ("+c[parseInt(f)]+")";b[d].dayHour=g+" - "+j;b[d].tagsMatch=
!1;null!=b[d].tags&&(b[d].tagsMatch=this.checkTags(b[d].tags))}this.gridStore=Ext.create("Ext.data.Store",{fields:"dataId ownerId jobId suiteId name multiple diskUsage creationTime responsible organization date description status statusMessage write enabled tags dataFiles yearMonth dayHour tagsMatch".split(" "),groupField:"yearMonth",sorters:[{property:"yearMonth",direction:"DESC"}],data:b});this.selectedLabel=Ext.create("Ext.toolbar.TextItem",{padding:3,flex:1,text:'<span class="info"> Please select a file</span>.'});
d=Ext.create("Ext.toolbar.TextItem",{padding:3,text:'Suported tags by this analysis: <span class="emph">'+this.tags.toString().replace(/,/gi,", ").replace(/\|/gi," or ")+"</span>"});this.grid=Ext.create("Ext.grid.Panel",{border:!1,store:this.gridStore,columns:[{header:"Name",flex:3,xtype:"templatecolumn",tpl:['<tpl if="tagsMatch"><span class="emph">{name}</span></tpl>','<tpl if="!tagsMatch"><span class="dis">{name}</span></tpl>']},{header:"Disk usage (KB)",dataIndex:"diskUsage",flex:1.2},{header:"Year & Month",
dataIndex:"yearMonth",flex:1.3},{header:"Day & Time",dataIndex:"dayHour",flex:1},{header:"Tags",dataIndex:"tags",flex:1}],features:[{ftype:"grouping"}],selModel:{mode:"SINGLE",listeners:{scope:this,selectionchange:function(a,b){0<b.length?b[0].data.tagsMatch?(this.selectButton.enable(),this.selectedLabel.setText('<p>The selected file <span class="emph">'+b[0].data.name.substr(0,40)+'</span><span class="ok"> is allowed</span>.</p>',!1)):(this.selectButton.disable(),this.selectedLabel.setText('<p>The selected file <span class="dis">'+
b[0].data.name.substr(0,40)+'</span><span class="err"> is not allowed</span>.</p>',!1)):this.selectButton.disable()}}},flex:4,bbar:{items:[d,"-",this.selectedLabel]}});d=Ext.create("Ext.data.Store",{fields:["suiteId","name"],data:[{suiteId:"all",name:"all"},{suiteId:"Uploaded Data",name:"Uploaded Data"},{suiteId:"Job Generated",name:"Job Generated"}]});this.viewOrigin=Ext.create("Ext.view.View",{store:d,selModel:{mode:"SINGLE",listeners:{selectionchange:function(){a.setFilter()}}},cls:"list",trackOver:!0,
overItemCls:"list-item-hover",itemSelector:".list-item",tpl:'<tpl for="."><div class="list-item">{name}</div></tpl>'});b=Ext.create("Ext.panel.Panel",{title:"Search by origin",border:0,bodyPadding:5,style:"border-bottom:1px solid #99bce8;",items:[this.viewOrigin]});c=JSON.parse(this.suiteList);e=[];for(d=0;d<c.length;d++)-1==this.notAvailableSuiteList.indexOf(c[d].name)&&e.push(c[d]);d=Ext.create("Ext.data.Store",{fields:["suiteId","name","description"],data:e});this.viewSuite=Ext.create("Ext.view.View",
{store:d,selModel:{mode:"SINGLE",listeners:{selectionchange:function(){a.setFilter()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".list-item",tpl:'<tpl for="."><div class="list-item">{name}</div></tpl>'});d=Ext.create("Ext.panel.Panel",{title:"Search by suite",border:0,bodyPadding:5,items:[this.viewSuite]});this.searchField=Ext.create("Ext.form.field.Text",{id:this.searchFieldId,flex:1,emptyText:"enter search term",enableKeyEvents:!0,listeners:{scope:this,change:this.setFilter}});
d=Ext.create("Ext.panel.Panel",{minWidth:125,minHeight:370,flex:1,cls:"panel-border-right",border:!1,items:[b,d],tbar:{items:this.searchField}});this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){var b=a.grid.getSelectionModel().getSelection()[0];!0==a.retrieveData&&a.adapter.readData($.cookie("bioinfo_sid"),b.data.dataFiles[0].dataId,b.data.dataFiles[0].filename);a.onSelect.notify(b.data.dataFiles[0]);a.panel.close()}});this.panel=Ext.create("Ext.window.Window",
{title:"Browse Data",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[d,this.grid],buttonAlign:"right",buttons:[{text:"Close",handler:function(){a.panel.close()}},this.selectButton],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show();this.viewOrigin.getSelectionModel().select(this.viewOrigin.store.first());this.viewSuite.getSelectionModel().select(this.viewSuite.store.first())};
BrowserDataWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];this.gridStore.clearFilter();if(null!=b)switch(b.data.suiteId){case "Uploaded Data":this.gridStore.filter(function(a){return 0>a.data.jobId});break;case "Job Generated":this.gridStore.filter(function(a){return 0<a.data.jobId})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.gridStore.filter(function(a){return a.data.suiteId==
c.data.suiteId})}this.gridStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return 0>b.data.name.toLowerCase().indexOf(c)?!1:!0})};BrowserDataWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(-1<this.tags[b].indexOf("|")){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)-1<a.indexOf(c[e])&&(d=!0);if(!d)return!1}else if(-1==a.indexOf(this.tags[b]))return!1;return!0};
function ManageProjectsWidget(a){this.id="ManageProjectsWidget_"+Math.round(1E4*Math.random());this.title=this.targetId=null;this.width=880;this.height=420;this.suiteId=-1;this.args=a;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.suiteId))this.suiteId=a.suiteId;this.selectedItems={};this.lastSelectedItem=this.selectedProjectJobs=this.selectedProjectSuiteId=this.selectedProjectName=
this.selectedProjectId=null;this._storeProjects=Ext.create("Ext.data.Store",{fields:["name","projectId","jobs","active"],data:[]});this.deleting=!1;this.onRefreshProjectList=new Event}ManageProjectsWidget.prototype.draw=function(){var a=this;this._render();this._panel.show();this.refreshListProject();this.interval=setInterval(function(){a.refreshListProject()},4E3)};ManageProjectsWidget.prototype.getPanel=function(a){this._render("panel",a);return this._panel};
ManageProjectsWidget.prototype._render=function(a,b){var c=this;if(null==this._panel){var d=Ext.create("Ext.view.View",{id:this.id+"viewProject",store:this._storeProjects,selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b){0<b.length&&(null==b[0].data.jobs&&(b[0].data.jobs=[]),c.optionProjectClick(b[0].data))}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".list-item",tpl:'<tpl for="."><div class="list-item">{name}</div></tpl>'}),e=Ext.create("Ext.button.Button",
{text:"OK",handler:function(){c.optionProjectClick("newProject");j.toggleCollapse()}}),f=Ext.create("Ext.form.field.Text",{id:this.id+"newProjectNameField",width:210,emptyText:"name",allowBlank:!1}),g=Ext.create("Ext.form.field.TextArea",{id:this.id+"newProjectDescriptionField",width:210,emptyText:"description"});Ext.create("Ext.container.Container",{flex:1,layout:{type:"hbox",align:"stretch"},items:[f,g]});var j=Ext.create("Ext.panel.Panel",{title:"Create Project",bodyPadding:5,border:!1,items:[f,
g,e]}),e=Ext.create("Ext.form.field.Text",{flex:1,emptyText:"search project",enableKeyEvents:!0,listeners:{change:function(){var a=this.getValue().toLowerCase();c._storeProjects.clearFilter();c._storeProjects.filter(function(b){return 0>b.data.name.toLowerCase().indexOf(a)?!1:!0})}}}),f=Ext.create("Ext.button.Button",{id:this.id+"rBtn",iconCls:"icon-rename-project",tooltip:"Rename selected project",margin:"0 0 0 2",handler:function(){c.renameProject(c.selectedProjectId,c.selectedProjectName)}}),g=
Ext.create("Ext.button.Button",{id:this.id+"dBtn",iconCls:"icon-project-delete",tooltip:"Delete selected project",margin:"0 0 0 2",handler:function(){c.deleteProject(c.selectedProjectId,c.selectedProjectSuiteId,c.selectedProjectJobs)}}),h=Ext.create("Ext.button.Button",{id:this.id+"aBtn",iconCls:"icon-change-project",tooltip:"Active selected project",margin:"0 0 0 2",handler:function(){c.activeProject(c.selectedProjectId,c.selectedProjectName)}}),e=Ext.create("Ext.panel.Panel",{layout:"hbox",flex:1,
border:!1,items:[e,f,g,h]}),d=Ext.create("Ext.panel.Panel",{title:"Project list",flex:1,border:!1,autoScroll:!0,bodyPadding:5,items:[e,d]}),d=Ext.create("Ext.panel.Panel",{border:!1,minWidth:220,width:220,layout:"accordion",items:[d,j]});this._panel="panel"==a?Ext.create("Ext.panel.Panel",{title:"Manage projects",renderTo:b,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:d}):Ext.create("Ext.window.Window",{title:"Manage projects",iconCls:"icon-project-manager",resizable:!1,
minimizable:!1,constrain:!0,closable:!0,modal:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:d,listeners:{minimize:function(){c._panel.hide()},close:function(){clearInterval(c.interval);null!=c._panel.getComponent(1)&&(c._panel.getComponent(1).hide(),c._panel.remove(1,!1));delete c._panel}}})}};
ManageProjectsWidget.prototype.optionProjectClick=function(a){this.selectedItems={};var b=a.name;this.selectedProjectName!=b&&(this.lastSelectedItem=null);this.selectedProjectId=a.projectId;this.selectedProjectName=b;this.selectedProjectSuiteId=a.suiteId;this.selectedProjectJobs=a.jobs;null!=this._panel.getComponent(1)&&(this._panel.getComponent(1).hide(),this._panel.remove(1,!1));switch(a){case "newProject":this.createProject();break;default:this._panel.add(this.getByProjectGrid(a.jobs,b).show())}};
ManageProjectsWidget.prototype.getByProjectGrid=function(a,b){for(var c={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August","09":"September",10:"October",11:"November",12:"December"},d=null,e=[],f=0;f<a.length;f++)0<=a[f].visites&&(monthNumStr=a[f].creationTime.substr(5,2),d=parseInt(monthNumStr),a[f].creationMonth=a[f].creationTime.substr(0,4)+" - "+monthNumStr+" ("+c[d]+")",e.push(a[f]));null==this[b+"Grid"]&&(this[b+"Grid"]=this.doGrid([{header:"Name",dataIndex:"name",
flex:1},{header:"Launched on",dataIndex:"creationTime",flex:0.7},{header:"Tool name",dataIndex:"toolName",flex:1}],["name","creationTime","toolName","creationMonth","jobId"],b,"creationMonth"));if(null!=this.lastSelectedItem)var g=this.lastSelectedItem.data.jobId;this.deleting||this[b+"Grid"].store.loadData(e);null!=this.lastSelectedItem&&this[b+"Grid"].getSelectionModel().select(this[b+"Grid"].store.find("jobId",g));return this[b+"Grid"]};
ManageProjectsWidget.prototype.doGrid=function(a,b,c,d){var e=this;Ext.define(c,{extend:"Ext.data.Model",fields:b});b=Ext.create("Ext.data.Store",{groupField:d,sorters:[{property:"creationMonth",direction:"DESC"},{property:"creationTime",direction:"DESC"}],model:c});return Ext.create("Ext.grid.Panel",{id:this.id+c,store:b,title:"Jobs of project "+c,border:!1,cls:"panel-border-left",flex:3,multiSelect:!1,features:[{ftype:"grouping"}],columns:a,listeners:{selectionchange:function(a,b){if(null!=b[0]){e.selectedItems=
{};for(var c=0;c<b.length;c++)e.selectedItems[b[c].data.jobId]=b[c],e.lastSelectedItem=b[c]}}},tbar:[{id:"deleteButton",text:"Delete selected job",iconCls:"icon-delete",handler:function(){e.deleteJob(c)}}]})};
ManageProjectsWidget.prototype.deleteJob=function(a){var b=this;this.deleting=!0;Ext.Msg.confirm("Delete job","Are you sure you want to delete the selected job(s)?",function(c){"yes"==c&&(b[a+"Grid"].store.remove(b.lastSelectedItem),c=new WumAdapter,c.onDeleteJob.addEventListener(function(a,c){console.log("back from delete "+c.response);-1!=c.response.indexOf("OK")?b.deleting=!1:Ext.Msg.alert("Delete job","ERROR: could not delete job.")}),c.deleteJob(b.lastSelectedItem.data.jobId,$.cookie("bioinfo_sid")),
b.lastSelectedItem=null)})};
ManageProjectsWidget.prototype.createProject=function(){var a=this,b=Ext.getCmp(this.id+"newProjectNameField").getValue(),c=Ext.getCmp(this.id+"newProjectDescriptionField").getValue();if(""!=b){var d=new WumAdapter;d.onCreateProject.addEventListener(function(b,c){-1!=c.indexOf("ERROR")?Ext.Msg.alert("Create project","ERROR: could not create this project."):a.refreshListProject();a._panel.setLoading(!1);Ext.getBody().unmask()});Ext.getBody().mask();a._panel.setLoading("Creating project");d.createProject(b,
c,$.cookie("bioinfo_sid"))}};
ManageProjectsWidget.prototype.renameProject=function(a,b){var c=this,d=Ext.create("Ext.form.field.Text",{fieldLabel:"New name",labelWidth:70,width:200,minWidth:200,allowBlank:!1}),e=Ext.create("Ext.toolbar.TextItem",{padding:3,text:'<span class="info">Type the new project name</span>'});this.pan=Ext.create("Ext.panel.Panel",{bodyPadding:20,height:100,border:!1,bbar:{items:[e]},items:[d]});this.renameWindow=Ext.create("Ext.window.Window",{title:"Rename project "+b,resizable:!1,closable:!0,constrain:!0,
modal:!0,items:this.pan,buttons:["->",{text:"Ok",handler:function(){var b=d.getValue();if(""!=b){var e=new WumAdapter;e.onRenameProject.addEventListener(function(a,d){-1!=d.indexOf("OK")?(Ext.getCmp(c.id+c.selectedProjectName).setTitle("Jobs of project "+b),c.refreshListProject()):Ext.Msg.alert("Rename project","ERROR: could not rename this project.")});e.renameProject(a,b,$.cookie("bioinfo_sid"));c.renameWindow.close()}}}]});this.renameWindow.show()};
ManageProjectsWidget.prototype.deleteProject=function(a,b){var c=this;Ext.Msg.confirm("Delete project","Are you sure you want to delete this project?",function(d){"yes"==d&&(d=new WumAdapter,d.onDeleteProject.addEventListener(function(a,b){-1!=b.indexOf("OK")?(c.refreshListProject(),null!=c._panel.getComponent(1)&&(c._panel.getComponent(1).hide(),c._panel.remove(1,!1))):Ext.Msg.alert("Delete project","ERROR: could not delete this project. Project must not have jobs to be deleted.");c._panel.setLoading(!1);
Ext.getBody().unmask()}),Ext.getBody().mask(),c._panel.setLoading("Deleting project"),d.deleteProject(a,$.cookie("bioinfo_sid"),b))})};
ManageProjectsWidget.prototype.refreshListProject=function(){var a=this,b=new WumAdapter;b.onListProject.addEventListener(function(b,d){d=JSON.parse(d);a._storeProjects.loadData(d);for(var e=null,f=[],g=0;g<d.length;g++)f.push({name:d[g].name,projectId:d[g].projectId}),d[g].active&&(e=d[g].projectId,a.selectedProjectName=d[g].name);null==a.selectedProjectId&&(a.selectedProjectId=e);a._panel.setTitle('Manage projects - <b class="err">'+a.selectedProjectName+"</b>");e=a._storeProjects.find("projectId",
a.selectedProjectId);Ext.getCmp(a.id+"viewProject").getSelectionModel().select(e);a.onRefreshProjectList.notify(f)});b.listProject($.cookie("bioinfo_sid"),a.suiteId)};
ManageProjectsWidget.prototype.activeProject=function(a,b){var c=this,d=new WumAdapter;d.onActiveProject.addEventListener(function(a,d){-1!=d.indexOf("ERROR")?Ext.Msg.alert("Create project","ERROR: could not active this project."):(Ext.getCmp("UserBarWidget__spltbtnActiveProjectID").setText('<b class="emph">'+b+"</b>"),c._panel.setTitle('Manage projects - <b class="err">'+b+"</b>"));c._panel.setLoading(!1);Ext.getBody().unmask()});Ext.getBody().mask();this._panel.setLoading("Loading project");d.activeProject(a,
$.cookie("bioinfo_sid"))};
function CheckBrowser(a){var b=!1;switch(a){case "renato":16<=Ext.chromeVersion&&(b=!0);5<=Ext.safariVersion&&(b=!0);10<=Ext.firefoxVersion&&(b=!0);break;case "variant":16<=Ext.chromeVersion&&(b=!0);5<=Ext.safariVersion&&(b=!0);10<=Ext.firefoxVersion&&(b=!0);break;default:14<=Ext.chromeVersion&&(b=!0),5<=Ext.safariVersion&&(b=!0)}!1==b&&(console.log("--------------------------------------------"+b),$("#checkBrowser").html("Genome Maps provides the best user experience with Google Chrome and Apple Safari, otherwise some latencies may be experienced when browsing due to some problems in Firefox.").css("width","540px").css("height",
"40px").css("position","absolute").css("margin-left","300px").css("margin-top","26px").css("padding","5px").css("border","1px solid #F1D031").css("background","#FFFFA3").css("color","#555").css("position","absolute").css("z-index","50000").click(function(){$("#checkBrowser").fadeOut(function(){$(this).remove()})}))}
function WumAdapter(){this.adapter=new WumRestAdapter;this.onGetJobs=this.adapter.onGetJobs;this.onGetData=this.adapter.onGetData;this.onReadData=this.adapter.onReadData;this.onGetUserInfo=this.adapter.onGetUserInfo;this.onActiveProject=this.adapter.onActiveProject;this.onCreateProject=this.adapter.onCreateProject;this.onDeleteProject=this.adapter.onDeleteProject;this.onRenameProject=this.adapter.onRenameProject;this.onListProject=this.adapter.onListProject;this.onLogin=this.adapter.onLogin;this.onLoginError=
this.adapter.onLoginError;this.onRegister=this.adapter.onRegister;this.onRegisterError=this.adapter.onRegisterError;this.onReset=this.adapter.onReset;this.onResetError=this.adapter.onResetError;this.onEditPassword=this.adapter.onEditPassword;this.onLogout=this.adapter.onLogout;this.onJobResult=this.adapter.onJobResult;this.onDownload=this.adapter.onDownload;this.onDeleteJob=this.adapter.onDeleteJob;this.onPoll=this.adapter.onPoll;this.onTable=this.adapter.onTable;this.onGrep=this.adapter.onGrep;this.onSuiteList=
this.adapter.onSuiteList;this.onError=this.adapter.onError}WumAdapter.prototype.getJobs=function(a){this.adapter.getJobs(a)};WumAdapter.prototype.getData=function(a,b){this.adapter.getData(a,b)};WumAdapter.prototype.readData=function(a,b,c){this.adapter.readData(a,b,c)};WumAdapter.prototype.getUserInfo=function(a){this.adapter.getUserInfo(a)};WumAdapter.prototype.activeProject=function(a,b){this.adapter.activeProject(a,b)};
WumAdapter.prototype.createProject=function(a,b,c){this.adapter.createProject(a,b,c)};WumAdapter.prototype.deleteProject=function(a,b,c){this.adapter.deleteProject(a,b,c)};WumAdapter.prototype.renameProject=function(a,b,c){this.adapter.renameProject(a,b,c)};WumAdapter.prototype.listProject=function(a,b){this.adapter.listProject(a,b)};WumAdapter.prototype.login=function(a,b,c){this.adapter.login(a,b,c)};WumAdapter.prototype.register=function(a,b,c){this.adapter.register(a,b,c)};
WumAdapter.prototype.reset=function(a){this.adapter.reset(a)};WumAdapter.prototype.editPassword=function(a,b,c){this.adapter.editPassword(a,b,c)};WumAdapter.prototype.logout=function(a){this.adapter.logout(a)};WumAdapter.prototype.jobResult=function(a,b,c){this.adapter.jobResult(a,b,c)};WumAdapter.prototype.download=function(a,b){this.adapter.download(a,b)};WumAdapter.prototype.deleteJob=function(a,b){this.adapter.deleteJob(a,b)};
WumAdapter.prototype.poll=function(a,b,c,d){this.adapter.poll(a,b,c,d)};WumAdapter.prototype.pollurl=function(a,b,c){return this.adapter.pollurl(a,b,c)};WumAdapter.prototype.table=function(a,b,c,d,e){this.adapter.table(a,b,c,d,e)};WumAdapter.prototype.tableurl=function(a,b,c,d,e){return this.adapter.tableurl(a,b,c,d,e)};WumAdapter.prototype.grep=function(a,b,c,d,e){return this.adapter.grep(a,b,c,d,e)};WumAdapter.prototype.getSuiteList=function(){this.adapter.getSuiteList()};
WumAdapter.prototype.getHost=function(){return this.adapter.getHost()};WumAdapter.prototype.setHost=function(a){return this.adapter.setHost(a)};
function WumRestAdapter(){this.host="http://ws.bioinfo.cipf.es/wum/rest";if(-1!=window.location.host.indexOf("fsalavert")||-1!=window.location.host.indexOf("rsanchez")||-1!=window.location.host.indexOf("imedina")||-1!=window.location.href.indexOf("http://bioinfo.cipf.es/apps-beta"))this.host="http://ws-beta.bioinfo.cipf.es/wum/rest";null!=$.url().param("p")&&(this.host="http://ws.bioinfo.cipf.es/wum/rest");WUMHOST=this.host;this.onGetData=new Event(this);this.onReadData=new Event(this);this.onGetJobs=
new Event(this);this.onJobResult=new Event(this);this.onPoll=new Event(this);this.onDownload=new Event(this);this.onDeleteJob=new Event(this);this.onTable=new Event(this);this.onGrep=new Event(this);this.onActiveProject=new Event(this);this.onCreateProject=new Event(this);this.onDeleteProject=new Event(this);this.onRenameProject=new Event(this);this.onListProject=new Event(this);this.onSuiteList=new Event(this);this.onGetUserInfo=new Event(this);this.onLogin=new Event(this);this.onLoginError=new Event(this);
this.onRegister=new Event(this);this.onRegisterError=new Event(this);this.onReset=new Event(this);this.onResetError=new Event(this);this.onEditPassword=new Event(this);this.onLogout=new Event(this);this.onError=new Event(this)}WumRestAdapter.prototype.getData=function(a,b){var c=this,d=this.getHost()+"/data/list?sessionid="+a+"&suiteid="+b;this.doGet(d,function(a){c.onGetData.notify(a)},function(a){console.log("ERROR: "+a);console.log(a)})};
WumRestAdapter.prototype.readData=function(a,b,c){var d=this,a=this.getHost()+"/data/"+b+"/read?sessionid="+a+"&filename="+c;this.filename=c;this.doGet(a,function(a){d.onReadData.notify({data:a,filename:d.filename})},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.getJobs=function(a){var b=this,a=this.getHost()+"/job/list?sessionid="+a;this.doGet(a,function(a){b.onGetJobs.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.jobResult=function(a,b,c){var d=this,a=this.getHost()+"/job/"+a+"/result."+b+"?incvisites=true&sessionid="+c;this.doGet(a,function(a){d.onJobResult.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.download=function(a,b){var c=this.getHost()+"/job/"+a+"/download?sessionid="+b;open(c)};
WumRestAdapter.prototype.deleteJob=function(a,b){var c=this,d=this.getHost()+"/job/"+a+"/delete?sessionid="+b;this.doGet(d,function(b){c.onDeleteJob.notify({response:b,jobId:a})},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.poll=function(a,b,c,d){var e=this;!0==c?(a=this.getHost()+"/job/"+a+"/poll?sessionid="+d+"&filename="+b,open(a)):(a=this.getHost()+"/job/"+a+"/poll?sessionid="+d+"&filename="+b+"&zip=false",this.doGet(a,function(a){e.onPoll.notify(a)},function(a){console.log("ERROR: "+a)}))};WumRestAdapter.prototype.pollurl=function(a,b,c){return this.getHost()+"/job/"+a+"/poll?sessionid="+c+"&filename="+b+"&zip=false"};
WumRestAdapter.prototype.table=function(a,b,c,d,e){var f=this,a=this.getHost()+"/job/"+a+"/table?sessionid="+e+"&filename="+b+"&colNames="+c+"&colVisibility="+d;this.doGet(a,function(a){f.onTable.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.tableurl=function(a,b,c,d,e){return this.getHost()+"/job/"+a+"/table?sessionid="+e+"&filename="+b+"&colNames="+c+"&colVisibility="+d};
WumRestAdapter.prototype.grep=function(a,b,c,d,e){var f=this,a=this.getHost()+"/job/"+a+"/grep?&filename="+b+"&pattern="+c+"&ignorecase="+d+"&sessionid="+e;this.doGet(a,function(a){f.onGrep.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.activeProject=function(a,b){var c=this,d=this.getHost()+"/project/"+a+"/active?sessionid="+b;this.doGet(d,function(a){c.onActiveProject.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.createProject=function(a,b,c){var d=this,a=this.getHost()+"/project/create?projectname="+a+"&description="+b+"&sessionid="+c;this.doGet(a,function(a){d.onCreateProject.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.deleteProject=function(a,b,c){var d=this,a=this.getHost()+"/project/"+a+"/delete?sessionid="+b+"&suiteid="+c;this.doGet(a,function(a){d.onDeleteProject.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.renameProject=function(a,b,c){var d=this,a=this.getHost()+"/project/"+a+"/rename?projectname="+b+"&sessionid="+c;this.doGet(a,function(a){d.onRenameProject.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.listProject=function(a,b){var c=this,d=this.getHost()+"/project/list?sessionid="+a+"&suiteid="+b;this.doGet(d,function(a){c.onListProject.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.getSuiteList=function(){var a=this,b=this.getHost()+"/suite/list";this.doGet(b,function(b){a.onSuiteList.notify(b)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.getUserInfo=function(a){var b=this,a=this.getHost()+"/user/info?sessionid="+a;this.doGet(a,function(a){b.onGetUserInfo.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.login=function(a,b,c){var d=this,a=this.getHost()+"/user/login?email="+a+"&password="+b+"&suiteid="+c;console.log(a);this.doGet(a,function(a){d.onLogin.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.register=function(a,b,c){var d=this,a=this.getHost()+"/user/register?email="+a+"&password="+b+"&suiteid="+c;this.doGet(a,function(a){d.onRegister.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.reset=function(a){var b=this,a=this.getHost()+"/user/password/reset?email="+a;this.doGet(a,function(a){b.onReset.notify(a)},function(a){console.log("ERROR: "+a)})};WumRestAdapter.prototype.editPassword=function(a,b,c){var d=this,a=this.getHost()+"/user/password/change?sessionid="+c+"&password="+a+"&newpass="+b;this.doGet(a,function(a){d.onEditPassword.notify(a)},function(a){console.log("ERROR: "+a)})};
WumRestAdapter.prototype.logout=function(a){var b=this,a=this.getHost()+"/user/logout?sessionid="+a;this.doGet(a,function(a){b.onLogout.notify(a)},function(a){$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"});console.log("ERROR: "+a)})};WumRestAdapter.prototype.doGet=function(a,b,c,d){d||(d="application/x-www-form-urlencoded");$.ajax({type:"GET",url:a,dataType:"text",cache:!1,success:b,error:c,contentType:d})};WumRestAdapter.prototype.getHost=function(){return this.host};
WumRestAdapter.prototype.setHost=function(a){this.host=a};
function FileWidget(a){var b=this;this.targetId=null;this.id="FileWidget_"+Math.round(1E5*Math.random());this.wum=!0;this.tags=[];this.args=a;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title,this.id=this.title+this.id),null!=a.wum&&(this.wum=a.wum),null!=a.tags&&(this.tags=a.tags),null!=a.viewer))this.viewer=a.viewer;this.dataAdapter=null;this.onOk=new Event(this);this.browserData=new BrowserDataWidget;this.browserData.onSelect.addEventListener(function(a,
d){b.trackNameField.setValue(d.filename);b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.panel.setLoading()});this.browserData.adapter.onReadData.addEventListener(function(a,d){console.log(d);b.trackNameField.setValue(d.filename);b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.loadFileFromServer(d);b.panel.setLoading(!1)});this.chartWidgetByChromosome=new ChartWidget({height:200,
width:570})}FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()};FileWidget.prototype.getFileFromServer=function(){};FileWidget.prototype.loadFileFromLocal=function(){};FileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};
FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.name);a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1);a.loadFileFromLocal(b);
a.panel.setLoading(!1)}}}})};
FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'});b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add(this.getFileUpload());this.panel=Ext.create("Ext.panel.Panel",{border:!1,cls:"panel-border-top panel-border-bottom",height:230,title:"Previsualization",items:this.getChartItems(),
bbar:b});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});b=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,handler:function(){a.browserData.draw($.cookie("bioinfo_sid"),a.tags)}}),c.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?
this.sessionInitiated():this.sessionFinished());this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'});c.add(["->",this.fileNameLabel]);this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.onOk.notify({fileName:a.file.name,adapter:a.adapter});a.openDialog.close()}});this.openDialog=Ext.create("Ext.ux.Window",{title:"Open "+this.title+
" file",taskbar:Ext.getCmp(this.args.viewer.id+"uxTaskbar"),width:600,resizable:!1,items:[c,this.panel,b],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()};
FileWidget.prototype._loadChartInfo=function(){var a=[],b;for(b in this.adapter.featuresByChromosome)a.push({features:this.adapter.featuresByChromosome[b],chromosome:b});this.chartWidgetByChromosome.getStore().loadData(a);this.panel.setLoading(!1);this.featureCountLabel.setText("Features count: "+this.adapter.featuresCount,!1)};FileWidget.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};FileWidget.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
function LegendWidget(a){this.height=this.width=300;this.title="Legend";if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height;this.legendPanel=new LegendPanel}
LegendWidget.prototype.draw=function(a){var b=this;null==this.panel&&(a=this.legendPanel.getPanel(a),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:a.width+10,height:a.height+70,items:[a],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]}));this.panel.show()};
function LegendPanel(a){this.width=200;this.height=250;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height}
LegendPanel.prototype.getColorItems=function(a){panelsArray=[];for(var b in a){var c=Ext.create("Ext.draw.Component",{width:15,height:15,items:[{type:"rect",fill:a[b],x:0,y:0,width:15,height:15}]}),d=b.replace(/_/gi," "),d=d.charAt(0).toUpperCase()+d.slice(1),c=Ext.create("Ext.panel.Panel",{height:15,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[c,{xtype:"tbtext",text:d,margin:"1 0 0 3"}]});panelsArray.push(c)}return panelsArray};
LegendPanel.prototype.getPanel=function(a){null==this.panel&&(a=this.getColorItems(a),this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:a,width:this.width,height:20*a.length}));return this.panel};LegendPanel.prototype.getButton=function(a){null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{items:[this.getPanel(a)]}}));return this.button};
function UrlWidget(a){this.id="UrlWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.title="Custom url";this.width=500;this.height=400;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height;this.onAdd=new Event(this)}UrlWidget.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}});this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasAdapter({url:a.urlField.getValue(),
featureCache:{gzip:!1,chunkSize:1E4}});b.onCheckUrl.addEventListener(function(b,d){console.log(d.data);a.contentArea.setValue(d.data);a.form.setLoading(!1)});b.onError.addEventListener(function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin");a.form.setLoading(!1)});b.checkUrl()}});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",
flex:1});this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]});this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height});this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]});this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,
this.panelSettings]});this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.onAdd.notify({name:a.trackNameField.getValue(),url:a.urlField.getValue()});a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})};GV_CELLBASE_HOST="http://ws.bioinfo.cipf.es/cellbase/rest";
GENE_BIOTYPE_COLORS={"3prime_overlapping_ncrna":"Orange",ambiguous_orf:"SlateBlue",antisense:"SteelBlue",disrupted_domain:"YellowGreen",IG_C_gene:"#FF7F50",IG_D_gene:"#FF7F50",IG_J_gene:"#FF7F50",IG_V_gene:"#FF7F50",lincRNA:"#8b668b",miRNA:"#8b668b",misc_RNA:"#8b668b",Mt_rRNA:"#8b668b",Mt_tRNA:"#8b668b",ncrna_host:"Fuchsia",nonsense_mediated_decay:"Chartreuse",non_coding:"orangered",non_stop_decay:"aqua",polymorphic_pseudogene:"#666666",processed_pseudogene:"#666666",processed_transcript:"#0000ff",
protein_coding:"#a00000",pseudogene:"#666666",retained_intron:"gold",retrotransposed:"lightsalmon",rRNA:"LawnGreen",sense_intronic:"#20B2AA",sense_overlapping:"#20B2AA",snoRNA:"#8b668b",snRNA:"#8b668b",transcribed_processed_pseudogene:"#666666",transcribed_unprocessed_pseudogene:"#666666",unitary_pseudogene:"#666666",unprocessed_pseudogene:"#666666","":"orangered",other:"#000000"};
SNP_BIOTYPE_COLORS={"2KB_upstream_variant":"#a2b5cd","5KB_upstream_variant":"#a2b5cd","500B_downstream_variant":"#a2b5cd","5KB_downstream_variant":"#a2b5cd","3_prime_UTR_variant":"#7ac5cd","5_prime_UTR_variant":"#7ac5cd",coding_sequence_variant:"#458b00",complex_change_in_transcript:"#00fa9a",frameshift_variant:"#ff69b4",incomplete_terminal_codon_variant:"#ff00ff",inframe_codon_gain:"#ffd700",inframe_codon_loss:"#ffd700",initiator_codon_change:"#ffd700",non_synonymous_codon:"#ffd700",intergenic_variant:"#636363",
intron_variant:"#02599c",mature_miRNA_variant:"#458b00",nc_transcript_variant:"#32cd32",splice_acceptor_variant:"#ff7f50",splice_donor_variant:"#ff7f50",splice_region_variant:"#ff7f50",stop_gained:"#ff0000",stop_lost:"#ff0000",stop_retained_variant:"#76ee00",synonymous_codon:"#76ee00",other:"#000000"};SEQUENCE_COLORS={A:"#009900",C:"#0000FF",G:"#857A00",T:"#aa0000",N:"#555555"};
SAM_FLAGS=[["read paired",1],["read mapped in proper pair",2],["read unmapped",4],["mate unmapped",8],["read reverse strand",16],["mate reverse strand",32],["first in pair",64],["second in pair",128],["not primary alignment",256],["read fails platform/vendor quality checks",512],["read is PCR or optical duplicate",1024]];
FEATURE_TYPES={formatTitle:function(a){a=a.replace(/_/gi," ");return a=a.charAt(0).toUpperCase()+a.slice(1)},getTipCommons:function(a){return'start-end:&nbsp;<span class="emph">'+a.start+"-"+a.end+'</span><br>strand:&nbsp;<span class="emph">'+(null!=a.strand?a.strand:"NA")+'</span><br>length:&nbsp;<span class="info">'+(a.end-a.start+1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"</span><br>"},sequence:{color:SEQUENCE_COLORS},undefined:{getLabel:function(a){return a=""+(a.chromosome+":"+
a.start+"-"+a.end)},getTipTitle:function(){return" "},getTipText:function(){return" "},getColor:function(){return"grey"},height:10},gene:{getLabel:function(a){var b;b=""+(0>a.strand?"<":"");b+=" "+a.externalName+" ";b+=0<a.strand?">":"";return b+=" ["+a.biotype+"]"},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.externalName+"</span>"},getTipText:function(a){return'Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+a.stableId+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+
GENE_BIOTYPE_COLORS[a.biotype]+';">'+a.biotype+'</span><br>description:&nbsp;<span class="emph">'+a.description+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"stableId",height:4,histogramColor:"lightblue"},geneorange:{getLabel:function(a){var b;b=""+(0>a.strand?"<":"");b+=" "+a.externalName+" ";b+=0<a.strand?">":"";return b+=" ["+a.biotype+"]"},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+
' - <span class="ok">'+a.externalName+"</span>"},getTipText:function(a){return'Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+a.stableId+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+GENE_BIOTYPE_COLORS[a.biotype]+';">'+a.biotype+'</span><br>description:&nbsp;<span class="emph">'+a.description+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"stableId",height:4,
histogramColor:"lightblue"},transcript:{getLabel:function(a){var b;b=""+(0>a.strand?"<":"");b+=" "+a.externalName+" ";b+=0<a.strand?">":"";return b+=" ["+a.biotype+"]"},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.externalName+"</span>"},getTipText:function(a){return'Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+a.stableId+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+GENE_BIOTYPE_COLORS[a.biotype]+';">'+a.biotype+'</span><br>description:&nbsp;<span class="emph">'+
a.description+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"stableId",height:4,histogramColor:"lightblue"},exon:{getLabel:function(a){return a=""+a.stableId},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.exon.featureType)+' - <span class="ok">'+a.exon.stableId+"</span>"},getTipText:function(a,b){return'transcript name:&nbsp;<span class="ssel">'+b.externalName+'</span><br>transcript Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+
b.stableId+'</span><br>transcript biotype:&nbsp;<span class="emph" style="color:'+GENE_BIOTYPE_COLORS[b.biotype]+';">'+b.biotype+'</span><br>transcript description:&nbsp;<span class="emph">'+b.description+'</span><br>transcript start-end:&nbsp;<span class="emph">'+b.start+"-"+b.end+'</span><br>exon start-end:&nbsp;<span class="emph">'+a.exon.start+"-"+a.exon.end+'</span><br>strand:&nbsp;<span class="emph">'+b.strand+'</span><br>length:&nbsp;<span class="info">'+(a.exon.end-a.exon.start+1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,
"$1,")+"</span><br>"},getColor:function(){return"black"},infoWidgetId:"stableId",height:4,histogramColor:"lightblue"},snp:{getLabel:function(a){return a.name},getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.name+"</span>"},getTipText:function(a){return'alleles:&nbsp;<span class="ssel">'+a.alleleString+'</span><br>ancestral allele:&nbsp;<span class="ssel">'+a.ancestralAllele+'</span><br>SO consequence:&nbsp;<span class="emph" style="color:'+SNP_BIOTYPE_COLORS[a.displaySoConsequence]+
';">'+a.displaySoConsequence+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(a){return SNP_BIOTYPE_COLORS[a.displaySoConsequence]},infoWidgetId:"name",height:10,histogramColor:"orange"},cpg_island:{getLabel:function(a){return a.name},getTipTitle:function(a){return'CpG island - <span class="ok">'+a.name+"</span>"},getTipText:function(a){return'CpG number:&nbsp;<span class="ssel">'+a.cpgNum+'</span><br>CpG precentage:&nbsp;<span class="ssel">'+
a.perCpG+'</span><br>CG number:&nbsp;<span class="ssel">'+a.gcNum+'</span><br>CG percentage:&nbsp;<span class="ssel">'+a.perGc+'</span><br>observed-expected ratio:&nbsp;<span class="ssel">'+a.observedExpectedRatio+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"Aquamarine"},infoWidgetId:"name",height:8,histogramColor:"Aquamarine"},mutation:{getLabel:function(a){return a.mutationCds},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+
a.mutationCds+"</span>"},getTipText:function(a){return'mutation CDS:&nbsp;<span class="ssel">'+a.mutationCds+'</span><br>mutation Aa:&nbsp;<span class="ssel">'+a.mutationAa+'</span><br>mutation description:&nbsp;<span class="ssel">'+a.mutationDescription+'</span><br>primary histology:&nbsp;<span class="ssel">'+a.primaryHistology+'</span><br>primary site:&nbsp;<span class="ssel">'+a.primarySite+'</span><br>site subtype:&nbsp;<span class="ssel">'+a.siteSubtype+'</span><br>gene name:&nbsp;<span class="ssel">'+
a.geneName+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"Chartreuse"},infoWidgetId:"name",height:10,histogramColor:"Chartreuse"},structural_variation:{getLabel:function(a){return a.displayId},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.displayId+"</span>"},getTipText:function(a){return'display ID:&nbsp;<span class="ssel">'+a.displayId+'</span><br>SO term:&nbsp;<span class="ssel">'+
a.soTerm+'</span><br>study description:&nbsp;<span class="emph">'+a.studyDescription+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"indigo"},infoWidgetId:"name",height:8,histogramColor:"indigo"},tfbs:{getLabel:function(a){return a.tfName},getTipTitle:function(a){return'TFBS - <span class="ok">'+a.tfName+"</span>"},getTipText:function(a){return'TF name:&nbsp;<span class="ssel">'+a.tfName+'</span><br>relative start:&nbsp;<span class="ssel">'+
a.relativeStart+'</span><br>relative end:&nbsp;<span class="ssel">'+a.relativeEnd+'</span><br>target gene name:&nbsp;<span class="ssel">'+a.targetGeneName+'</span><br>score:&nbsp;<span class="ssel">'+a.score+'</span><br>sequence:&nbsp;<span class="ssel">'+a.sequence+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"blue"},infoWidgetId:"name",height:8,histogramColor:"blue"},mirna_target:{getLabel:function(a){return a.mirbaseId},
getTipTitle:function(a){return'miRNA target - <span class="ok">'+a.mirbaseId+"</span>"},getTipText:function(a){return'gene target name:&nbsp;<span class="ssel">'+a.geneTargetName+'</span><br>experimental method:&nbsp;<span class="ssel">'+a.experimentalMethod+'</span><br>score:&nbsp;<span class="ssel">'+a.score+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"#8b668b"},infoWidgetId:"name",height:8,histogramColor:"#8b668b"},
conserved_region:{getLabel:function(a){return a.conservedRegionId},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.conservedRegionId+"</span>"},getTipText:function(a){return'method:&nbsp;<span class="ssel">'+a.method+'</span><br>data range primate:&nbsp;<span class="ssel">'+a.dataRangePrimate+'</span><br>lower limit primate:&nbsp;<span class="ssel">'+a.lowerLimitPrimate+'</span><br>sumData primate:&nbsp;<span class="ssel">'+a.sumDataPrimate+'</span><br>sumSquare primate:&nbsp;<span class="ssel">'+
a.sumSquarePrimate+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"DodgerBlue"},infoWidgetId:"name",height:8,histogramColor:"DodgerBlue"},file:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)},getTipText:function(a){return FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:10,histogramColor:"orange"},vcf:{getLabel:function(a){try{var b=a.sampleData.split("\t")}catch(c){console.log(c);
debugger}if(10<b.length||9==b.length)return a.id+" "+a.ref+"/"+a.alt+"";b=b[9].split(":")[0];if(-1!=b.indexOf(".")||-1!=b.indexOf("-"))return b;var d="",e=a.alt.split(",");if("0"==b.charAt(0))d=a.ref;else var f=b.charAt(0)-1,d=e[f];d+=b.charAt(1);"0"==b.charAt(2)?d+=a.ref:(f=b.charAt(2)-1,d+=e[f]);return d},getTipTitle:function(a){return'VCF variant - <span class="ok">'+a.id+"</span>"},getTipText:function(a){return'alleles (ref/alt):&nbsp;<span class="emph">'+a.ref+"/"+a.alt+'</span><br>quality:&nbsp;<span class="emph">'+
a.quality+'</span><br>filter:&nbsp;<span class="emph">'+a.filter+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},infoWidgetId:"id",height:10,histogramColor:"gray"},gff2:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.label+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="emph">'+a.score+'</span><br>frame:&nbsp;<span class="emph">'+a.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},
getColor:function(){return"black"},height:10,histogramColor:"gray"},gff3:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.label+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="emph">'+a.score+'</span><br>frame:&nbsp;<span class="emph">'+a.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:10,histogramColor:"gray"},gtf:{getLabel:function(a){return a=""+a.label},
getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.label+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="emph">'+a.score+'</span><br>frame:&nbsp;<span class="emph">'+a.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:10,histogramColor:"gray"},bed:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)},getTipText:function(a){return FEATURE_TYPES.getTipCommons(a)},
getColor:function(a){var b=[],b=a.itemRgb.split(","),a=function(a){var b="0123456789abcdef".split("");return isNaN(a)?"00":b[(a-a%16)/16]+b[a%16]};return"#"+(a(b[0])+a(b[1])+a(b[2]))},height:10,histogramColor:"orange"},bam:{explainFlags:function(a){for(var b='<div style="background:#FFEF93;font-weight:bold;margin:0 15px 0 0;">flags : <span class="ssel">'+a+"</span></div>",c=0;c<SAM_FLAGS.length;c++)SAM_FLAGS[c][1]&a&&(b+=SAM_FLAGS[c][0]+"<br>");return b},getLabel:function(a){return"bam  "+a.chromosome+
":"+a.start+"-"+a.end},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.name+"</span>"},getTipText:function(a){a.strand=FEATURE_TYPES.bam.getStrand(a);var b='cigar:&nbsp;<span class="ssel">'+a.cigar+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+"<br>"+FEATURE_TYPES.bam.explainFlags(a.flags),c='<div style="background:#FFEF93;font-weight:bold;">attributes</div>';delete a.attributes.BQ;for(var d in a.attributes)c+=d+":"+a.attributes[d]+"<br>";return'<div style="float:left">'+
b+'</div><div style="float:right">'+c+"</div>"},getColor:function(a){return 0==(parseInt(a.flags)&16)?"DarkGray":"LightGray"},getStrand:function(a){return 0==(parseInt(a.flags)&16)?"Forward":"Reverse"},height:10,histogramColor:"grey"},das:{getLabel:function(a){return a=""+a.id},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)},getTipText:function(a){return FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:10,histogramColor:"orange"}};
function FeatureBinarySearchTree(){this._root=null}
FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(a){var a={value:a,left:null,right:null},b;if(null===this._root)return this._root=a,!0;for(b=this._root;;)if(a.value.end<b.value.start){if(null===b.left)return b.left=a,!0;b=b.left}else if(a.value.start>b.value.end){if(null===b.right)return b.right=a,!0;b=b.right}else return!1},contains:function(a){for(var b=!1,c=this._root;!b&&c;)a.end<c.value.start?c=c.left:a.start>c.value.end?c=c.right:b=!0;return b}};
function GenomeViewer(a,b,c){var d=this;this.id="GenomeViewer"+Math.round(1E4*Math.random());this.menuBar=null;this.width=$(document).width();this.height=$(document).height();this.targetId=null;this.species="hsa";this.speciesName="Homo sapiens";this.increment=5;this.zoom=100;null!=a&&(this.targetId=a);null!=b&&(this.species=b.species,this.speciesName=b.name,this.chromosome=b.chromosome,this.position=parseInt(b.position));if(null!=c&&(null!=c.toolbar&&(this.toolbar=c.toolbar),null!=c.width&&(this.width=
c.width),null!=c.height&&(this.height=c.height),null!=c.availableSpecies&&this.setSpeciesMenu(c.availableSpecies),null!=c.chromosome&&(this.chromosome=c.chromosome),null!=c.position&&(this.position=parseInt(c.position)),null!=c.zoom))this.zoom=c.zoom;this.onSpeciesChange=new Event;this.onLocationChange=new Event;this.afterLocationChange=new Event;this.afterRender=new Event;this.onLocationChange.addEventListener(function(a,b){d.setLoc(b)});this.onSvgRemoveTrack=null;console.log(this.width+"x"+this.height);
console.log(this.targetId);console.log(this.id)}GenomeViewer.prototype.draw=function(){this.render()};
GenomeViewer.prototype.render=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.id+"container",renderTo:this.targetId,width:this.width,height:this.height,cls:"x-unselectable",layout:{type:"vbox",align:"stretch"},region:"center",margins:"0 0 0 0"});null!=this.toolbar&&b.insert(0,this.toolbar);var c=this._drawTracksPanel(),d=this._drawRegionPanel(),e=0,f=function(){var b=$("#"+a.id+"tracksSvg")[0];a.trackSvgLayout=new TrackSvgLayout(b,{width:a.width-18,position:a.position,chromosome:a.chromosome,
zoom:a.zoom});a.trackSvgLayout.onMove.addEventListener(function(b,c){a.onLocationChange.notify({position:c,sender:"trackSvgLayout"})});a.trackSvgLayout.onMousePosition.addEventListener(function(b,c){var d=c.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");Ext.getCmp(a.id+"mouseLabel").setText('<span class="ssel">Position: '+d+"</span>");$("#"+a.id+"mouseLabel").qtip({content:"Mouse position",style:{width:95},position:{my:"bottom center",at:"top center"}})});Ext.getCmp(a.id+"windowSize").setText('<span class="emph">'+
a.trackSvgLayout.windowSize+"</span>");a.trackSvgLayout.onWindowSize.addEventListener(function(b,c){Ext.getCmp(a.id+"windowSize").setText('<span class="emph">'+c.windowSize+"</span>")});a.trackSvgLayout.onTracksRendered.addEventListener(function(){});a.onSvgRemoveTrack=a.trackSvgLayout.onSvgRemoveTrack;b=$("#"+a.id+"regionSvg")[0];a.trackSvgLayout2=new TrackSvgLayout(b,{width:a.width-18,position:a.position,chromosome:a.chromosome,zoom:a.zoom,zoomOffset:40,parentLayout:a.trackSvgLayout});a.afterRender.notify()};
c.on("afterrender",function(){e++;1<e&&f()});d.on("afterrender",function(){e++;1<e&&f()});b.insert(1,this._getNavigationBar());b.insert(2,this._drawKaryotypePanel().hide());b.insert(3,this._drawChromosomePanel());b.insert(4,c);b.insert(5,this._getBottomBar());b.insert(4,d);Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position))};
GenomeViewer.prototype.setMenuBar=function(a){this.toolbar=a};GenomeViewer.prototype.setSize=function(a,b){this.trackSvgLayout.setWidth(a-18);this.trackSvgLayout2.setWidth(a-18);this.chromosomeWidget.setWidth(a);this.karyotypeWidget.setWidth(a);Ext.getCmp(this.id+"container").setSize(a,b)};
GenomeViewer.prototype.setLoc=function(a){console.log("GV SetLoc sender: "+a.position);switch(a.sender){case "setSpecies":this.species=a.species;this.speciesName=a.name;this.position=a.position;this.chromosome=a.chromosome;Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));Ext.getCmp(this.id+"speciesMenuButton").setText(this.speciesName);
Ext.example.msg("Species",this.speciesName+" selected.");this._updateChrStore();this.trackSvgLayout.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});this.trackSvgLayout2.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});this.chromosomeWidget.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});this.karyotypeWidget.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});
this.onSpeciesChange.notify();break;case "_getChromosomeMenu":this.chromosome!=a.chromosome&&(this.chromosome=a.chromosome,this.trackSvgLayout.setLocation({chromosome:this.chromosome}),this.trackSvgLayout2.setLocation({chromosome:this.chromosome}),this.chromosomeWidget.setLocation({chromosome:this.chromosome}),this.karyotypeWidget.setLocation({chromosome:this.chromosome,position:this.position}));Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));Ext.getCmp(this.id+
"chromosomeMenuButton").setText("Chromosome "+this.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome);break;case "GoButton":var b={};null!=a.position&&this.position!=a.position&&(this.position=a.position,b.position=this.position);null!=a.chromosome&&this.chromosome!=a.chromosome&&(this.chromosome=a.chromosome,b.chromosome=this.chromosome,Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome),Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+
this.chromosome));0<Object.keys(b).length&&(this.trackSvgLayout.setLocation(b),this.trackSvgLayout2.setLocation(b),this.chromosomeWidget.setLocation(b),this.karyotypeWidget.setLocation(b));break;case "KaryotypePanel":b={};null!=a.position&&this.position!=a.position&&(this.position=a.position,b.position=this.position);null!=a.chromosome&&this.chromosome!=a.chromosome&&(this.chromosome=a.chromosome,b.chromosome=this.chromosome,Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome),
Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome));0<Object.keys(b).length&&(this.trackSvgLayout.setLocation(b),this.trackSvgLayout2.setLocation(b),this.chromosomeWidget.setLocation(b),Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position)),this.karyotypeWidget.updatePositionBox({chromosome:this.chromosome,position:this.position}));break;case "ChromosomeWidget":this.position=a.position;this.trackSvgLayout.setLocation({position:this.position});
this.trackSvgLayout2.setLocation({position:this.position});this.karyotypeWidget.setLocation({position:this.position});Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));break;case "trackSvgLayout":this.position-=a.position;Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));this.chromosomeWidget.setLocation({position:this.position});this.karyotypeWidget.setLocation({position:this.position});break;default:b={},null!=a.species&&
(this.species=a.species,b.species=this.species,Ext.example.msg("Species",this.speciesName+" selected."),this.onSpeciesChange.notify()),null!=a.name&&(this.speciesName=a.name,b.speciesName=this.speciesName),null!=a.position&&(this.position=a.position,b.position=this.position),null!=a.chromosome&&(this.chromosome=a.chromosome,b.chromosome=this.chromosome),Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome),Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome),
Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position)),Ext.getCmp(this.id+"speciesMenuButton").setText(this.speciesName),this._updateChrStore(),this.trackSvgLayout.setLocation(b),this.trackSvgLayout2.setLocation(b),this.chromosomeWidget.setLocation(b),this.karyotypeWidget.setLocation(b)}};
GenomeViewer.prototype._getNavigationBar=function(){var a=this,b=Ext.create("Ext.data.Store",{fields:["xrefId","displayId","description"]}),c=Ext.create("Ext.form.field.ComboBox",{id:this.id+"quickSearch",displayField:"displayId",valueField:"displayId",emptyText:"Quick search: gene, snp",hideTrigger:!0,width:170,store:b,queryMode:"local",typeAhead:!1,autoSelect:!1,queryDelay:500,listeners:{change:function(){var c=this.getValue(),e=2;c&&"ENS"==c.substring(0,3).toUpperCase()&&(e=10);c&&c.length>e&&
$.ajax({url:(new CellBaseManager).host+"/latest/"+a.species+"/feature/id/"+this.getValue()+"/starts_with?of=json",success:function(a){a=JSON.parse(a);b.loadData(a[0]);console.log(b)},error:function(a,b){console.log(b)}})},select:function(){a._handleNavigationBar("GoToGene")}}});return Ext.create("Ext.toolbar.Toolbar",{id:this.id+"navToolbar",cls:"bio-toolbar",border:!0,height:35,items:[{id:this.id+"speciesMenuButton",text:this.speciesName,menu:this._getSpeciesMenu()},{id:this.id+"chromosomeMenuButton",
text:"Chromosome",menu:this._getChromosomeMenu()},"-",{id:this.id+"karyotypeButton",text:"Karyotype",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"karyotypePanel").show():Ext.getCmp(a.id+"karyotypePanel").hide()}},{id:this.id+"ChromosomeToggleButton",text:"Chromosome",enableToggle:!0,pressed:!0,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"chromosomePanel").show():Ext.getCmp(a.id+"chromosomePanel").hide()}},{id:this.id+"RegionToggleButton",text:"Region",
enableToggle:!0,pressed:!0,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"regionPanel").show():Ext.getCmp(a.id+"regionPanel").hide()}},"-",{id:this.id+"zoomOutButton",margin:"0 0 0 10",iconCls:"icon-zoom-out",listeners:{click:{fn:function(){var b=Ext.getCmp(a.id+"zoomSlider").getValue();Ext.getCmp(a.id+"zoomSlider").setValue(b-a.increment)}}}},this._getZoomSlider(),{id:this.id+"zoomInButton",margin:"0 5 0 0",iconCls:"icon-zoom-in",listeners:{click:{fn:function(){var b=Ext.getCmp(a.id+"zoomSlider").getValue();
Ext.getCmp(a.id+"zoomSlider").setValue(b+a.increment)}}}},"-",{id:this.id+"positionLabel",xtype:"label",text:"Position:",margins:"0 0 0 10"},{id:this.id+"tbCoordinate",xtype:"textfield",width:120,text:this.chromosome+":"+this.position,listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("Go")}}},{id:this.id+"GoButton",text:"Go",handler:function(){a._handleNavigationBar("Go")}},"->",c,{id:this.id+"GoToGeneButton",iconCls:"icon-find",handler:function(){a._handleNavigationBar("GoToGene")}}]})};
GenomeViewer.prototype._getSpeciesMenu=function(){null==this._specieMenu&&(this._specieMenu=Ext.create("Ext.menu.Menu",{id:this.id+"_specieMenu",margin:"0 0 10 0",floating:!0,items:[]}));return this._specieMenu};GenomeViewer.prototype.setSpeciesMenu=function(a){var b=this,c=this._getSpeciesMenu();c.hide();c.removeAll();for(var d=0;d<a.length;d++)c.add({id:this.id+a[d].name,text:a[d].name,speciesObj:a[d],handler:function(a){b.setSpecies(a.speciesObj)}})};
GenomeViewer.prototype.setSpecies=function(a){a.sender="setSpecies";this.onLocationChange.notify(a)};
GenomeViewer.prototype._getChromosomeMenu=function(){var a=this,b=Ext.create("Ext.data.Store",{id:this.id+"chrStore",fields:["name"],autoLoad:!1}),c=Ext.create("Ext.view.View",{id:this.id+"chrView",width:125,style:"background-color:#fff",store:b,selModel:{mode:"SINGLE",listeners:{selectionchange:function(b,c){0<c.length&&a.onLocationChange.notify({sender:"_getChromosomeMenu",chromosome:c[0].data.name});d.hide()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".chromosome-item",
tpl:'<tpl for="."><div style="float:left" class="chromosome-item">{name}</div></tpl>'}),d=Ext.create("Ext.menu.Menu",{id:this.id+"chromosomeMenu",almacen:b,items:[c]});this._updateChrStore();return d};
GenomeViewer.prototype._updateChrStore=function(){var a=Ext.getStore(this.id+"chrStore");Ext.getCmp(this.id+"chrView");var b=new CellBaseManager(this.species);b.get("feature","karyotype","none","chromosome");b.success.addEventListener(function(b,d){var e=[];d.result.sort(function(a,b){for(var c=!0,d=0;d<a.length&&!0==c;d++)isNaN(a[d])&&(c=!1);return!c?1:a-b});for(var f=0;f<d.result.length;f++)e.push({name:d.result[f]});a.loadData(e)})};
GenomeViewer.prototype._getZoomSlider=function(){var a=this;null==this._zoomSlider&&(this._zoomSlider=Ext.create("Ext.slider.Single",{id:this.id+"zoomSlider",width:200,minValue:0,maxValue:100,value:this.zoom,useTips:!0,increment:this.increment,tipText:function(a){return Ext.String.format("<b>{0}%</b>",a.value)}}),this._zoomSlider.on({change:{fn:function(b,c){a._handleNavigationBar("ZOOM",c)},buffer:500}}));return this._zoomSlider};
GenomeViewer.prototype._disableZoomElements=function(){Ext.getCmp(this.id+"zoomSlider").disable();Ext.getCmp(this.id+"zoomOutButton").disable();Ext.getCmp(this.id+"zoomInButton").disable()};GenomeViewer.prototype._enableZoomElements=function(){Ext.getCmp(this.id+"zoomSlider").enable();Ext.getCmp(this.id+"zoomOutButton").enable();Ext.getCmp(this.id+"zoomInButton").enable()};
GenomeViewer.prototype.setZoom=function(a){this.zoom=a;this._getZoomSlider().setValue(a);null!=this.trackSvgLayout&&(this.trackSvgLayout.setZoom(a),this.trackSvgLayout2.setZoom(a));this.chromosomeWidget.setZoom(a)};
GenomeViewer.prototype._handleNavigationBar=function(a,b){"OptionMenuClick"==a&&(this.genomeWidget.showTranscripts=Ext.getCmp("showTranscriptCB").checked,this.genomeWidgetProperties.setShowTranscripts(Ext.getCmp("showTranscriptCB").checked),this.refreshMasterGenomeViewer());"ZOOM"==a&&this.setZoom(b);if("GoToGene"==a){var c=Ext.getCmp(this.id+"quickSearch").getValue();null!=c&&("rs"==c.slice(0,2)||"AFFY_"==c.slice(0,5)||"SNP_"==c.slice(0,4)||"VAR_"==c.slice(0,4)||"CRTAP_"==c.slice(0,6)||"FKBP10_"==
c.slice(0,7)||"LEPRE1_"==c.slice(0,7)||"PPIB_"==c.slice(0,5)?this.openSNPListWidget(c):this.openGeneListWidget(c))}"+"==a&&(c=this.zoom,100>c&&this.setZoom(c+this.increment));"-"==a&&(c=this.zoom,5<=c&&this.setZoom(c-this.increment));if("Go"==a){var d=Ext.getCmp(this.id+"tbCoordinate").getValue(),c=parseInt(d.split(":")[1]),d=d.split(":")[0];isNaN(c)||0>c?Ext.getCmp(this.id+"tbCoordinate").markInvalid("Position must be a positive number"):-1==Ext.getCmp(this.id+"chromosomeMenu").almacen.find("name",
d)?Ext.getCmp(this.id+"tbCoordinate").markInvalid("Invalid chromosome"):this.onLocationChange.notify({chromosome:d,position:c,sender:"GoButton"})}};
GenomeViewer.prototype._drawKaryotypePanel=function(){var a=this;return Ext.create("Ext.panel.Panel",{id:this.id+"karyotypePanel",height:200,title:"Karyotype",border:!1,margin:"0 0 1 0",cls:"border-bot panel-border-top",html:'<div id="'+this.id+'karyotypeSvg" style="margin-top:2px"></div>',listeners:{afterrender:function(){var b=$("#"+a.id+"karyotypeSvg")[0];a.karyotypeWidget=new KaryotypeWidget(b,{width:a.width,height:168,species:a.species,chromosome:a.chromosome,zoom:a.zoom,position:a.position});
a.karyotypeWidget.onClick.addEventListener(function(b,d){a.onLocationChange.notify({position:d.position,chromosome:d.chromosome,sender:"KaryotypePanel"})});a.karyotypeWidget.drawKaryotype()}}})};
GenomeViewer.prototype._drawChromosomePanel=function(){var a=this;return Ext.create("Ext.panel.Panel",{id:this.id+"chromosomePanel",height:95,title:"Chromosome",border:!1,margin:"0 0 1 0",cls:"border-bot panel-border-top",html:'<div id="'+this.id+'chromosomeSvg" style="margin-top:2px"></div>',listeners:{afterrender:function(){var b=$("#"+a.id+"chromosomeSvg")[0];a.chromosomeWidget=new ChromosomeWidget(b,{width:a.width,height:65,species:a.species,chromosome:a.chromosome,zoom:a.zoom,position:a.position});
a.chromosomeWidget.onClick.addEventListener(function(b,d){a.onLocationChange.notify({position:d,sender:"ChromosomeWidget"})});a.chromosomeWidget.drawChromosome()}}})};GenomeViewer.prototype._drawRegionPanel=function(){return Ext.create("Ext.panel.Panel",{id:this.id+"regionPanel",height:150,title:"Region overview",border:!1,autoScroll:!0,margin:"0 0 1 0",cls:"border-bot panel-border-top x-unselectable",html:'<div id="'+this.id+'regionSvg" style="margin-top:2px"></div>'})};
GenomeViewer.prototype._drawTracksPanel=function(){return Ext.create("Ext.panel.Panel",{id:this.id+"tracksPanel",title:"Detailed information",autoScroll:!0,cls:"x-unselectable",flex:1,html:'<div id = "'+this.id+'tracksSvg"></div>'})};GenomeViewer.prototype.addTrack=function(a,b){this.trackSvgLayout.addTrack(a,b)};GenomeViewer.prototype.removeTrack=function(a){return this.trackSvgLayout.removeTrack(a)};GenomeViewer.prototype.showTrack=function(a){this.trackSvgLayout._showTrack(a)};
GenomeViewer.prototype.hideTrack=function(a){this.trackSvgLayout._hideTrack(a)};GenomeViewer.prototype.checkRenderedTrack=function(a){return this.trackSvgLayout.swapHash[a]?!0:!1};
GenomeViewer.prototype._getBottomBar=function(){var a=new LegendPanel({title:"Gene legend"}),b=new LegendPanel({title:"SNP legend"}),c=Ext.create("Ext.toolbar.TextItem",{id:this.id+"versionLabel",text:""}),d=Ext.create("Ext.toolbar.TextItem",{id:this.id+"mouseLabel",width:110,text:'<span class="ssel">Position: -</span>'}),e=Ext.create("Ext.toolbar.TextItem",{id:this.id+"windowSize",width:150,text:'<span class="emph">Window size: -</span>'}),f=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"uxTaskbar",
winMgr:new Ext.ZIndexManager,enableOverflow:!0,cls:"bio-hiddenbar",height:28,flex:1}),a=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"legendBar",cls:"bio-hiddenbar",width:600,height:28,items:["-",d,e,a.getButton(GENE_BIOTYPE_COLORS),b.getButton(SNP_BIOTYPE_COLORS),"->",c]});return Ext.create("Ext.container.Container",{id:this.id+"bottomBar",layout:"hbox",cls:"bio-botbar x-unselectable",height:30,border:!0,items:[f,a]})};
GenomeViewer.prototype.openListWidget=function(a){var b=this;console.log(a.query);var c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){if(1<e.result[0].length){var f=new GenomicListWidget(b.species,{title:a.title,gridFields:a.gridField,viewer:b});f.draw(e);f.onSelected.addEventListener(function(a,c){null!=c&&null!=c.chromosome&&(b.chromosome!=c.chromosome||b.position!=c.start)&&b.setLoc({sender:"",chromosome:c.chromosome,position:c.start})});f.onTrackAddAction.addEventListener(function(a,
c){var d=new TrackData(c.fileName,{adapter:c.adapter});b.trackSvgLayout.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}else f=e.result[0][0],null!=f?b.setLoc({sender:"",chromosome:f.chromosome,position:f.start}):Ext.example.msg('Feature <span class="ssel">'+a.query+"</span> not found","")});c.get(a.category,a.subcategory,a.query,a.resource,a.params)};
GenomeViewer.prototype.openGeneListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"gene",title:"Gene List"})};GenomeViewer.prototype.openTranscriptListWidget=function(){};GenomeViewer.prototype.openExonListWidget=function(){};GenomeViewer.prototype.openSNPListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"snp",title:"SNP List",gridField:"name variantAlleles ancestralAllele mapWeight position sequence chromosome start end".split(" ")})};
GenomeViewer.prototype.openGOListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"gene",title:"Gene List by GO"})};
function TrackSvg(a,b){this.args=b;this.parent=a;this.y=25;this.height=50;this.width=200;this.title="track";this.renderedArea={};this.lienzo=7E6;this.pixelPosition=this.lienzo/2;this.histogramZoom=-1E3;this.titleVisibility="visible";this.closable=!0;this.types=FEATURE_TYPES;this.labelZoom=-1;if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.id&&(this.id=b.id),null!=b.trackSvgLayout&&(this.trackSvgLayout=b.trackSvgLayout),null!=b.trackData&&(this.trackData=b.trackData),null!=b.clase&&(this.clase=
b.clase),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.position&&(this.position=b.position),null!=b.zoom&&(this.zoom=b.zoom),null!=b.pixelBase&&(this.pixelBase=b.pixelBase),null!=b.closable&&(this.closable=b.closable),null!=b.labelZoom&&(this.labelZoom=b.labelZoom),null!=b.histogramZoom&&(this.histogramZoom=b.histogramZoom),null!=b.transcriptZoom&&(this.transcriptZoom=b.transcriptZoom),null!=b.featureTypes&&(this.featureTypes=b.featureTypes),null!=b.titleVisibility&&
(this.titleVisibility=b.titleVisibility),null!=b.featuresRender)){switch(b.featuresRender){case "MultiFeatureRender":this.featuresRender=this.MultiFeatureRender;break;case "SequenceRender":this.featuresRender=this.SequenceRender;break;case "GeneTranscriptRender":this.featuresRender=this.GeneTranscriptRender;break;case "BamRender":this.featuresRender=this.BamRender;break;default:this.featuresRender=this.MultiFeatureRender}this.defaultRender=this.featuresRender}this.rendered=!1;this.transcript=this.histogram=
this.interval=null}TrackSvg.prototype.setY=function(a){this.y=a};TrackSvg.prototype.getHeight=function(){return this.height};TrackSvg.prototype.setHeight=function(a){this.height=a;this.rendered&&(this.main.setAttribute("height",a),this.features.setAttribute("height",a))};TrackSvg.prototype.setWidth=function(a){this.width=a;this.rendered&&this.main.setAttribute("width",a)};
TrackSvg.prototype.setLoading=function(a){a?this.loading.setAttribute("visibility","visible"):this.loading.setAttribute("visibility","hidden")};
TrackSvg.prototype.draw=function(){var a=this,b=SVG.addChild(this.parent,"svg",{id:this.id,x:0,y:this.y,width:this.width,height:this.height}),c=SVG.addChild(b,"svg",{"class":"features",x:-this.pixelPosition,width:this.lienzo,height:this.height}),d=SVG.addChild(b,"g",{visibility:this.titleVisibility}),e=15+6*this.id.length,f=SVG.addChild(d,"rect",{x:0,y:0,width:e,height:22,stroke:"deepSkyBlue","stroke-width":"1",opacity:"0.6",fill:"honeydew"}),g=SVG.addChild(d,"text",{x:4,y:14,"font-size":10,opacity:"0.4",
fill:"black"});g.textContent=this.id;var j=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAPJJREFUOI2llD0OgkAQhb/QExuPQGWIB/A63IAbGLwG0dNQWxPt6GmoELMWzuJk3IUYJ5mQnXlv/nYWnHOEFCgAp7SIYRPiclg5f0SyJkCmqtgBrankBuwVJwMS59xsKAV4Bc7AwwTwOgEXwTmgFD5boI+QnkAn35C/Fz7HSMYTkErXqZynAPYIkAN346giI6wM7g7kfiYbYFAtpJYtuFS1NggPvRejODtLNvvTCW60GaKVmADhSpZmEqgiPBNWbkdVsHg7/+/Jjxv7EP+8sXqwCe+34CX0dlqxe8mE9zV9LbUJUluAl+CvQAI2xtxYjE/8Ak/JC4Cb6l5eAAAAAElFTkSuQmCC",
x:4+e,y:3,width:17,height:17,opacity:"0.6",visibility:"hidden"}),h=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAD9JREFUOI1jYKAhEGBgYJgPxWSB+QwMDP+hmGRDkDWTbAg2zUQbgk8zQUOI0Uyyd2AacAImYk0aNWAwG0AxAABRBSdztC0IxQAAAABJRU5ErkJggg==",x:22+e,y:4,width:16,height:16,opacity:"0.6",visibility:"hidden"}),k=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAERJREFUOI1jYKAx+A/FOAETpTaMGjDYDJjPgIh39PhHF5+Py0BshhCtmRhDCGrGZwjRmrEZQrJmZEPmMzAwCJBrAEEAANCqJXdWrFuyAAAAAElFTkSuQmCC",
x:36+e,y:4,width:16,height:16,opacity:"0.6",visibility:"hidden"}),l=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAJFJREFUOI2tks0NgzAMhb+wAFP05FM2aCdjtDBCLjkxBRO4F4JoAONIfVKkyHk/sl4CQIyRFqpKzvk0/zvCMRSYgU9LEpH9XkpJwFtEgqr+8NJmkozAR45F2N+WcTQyrk3c4lYwbadLXFGFCkx34sHr9lrXrvTLFXrFx509Fd+K3SaeqkwTb1XV5Axvz73/wcQXYitIjMzG550AAAAASUVORK5CYII=",x:52+e,y:4,width:16,height:16,opacity:"0.6",visibility:"hidden"}),m=SVG.addChild(b,
"linearGradient",{id:this.id+"bamStrandForward"}),n=SVG.addChild(b,"linearGradient",{id:this.id+"bamStrandReverse"});SVG.addChild(m,"stop",{offset:"5%","stop-color":"#666"});SVG.addChild(m,"stop",{offset:"95%","stop-color":"#BBB"});SVG.addChild(n,"stop",{offset:"5%","stop-color":"#BBB"});SVG.addChild(n,"stop",{offset:"95%","stop-color":"#666"});$(d).mouseenter(function(){f.setAttribute("width",74+e);f.setAttribute("opacity","1.0");g.setAttribute("opacity","1.0");h.setAttribute("visibility","visible");
k.setAttribute("visibility","visible");!0==a.closable&&l.setAttribute("visibility","visible")});$(d).mouseleave(function(){f.setAttribute("width",e);f.setAttribute("opacity","0.6");g.setAttribute("opacity","0.4");h.setAttribute("visibility","hidden");k.setAttribute("visibility","hidden");l.setAttribute("visibility","hidden");j.setAttribute("visibility","hidden")});$([h,k,l,j]).mouseover(function(){this.setAttribute("opacity","1.0")});$([h,k,l,j]).mouseleave(function(){this.setAttribute("opacity",
"0.6")});$(j).mouseover(function(){f.setAttribute("height",44)});$(j).mouseleave(function(){f.setAttribute("height",22)});$(l).click(function(){f.setAttribute("width",e);f.setAttribute("opacity","0.6");g.setAttribute("opacity","0.4");h.setAttribute("visibility","hidden");k.setAttribute("visibility","hidden");l.setAttribute("visibility","hidden");j.setAttribute("visibility","hidden")});this.invalidZoomText=SVG.addChild(b,"text",{x:154,y:14,"font-size":10,opacity:"0.6",fill:"black",visibility:"hidden"});
this.invalidZoomText.textContent="This level of zoom isn't appropiate for this track";this.loading=SVG.addChildImage(b,{"xlink:href":"data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%3Csvg%20version%3D%221.1%22%20width%3D%2230px%22%20height%3D%2230px%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%3Cdefs%3E%3Cg%20id%3D%22pair%22%3E%3Cellipse%20cx%3D%2210%22%20cy%3D%220%22%20rx%3D%225%22%20ry%3D%222%22%20style%3D%22fill%3A%23ccc%3B%20fill-opacity%3A0.5%3B%22%2F%3E%3Cellipse%20cx%3D%22-10%22%20cy%3D%220%22%20rx%3D%225%22%20ry%3D%222%22%20style%3D%22fill%3A%23aaa%3B%20fill-opacity%3A1.0%3B%22%2F%3E%3C%2Fg%3E%3C%2Fdefs%3E%3Cg%20transform%3D%22translate(15%2C15)%22%3E%3Cg%3E%3CanimateTransform%20attributeName%3D%22transform%22%20type%3D%22rotate%22%20from%3D%220%22%20to%3D%22360%22%20dur%3D%222s%22%20repeatDur%3D%22indefinite%22%2F%3E%3Cuse%20xlink%3Ahref%3D%22%23pair%22%2F%3E%3Cuse%20xlink%3Ahref%3D%22%23pair%22%20transform%3D%22rotate(45)%22%2F%3E%3Cuse%20xlink%3Ahref%3D%22%23pair%22%20transform%3D%22rotate(90)%22%2F%3E%3Cuse%20xlink%3Ahref%3D%22%23pair%22%20transform%3D%22rotate(135)%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E",
x:this.width-40,y:0,width:22,height:22,visibility:"hidden"});this.main=b;this.titleGroup=d;this.titlebar=f;this.titleText=g;this.upRect=h;this.downRect=k;this.hideRect=l;this.settingsRect=j;this.features=c;this.rendered=!0};
TrackSvg.prototype.MultiFeatureRender=function(a){var b=this;console.time("Multirender "+a.length);for(var c=function(a){var c=a.start,e=a.end-c+1,h=b.width/2;0>e&&(e=Math.abs(e));0==e&&(e=1);var k=b.types[a.featureType];try{var l=k.getColor(a)}catch(m){console.log(m);debugger}var e=e*b.pixelBase,c=b.pixelPosition+h-(b.position-c)*b.pixelBase,n=12;if(b.zoom>b.labelZoom)try{var o=Math.max(e,8*k.getLabel(a).length)}catch(p){o=72}else o=Math.max(e,10),n=0;for(var r=n+12,h=0,n=n+k.height;;){null==b.renderedArea[h]&&
(b.renderedArea[h]=new FeatureBinarySearchTree);if(b.renderedArea[h].add({start:c,end:c+o-1})){o=SVG.addChild(b.features,"g");SVG.addChild(o,"rect",{x:c,y:h,width:e,height:k.height,stroke:"#3B0B0B","stroke-width":0.5,fill:l,cursor:"pointer"});b.zoom>b.labelZoom&&(SVG.addChild(o,"text",{i:d,x:c,y:n,"font-size":10,opacity:null,fill:"black",cursor:"pointer"}).textContent=k.getLabel(a));$(o).qtip({content:{text:k.getTipText(a),title:k.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),
effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$(o).click(function(){b.showInfoWidget({query:a[k.infoWidgetId],feature:a,featureType:a.featureType,adapter:b.trackData.adapter})});break}h+=r;n+=r}},d=0,e=a.length;d<e;d++)c(a[d]);c=24*Object.keys(this.renderedArea).length;0<c&&this.setHeight(c+10);console.timeEnd("Multirender "+a.length)};
TrackSvg.prototype.BamRender=function(a){var b=this,c=this.width/2;console.log(a.length);var d=SVG.addChild(b.features,"g"),e=function(a){for(var e=a.coverage.all,g=a.reads,j=parseInt(a.region.start),n=(parseInt(a.region.end)-j+1)*b.pixelBase,o="",p=b.pixelBase/2-0.5,r,s,t=parseInt(a.region.start),v=0;v<e.length;v++)r=b.pixelPosition+c-(b.position-t)*b.pixelBase+p,s=50*(e[v]/200),o+=r+","+s+" ",t++;var u=SVG.addChild(d,"rect",{x:b.pixelPosition+c-(b.position-j)*b.pixelBase,y:0,width:n,height:50,fill:"transparent",
cursor:"pointer"});SVG.addChild(d,"polyline",{points:o,stroke:"black","stroke-width":2,opacity:0.4,fill:"gray"});$(u).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip-shadow"}});b.trackSvgLayout.onMousePosition.addEventListener(function(b,c){var d='depth: <span class="ssel">'+e[c-parseInt(a.region.start)]+'</span><br>A: <span class="ssel">'+a.coverage.a[c-parseInt(a.region.start)]+'</span><br>C: <span class="ssel">'+a.coverage.c[c-
parseInt(a.region.start)]+'</span><br>G: <span class="ssel">'+a.coverage.g[c-parseInt(a.region.start)]+'</span><br>T: <span class="ssel">'+a.coverage.t[c-parseInt(a.region.start)]+"</span><br>";$(u).qtip("option","content.text",d)});v=0;for(j=g.length;v<j;v++)f(g[v])},f=function(a){var c=a.start,e=a.end-c+1,f=b.width/2,g=b.types[a.featureType],j=g.getColor(a),e=e*b.pixelBase,c=b.pixelPosition+f-(b.position-c)*b.pixelBase;try{var p=Math.max(e,8*g.getLabel(a).length)}catch(r){p=72}for(f=70;;){null==
b.renderedArea[f]&&(b.renderedArea[f]=new FeatureBinarySearchTree);if(b.renderedArea[f].add({start:c,end:c+p-1})){g.getStrand(a);e=SVG.addChild(d,"rect",{x:c,y:f,width:e,height:g.height,stroke:"white","stroke-width":1,fill:j,cursor:"pointer"});$([e]).qtip({content:{text:g.getTipText(a),title:g.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:"ui-tooltip ui-tooltip-shadow"}});$([e]).click(function(){b.showInfoWidget({query:a[g.infoWidgetId],
feature:a,featureType:a.featureType,adapter:b.trackData.adapter})});break}f+=12}};console.time("BamRender");for(var g=0,j=a.length;g<j;g++)e(a[g]);console.timeEnd("BamRender");a=24*Object.keys(this.renderedArea).length;0<a&&this.setHeight(a+10+70)};
TrackSvg.prototype.GeneTranscriptRender=function(a){var b=this;console.time("GeneTranscriptRender");for(var c=function(a){var c=a.start,d=a.end-c+1,e=b.width/2,k=b.types[a.featureType],l=k.getColor(a),d=d*b.pixelBase,c=b.pixelPosition+e-(b.position-c)*b.pixelBase;try{var m=Math.max(d,8*k.getLabel(a).length)}catch(n){m=72}for(var o=0,p=12+k.height;;){null==b.renderedArea[o]&&(b.renderedArea[o]=new FeatureBinarySearchTree);var r,s=o;if(null!=a.transcripts)for(var t=0,v=a.transcripts.length+1;t<v;t++){null==
b.renderedArea[s]&&(b.renderedArea[s]=new FeatureBinarySearchTree);r=!b.renderedArea[s].contains({start:c,end:c+m-1});if(!1==r)break;s+=24}else r=b.renderedArea[o].add({start:c,end:c+m-1});if(r){r=SVG.addChild(b.features,"rect",{x:c,y:o,width:d,height:k.height,stroke:"#3B0B0B","stroke-width":0.5,fill:l,cursor:"pointer"});var u=SVG.addChild(b.features,"text",{i:t,x:c,y:p,"font-size":10,opacity:null,fill:"black",cursor:"pointer"});u.textContent=k.getLabel(a);$([r,u]).qtip({content:{text:k.getTipText(a),
title:k.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$([r,u]).click(function(){b.showInfoWidget({query:a[k.infoWidgetId],feature:a,featureType:a.featureType,adapter:b.trackData.adapter})});s=o+24;o=p+24;if(null!=a.transcripts){t=0;for(v=a.transcripts.length;t<v;t++){null==b.renderedArea[s]&&(b.renderedArea[s]=new FeatureBinarySearchTree);var q=a.transcripts[t],u=b.pixelPosition+e-(b.position-q.start)*
b.pixelBase;r=(q.end-q.start+1)*b.pixelBase;k=b.types[q.featureType];l=k.getColor(q);try{m=Math.max(d,d-(a.end-q.start)*b.pixelBase+7*k.getLabel(q).length)}catch(B){m=72}b.renderedArea[s].add({start:c,end:c+m-1});p=SVG.addChild(b.features,"g",{widgetId:q[k.infoWidgetId]});r=SVG.addChild(p,"rect",{x:u,y:s+2,width:r,height:k.height-3,fill:"gray",cursor:"pointer"});u=SVG.addChild(p,"text",{x:u,y:o,"font-size":10,opacity:null,fill:"black",cursor:"pointer"});u.textContent=k.getLabel(q);$(p).qtip({content:{text:k.getTipText(q),
title:k.getTipTitle(q)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$(p).click(function(){var a=this.getAttribute("widgetId");b.showInfoWidget({query:a,feature:q,featureType:q.featureType,adapter:b.trackData.adapter})});r=0;for(u=a.transcripts[t].exonToTranscripts.length;r<u;r++){var p=a.transcripts[t].exonToTranscripts[r],z=b.types[p.exon.featureType],x=parseInt(p.exon.start),w=parseInt(p.exon.end),y=b.pixelPosition+
e-(b.position-x)*b.pixelBase,A=(w-x+1)*b.pixelBase,C=SVG.addChild(b.features,"g");$(C).qtip({content:{text:z.getTipText(p,q),title:z.getTipTitle(p)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});SVG.addChild(C,"rect",{i:t,x:y,y:s-1,width:A,height:z.height+3,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"});A=y=0;q.codingRegionStart>x&&q.codingRegionStart<w?(y=parseInt(q.codingRegionStart),A=w):q.codingRegionEnd>
x&&q.codingRegionEnd<w?(y=x,A=parseInt(q.codingRegionEnd)):q.codingRegionStart<x&&q.codingRegionEnd>w&&(y=x,A=w);w=A-y;x=b.pixelPosition+e-(b.position-y)*b.pixelBase;y=(w+1)*b.pixelBase;if(0<w){SVG.addChild(C,"rect",{i:t,x:x,y:s-1,width:y,height:z.height+3,stroke:l,"stroke-width":1,fill:l,cursor:"pointer"});z=0;for(w=3-p.phase;z<w&&10==b.pixelBase&&-1!=p.phase;z++)SVG.addChild(C,"rect",{i:t,x:x+10*z,y:s-1,width:b.pixelBase,height:k.height+3,stroke:l,"stroke-width":1,fill:"white",cursor:"pointer"})}}s+=
24;o+=24}}break}o+=24;p+=24}},d=0,e=a.length;d<e;d++)c(a[d]);a=24*Object.keys(this.renderedArea).length;0<a&&this.setHeight(a+10);console.timeEnd("GeneTranscriptRender")};
TrackSvg.prototype.SequenceRender=function(a){var b=this.width/2;if(0<a.length){var c=a[0].sequence,d=a[0].start,a=a[0].start;if(jQuery.browser.mozilla){var e=this.pixelPosition+b-(this.position-a)*this.pixelBase,e=SVG.addChild(this.features,"text",{x:e+1,y:13,"font-size":19,"font-family":"Ubuntu Mono"});e.textContent=c}else for(var f=0;f<c.length;f++)e=this.pixelPosition+b-(this.position-a)*this.pixelBase,a++,e=SVG.addChild(this.features,"text",{x:e+1,y:12,"font-size":16,"font-family":"Ubuntu Mono",
fill:SEQUENCE_COLORS[c.charAt(f)]}),e.textContent=c.charAt(f),$(e).qtip({content:(d+f).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip-light ui-tooltip-shadow"}})}console.timeEnd("all")};
TrackSvg.prototype.HistogramRender=function(a){console.time("histogramRender");var b=this.width/2,c="";if(0<a.length)var d=this.pixelPosition+b-(this.position-a[0].start)*this.pixelBase,c=d+",50 ";for(var d=0,e=a.length;d<e;d++){var f=a[d],g=f.end-f.start,j=this.types[f.featureType].histogramColor,g=g*this.pixelBase,f=this.pixelPosition+b-(this.position-f.start)*this.pixelBase,h=50*a[d].value;null==a[d].value&&console.log(a[d]);c+=f+g/2+","+(50-h)+" "}0<a.length&&(d=this.pixelPosition+b-(this.position-
a[a.length-1].start)*this.pixelBase,c+=d+",50 ");SVG.addChild(this.features,"polyline",{points:c,stroke:"#000000","stroke-width":0.2,fill:j,cursor:"pointer"});this.setHeight(60);console.timeEnd("histogramRender")};
TrackSvg.prototype.showInfoWidget=function(a){console.log(a);if("orange"==this.trackData.adapter.species&&(-1!=a.featureType.indexOf("gene")&&(a.featureType="geneorange"),-1!=a.featureType.indexOf("transcript")))a.featureType="transcriptorange";switch(a.featureType){case "gene":(new GeneInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "geneorange":(new GeneOrangeInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "transcriptorange":(new TranscriptOrangeInfoWidget(null,
this.trackData.adapter.species)).draw(a);break;case "transcript":(new TranscriptInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "snp":(new SnpInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "vcf":(new VCFVariantInfoWidget(null,this.trackData.adapter.species)).draw(a)}};
function TrackSvgLayout(a,b){var c=this;this.args=b;this.id=Math.round(1E7*Math.random());this.trackDataList=[];this.trackSvgList=[];this.swapHash={};this.zoomOffset=0;this.parentLayout=null;this.windowSize=this.mousePosition="";this.height=25;if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.position&&(this.position=b.position),null!=b.chromosome&&(this.chromosome=b.chromosome),null!=b.zoomOffset&&(this.zoomOffset=b.zoomOffset),null!=b.zoom&&(this.zoom=
b.zoom-this.zoomOffset),null!=b.parentLayout))this.parentLayout=b.parentLayout;this._createPixelsbyBase();this.pixelBase=this._getPixelsbyBase(this.zoom);this.halfVirtualBase=3*this.width/2/this.pixelBase;this.onZoomChange=new Event;this.onChromosomeChange=new Event;this.onMove=new Event;this.onWindowSize=new Event;this.onMousePosition=new Event;this.onSvgRemoveTrack=new Event;this.tracksRendered=0;this.onTracksRendered=new Event;this.svg=SVG.init(a,{width:this.width,height:this.height});var d=SVG.addChild(this.svg,
"pattern",{id:this.id+"gridPatt",patternUnits:"userSpaceOnUse",x:0,y:0,width:10,height:2E3}),e=this.width/2;this.grid=SVG.addChild(d,"rect",{x:parseInt(e%10),y:25,width:1,height:2E3,opacity:"0.15",fill:"grey"});this.grid2=SVG.addChild(this.svg,"rect",{width:this.width,height:2E3,x:0,fill:"url(#"+this.id+"gridPatt)"});this.positionText=SVG.addChild(this.svg,"text",{x:e-30,y:22,"font-size":10,fill:"green"});this.firstPositionText=SVG.addChild(this.svg,"text",{x:0,y:22,"font-size":10,fill:"green"});
this.lastPositionText=SVG.addChild(this.svg,"text",{x:this.width-70,y:22,"font-size":10,fill:"green"});this._setTextPosition();this.viewNtsArrow=SVG.addChild(this.svg,"rect",{x:16,y:2,width:this.width-32,height:10,opacity:"0.7",fill:"grey"});this.viewNtsArrowLeft=SVG.addChild(this.svg,"polyline",{points:"0,7 16,0 16,14",opacity:"0.7",fill:"grey"});this.viewNtsArrowRight=SVG.addChild(this.svg,"polyline",{points:this.width+",7 "+(this.width-16)+",0 "+(this.width-16)+",14",opacity:"0.7",fill:"grey"});
this.viewNtsText=SVG.addChild(this.svg,"text",{x:e-30,y:11,"font-size":10,fill:"white"});this.windowSize="Window size: "+Math.ceil(this.width/this.pixelBase).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" nts";this.viewNtsText.textContent=this.windowSize;this.currentLine=SVG.addChild(this.svg,"rect",{x:e,y:this.height,width:this.pixelBase,height:this.height,"stroke-width":"2",stroke:"orangered",opacity:"0.5",fill:"orange"});this.mouseLine=SVG.addChild(this.svg,"rect",{x:-20,y:this.height,
width:this.pixelBase,height:this.height,"stroke-width":"2",stroke:"lightgray",opacity:"0.4",fill:"gainsboro"});null==this.parentLayout?($(a).mousemove(function(b){var d=c.width/2,e=c.pixelBase/2,b=(b.clientX-$(a).offset().left-e)/c.pixelBase|0;c.mouseLine.setAttribute("x",b*c.pixelBase+d%c.pixelBase);c.mousePosition=c.position+b-(d/c.pixelBase|0);c.onMousePosition.notify(c.mousePosition)}),$(this.svg).mousedown(function(a){this.setAttribute("cursor","move");var b=a.clientX,d=0;$(this).mousemove(function(a){this.setAttribute("cursor",
"move");a=(b-a.clientX)/c.pixelBase|0;if(a!=d){var e=d-a;0<c.position-e&&(c.position-=e,c._setTextPosition(),c.onMove.notify(e),d=a)}})}),$(this.svg).mouseup(function(){c.mouseLine.setAttribute("visibility","visible");this.setAttribute("cursor","default");$(this).off("mousemove")}),$(this.svg).mouseleave(function(){this.setAttribute("cursor","default");$(this).off("mousemove");$("body").off("keydown")}),$(this.svg).mouseenter(function(){$("body").off("keydown");$("body").keydown(function(a){var b=
0;switch(a.keyCode){case 37:b=a.ctrlKey?100/c.pixelBase:10/c.pixelBase;break;case 39:b=a.ctrlKey?-100/c.pixelBase:-10/c.pixelBase;break;case 109:a.shiftKey&&console.log("zoom out");break;case 107:a.shiftKey&&console.log("zoom in")}0!=b&&(c.position-=b,c._setTextPosition(),c.onMove.notify(b))})})):c.parentLayout.onMove.addEventListener(function(a,b){c.position-=b;c._setTextPosition();c.onMove.notify(b)})}
TrackSvgLayout.prototype.setHeight=function(a){this.height=a;this.svg.setAttribute("height",a);this.grid.setAttribute("height",a);this.grid2.setAttribute("height",a);this.currentLine.setAttribute("height",parseInt(a)-25);this.mouseLine.setAttribute("height",parseInt(a)-25)};
TrackSvgLayout.prototype.setWidth=function(a){this.width=a;var b=this.width/2;this.svg.setAttribute("width",a);this.grid.setAttribute("x",parseInt(b%10));this.grid2.setAttribute("width",a);this.positionText.setAttribute("x",b-30);this.lastPositionText.setAttribute("x",a-70);this.viewNtsArrow.setAttribute("width",a-32);this.viewNtsArrowRight.setAttribute("points",a+",7 "+(a-16)+",0 "+(a-16)+",14");this.viewNtsText.setAttribute("x",b-30);this.currentLine.setAttribute("x",b);for(b=0;b<this.trackSvgList.length;b++)this.trackSvgList[b].setWidth(a);
this.halfVirtualBase=3*this.width/2/this.pixelBase;this.viewNtsText.textContent="Window size: "+Math.ceil(this.width/this.pixelBase).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" nts";this.windowSize=this.viewNtsText.textContent;this._setTextPosition();this.onWindowSize.notify({windowSize:this.viewNtsText.textContent});this.onZoomChange.notify()};
TrackSvgLayout.prototype.setZoom=function(a){this.zoom=Math.max(a-this.zoomOffset,-5);this.pixelBase=this._getPixelsbyBase(this.zoom);this.halfVirtualBase=3*this.width/2/this.pixelBase;this.currentLine.setAttribute("width",this.pixelBase);this.mouseLine.setAttribute("width",this.pixelBase);this.viewNtsText.textContent="Window size: "+Math.ceil(this.width/this.pixelBase).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" nts";this.windowSize=this.viewNtsText.textContent;this._setTextPosition();
this.onWindowSize.notify({windowSize:this.viewNtsText.textContent});this.onZoomChange.notify()};TrackSvgLayout.prototype.setLocation=function(a){null!=a.chromosome&&(this.chromosome=a.chromosome);null!=a.position&&(this.position=parseInt(a.position),this._setTextPosition());if(null!=a.species)for(i in this.trackDataList)this.trackDataList[i].adapter instanceof CellBaseAdapter&&(this.trackDataList[i].adapter.species=a.species,this.trackDataList[i].adapter.featureCache.clear());this.onChromosomeChange.notify()};
TrackSvgLayout.prototype.addTrack=function(a,b){var c=this,d=b.visibleRange;b.position=this.position;b.trackData=a;b.zoom=this.zoom;b.pixelBase=this.pixelBase;b.width=this.width;b.adapter=a.adapter;b.trackSvgLayout=this;var e=this.trackDataList.push(a),f=new TrackSvg(this.svg,b);this.trackSvgList.push(f);this.swapHash[f.id]={index:e-1,visible:!0};f.setY(this.height);f.draw();this.setHeight(this.height+f.getHeight());var g,j,h,k,l=function(){g=parseInt(c.position-2*c.halfVirtualBase);j=parseInt(c.position+
2*c.halfVirtualBase);h=parseInt(c.position-2*c.halfVirtualBase);k=parseInt(c.position+2*c.halfVirtualBase)},m=function(){c.zoom<=f.histogramZoom?(f.histogram=!0,f.interval=Math.max(512,5/c.pixelBase)):f.histogram=null},n=function(){f.transcript=null!=f.transcriptZoom&&c.zoom>=f.transcriptZoom?!0:null},o=function(){for(console.time("empty");f.features.firstChild;)f.features.removeChild(f.features.firstChild);console.timeEnd("empty");a.adapter.featureCache.chunksDisplayed={};f.renderedArea={}};f.onGetDataIdx=
a.adapter.onGetData.addEventListener(function(a,b){f.featuresRender=!0==b.params.histogram?f.HistogramRender:f.defaultRender;c.setHeight(c.height-f.getHeight());f.featuresRender(b.data);f.setLoading(!1);$(f.features).fadeIn("fast");console.log("rendered");c.setHeight(c.height+f.getHeight());c._redraw()});m();n();l();c.zoom>=d.start-c.zoomOffset&&c.zoom<=d.end?(f.setLoading(!0),a.retrieveData({chromosome:c.chromosome,start:h,end:k,histogram:f.histogram,interval:f.interval,transcript:f.transcript}),
f.invalidZoomText.setAttribute("visibility","hidden")):f.invalidZoomText.setAttribute("visibility","visible");f.onZoomChangeIdx=this.onZoomChange.addEventListener(function(){f.zoom=c.zoom;f.pixelBase=c.pixelBase;m();n();o();l();if(c.zoom>=d.start-c.zoomOffset&&c.zoom<=d.end){f.setLoading(true);a.retrieveData({chromosome:c.chromosome,start:h,end:k,histogram:f.histogram,interval:f.interval,transcript:f.transcript});f.invalidZoomText.setAttribute("visibility","hidden")}else f.invalidZoomText.setAttribute("visibility",
"visible")});f.onChromosomeChangeIdx=this.onChromosomeChange.addEventListener(function(){f.position=c.position;o();l();if(c.zoom>=d.start-c.zoomOffset&&c.zoom<=d.end){f.setLoading(true);a.retrieveData({chromosome:c.chromosome,start:h,end:k,histogram:f.histogram,interval:f.interval,transcript:f.transcript})}});f.onMoveIdx=this.onMove.addEventListener(function(b,e){f.position=f.position-e;var l=e*c.pixelBase;f.pixelPosition=f.pixelPosition-l;l=parseFloat(f.features.getAttribute("x"))+l;f.features.setAttribute("x",
l);if(c.zoom>=d.start&&c.zoom<=d.end){h=parseInt(f.position-c.halfVirtualBase);virtualEnd=parseInt(f.position+c.halfVirtualBase);parseInt(f.position-c.halfVirtualBase*2);parseInt(f.position+c.halfVirtualBase*2);if(e>0&&h<g){a.retrieveData({chromosome:c.chromosome,start:parseInt(g-c.halfVirtualBase),end:g,histogram:f.histogram,interval:f.interval,transcript:f.transcript});g=parseInt(g-c.halfVirtualBase)}if(e<0&&virtualEnd>j){a.retrieveData({chromosome:c.chromosome,start:j,end:parseInt(j+c.halfVirtualBase),
histogram:f.histogram,interval:f.interval,transcript:f.transcript});j=parseInt(j+c.halfVirtualBase)}}});$(f.upRect).bind("click",function(){c._reallocateAbove(this.parentNode.parentNode.id)});$(f.downRect).bind("click",function(){c._reallocateUnder(this.parentNode.parentNode.id)});$(f.hideRect).bind("click",function(){c.removeTrack(this.parentNode.parentNode.id);c.onSvgRemoveTrack.notify(this.parentNode.parentNode.id)});$(f.settingsRect).bind("click",function(){console.log("settings click")})};
TrackSvgLayout.prototype.removeTrack=function(a){this._hideTrack(a);var b=this.swapHash[a].index;this.onZoomChange.removeEventListener(this.trackSvgList[b].onZoomChangeIdx);this.onChromosomeChange.removeEventListener(this.trackSvgList[b].onChromosomeChangeIdx);this.onMove.removeEventListener(this.trackSvgList[b].onMoveIdx);this.trackSvgList.splice(b,1);this.trackDataList.splice(b,1);delete this.swapHash[a];for(b=0;b<this.trackSvgList.length;b++)this.swapHash[this.trackSvgList[b].id].index=b;return a};
TrackSvgLayout.prototype._redraw=function(){for(var a=null,b=25,c=0;c<this.trackSvgList.length;c++)a=this.trackSvgList[c],this.swapHash[a.id].visible&&(a.main.setAttribute("y",b),b+=a.getHeight())};
TrackSvgLayout.prototype._reallocateAbove=function(a){a=this.swapHash[a].index;console.log(a+" quiere moverse 1 posicion arriba");if(0<a){var b=this.trackSvgList[a-1],c=this.trackSvgList[a],d=parseInt(b.main.getAttribute("y")),e=parseInt(c.main.getAttribute("height"));b.main.setAttribute("y",d+e);c.main.setAttribute("y",d);this.trackSvgList[a]=b;this.trackSvgList[a-1]=c;this.swapHash[b.id].index=a;this.swapHash[c.id].index=a-1}else console.log("ya esta en la mas alta")};
TrackSvgLayout.prototype._reallocateUnder=function(a){a=this.swapHash[a].index;console.log(a+" quiere moverse 1 posicion abajo");if(a+1<this.trackDataList.length){var b=this.trackSvgList[a],c=this.trackSvgList[a+1],d=parseInt(b.main.getAttribute("y")),e=parseInt(c.main.getAttribute("height"));b.main.setAttribute("y",d+e);c.main.setAttribute("y",d);this.trackSvgList[a]=c;this.trackSvgList[a+1]=b;this.swapHash[c.id].index=a;this.swapHash[b.id].index=a+1}else console.log("abajo del todo")};
TrackSvgLayout.prototype._hideTrack=function(a){this.swapHash[a].visible=!1;a=this.trackSvgList[this.swapHash[a].index];this.svg.removeChild(a.main);this.setHeight(this.height-a.getHeight());this._redraw()};TrackSvgLayout.prototype._showTrack=function(a){this.swapHash[a].visible=!0;a=this.trackSvgList[this.swapHash[a].index];this.svg.appendChild(a.main);this.setHeight(this.height+a.getHeight());this._redraw()};TrackSvgLayout.prototype._getPixelsbyBase=function(a){return this.zoomLevels[a]};
TrackSvgLayout.prototype._createPixelsbyBase=function(){this.zoomLevels=[];for(var a=10,b=100;-40<=b;b-=5)this.zoomLevels[b]=a,a/=2};
TrackSvgLayout.prototype._setTextPosition=function(){this.positionText.textContent=this.position.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");var a=Math.floor(this.width/this.pixelBase/2);this.firstPositionText.textContent=(this.position-a).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");this.lastPositionText.textContent=(this.position+a-1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")};
function TrackData(a,b){this.id=a;if(null!=b&&(null!=b.adapter&&(this.adapter=b.adapter),null!=b.gzip))this.gzip=b.gzip}TrackData.prototype.retrieveData=function(a){this.adapter.getData(a)};
function FeatureCache(a){this.args=a;this.id=Math.round(1E7*Math.random());this.chunkSize=5E4;this.gzip=!0;this.maxSize=10485760;this.size=0;if(null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip))this.gzip=a.gzip;this.cache={};this.chunksDisplayed={};this.maxFeaturesInterval=0;this.gzip=!1}FeatureCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)};
FeatureCache.prototype.getChunkRegion=function(a){start=this._getChunk(a.start)*this.chunkSize;end=this._getChunk(a.end)*this.chunkSize+this.chunkSize-1;return{start:start,end:end}};FeatureCache.prototype.getFirstFeature=function(){return this.gzip?JSON.parse(RawDeflate.inflate(this.cache[Object.keys(this.cache)[0]].data[0])):this.cache[Object.keys(this.cache)[0]].data[0]};
FeatureCache.prototype.getFeaturesByChunk=function(a,b){var c=[],d,e,f;if(null!=this.cache[a]&&null!=this.cache[a][b]){for(var g=0,j=this.cache[a][b].length;g<j;g++){d=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[a][b][g])):this.cache[a][b][g];var h=!1;e=this._getChunk(d.start);for(f=this._getChunk(d.end);e<=f;e++)if(!0==this.chunksDisplayed[d.chromosome+":"+e+b]){h=!0;break}h||(c.push(d),returnNull=!1)}this.chunksDisplayed[a+b]=!0;return c}return null};
FeatureCache.prototype.getFeaturesByRegion=function(a,b){var c,d,e,f=[],g,j,h=!0,k;c=this._getChunk(a.start);d=this._getChunk(a.end);for(var l=c;l<=d;l++){j=a.chromosome+":"+l;if(null!=this.cache[j]&&null!=this.cache[j][b])for(var m=0,n=this.cache[j][b].length;m<n;m++){if(this.gzip)try{g=JSON.parse(RawDeflate.inflate(this.cache[j][b][m]))}catch(o){console.log(o);debugger}else g=this.cache[j][b][m];if(g.end>a.start&&g.start<a.end){k=!1;e=this._getChunk(g.start);for(c=this._getChunk(g.end);e<=c;e++)if(!0==
this.chunksDisplayed[a.chromosome+":"+e+b]){k=!0;break}k||(f.push(g),h=!1)}}this.chunksDisplayed[j+b]=!0}return h?null:f};
FeatureCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,j,h;console.time("-----"+c);var k=0;f=this._getChunk(b.start);g=this._getChunk(b.end);for(var l=f;l<=g;l++)e=b.chromosome+":"+l,null==this.cache[e]&&(this.cache[e]={}),null==this.cache[e][d]&&(this.cache[e][d]=[]);a.constructor!=Array&&(a=[a]);for(var m=0,n=a.length;m<n;m++){h=a[m];h.featureType=c;e=this._getChunk(h.start);j=this._getChunk(h.end);this.gzip?(h=RawDeflate.deflate(JSON.stringify(h)),k+=h.length):k+=JSON.stringify(h).length;
for(l=e;l<=j;l++)l>=f&&l<=g&&(e=b.chromosome+":"+l,this.cache[e][d].push(h))}console.timeEnd("-----"+c);console.log("-----"+k)};FeatureCache.prototype.putChunk=function(a,b){this.cache[a]=b};FeatureCache.prototype.getChunk=function(a){return this.cache[a]};FeatureCache.prototype.putCustom=function(a){a(this)};FeatureCache.prototype.getCustom=function(a){a(this)};
FeatureCache.prototype.remove=function(a){for(var b=this._getChunk(a.start),c=this._getChunk(a.end);b<=c;b++)this.cache[a.chromosome+":"+b]=null};FeatureCache.prototype.clear=function(){this.size=0;this.cache={}};FeatureCache.prototype.clearType=function(a){this.cache[a]=null};
FeatureCache.prototype.putFeatures=function(a,b){var c,d,e;a.constructor!=Array&&(a=[a]);for(var f=0,g=a.length;f<g;f++){c=a[f];d=this._getChunk(c.start);e=this._getChunk(c.end);for(var j=d;j<=e;j++)d=c.chromosome+":"+j,null==this.cache[d]&&(this.cache[d]=[]),null==this.cache[d][b]&&(this.cache[d][b]=[]),this.gzip?this.cache[d][b].push(RawDeflate.deflate(JSON.stringify(c))):this.cache[d][b].push(c)}};
FeatureCache.prototype.putChunk=function(a,b,c){var d;d=this._getChunk(b.start);d=b.chromosome+":"+d;null==this.cache[d]&&(this.cache[d]=[]);null==this.cache[d][c]&&(this.cache[d][c]=[]);if(a.constructor==Object)this.gzip?this.cache[d][c].push(RawDeflate.deflate(JSON.stringify(a))):this.cache[d][c].push(a);else for(var e=0,f=a.length;e<f;e++)b=a[e],this.gzip?this.cache[d][c].push(RawDeflate.deflate(JSON.stringify(b))):this.cache[d][c].push(b)};
FeatureCache.prototype.histogram=function(a,b){for(var c=(a.end-a.start+1)/b,d=[],e=0;e<c;e++){var f=0,g=(e+1)*b-1,j=this._getChunk(e*b+a.start),g=this._getChunk(g+a.start);for(console.log(this.cache);j<=g;j++){var h=a.chromosome+":"+j;console.log(h);console.log(this.cache[h]);for(var k=0,l=this.cache[h].length;k<l;k++)feature=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[h][k])):this.cache[h][k],f++}d[e]=f;this.maxFeaturesInterval<f&&(this.maxFeaturesInterval=f)}for(var m in d)d[m]/=this.maxFeaturesInterval};
function FeatureDataAdapter(a,b){this.dataSource=a;this.gzip=!0;this.params={};if(null!=b&&(null!=b.gzip&&(this.gzip=b.gzip),null!=b.species&&(this.species=b.species),null!=b.params))this.params=b.params;this.featureCache=new FeatureCache({chunkSize:1E4,gzip:this.gzip});this.onLoad=new Event;this.onGetData=new Event}
FeatureDataAdapter.prototype.getData=function(a){console.log("XXX comprobar histograma");console.log(a);a=this.featureCache.getFeaturesByRegion(a,"data");null!=a&&this.onGetData.notify({data:a,params:this.params,cached:!0})};FeatureDataAdapter.prototype.addFeatures=function(a){this.featureCache.putFeatures(a,"data")};
function ChromosomeWidget(a,b){this.id=Math.round(1E7*Math.random());if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.species&&(this.species=b.species),null!=b.chromosome&&(this.chromosome=b.chromosome),null!=b.zoom&&(this.zoom=b.zoom),null!=b.position))this.position=b.position;this._createPixelsbyBase();this.tracksViewedRegion=this.width/this._getPixelsbyBase(this.zoom);this.onClick=new Event;this.svg=SVG.init(a,{width:this.width,height:this.height});
this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.data=null}ChromosomeWidget.prototype.setWidth=function(a){this.width=a;this.svg.setAttribute("width",a);for(this.tracksViewedRegion=a/this._getPixelsbyBase(this.zoom);this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this._drawSvg(this.data)};
ChromosomeWidget.prototype.drawChromosome=function(){var a=this,b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.data=d;a._drawSvg(d)});b.get("genomic","region",this.chromosome,"cytoband")};
ChromosomeWidget.prototype._drawSvg=function(a){var b=this;b.pixelBase=(b.width-40)/a.result[0][a.result[0].length-1].end;var c=20,d=!0,e=b.position*b.pixelBase+20,f=SVG.addChild(b.svg,"g",{cursor:"pointer"});$(f).click(function(a){var c=parseInt((a.clientX-20)/b.pixelBase),d=parseFloat(b.positionBox.getAttribute("width"));b.positionBox.setAttribute("x",a.clientX-d/2);b.onClick.notify(c)});for(var g=0;g<a.result[0].length;g++){var j=b.pixelBase*(a.result[0][g].end-a.result[0][g].start),h=b.colors[a.result[0][g].stain];
null==h&&(h="purple");var k=a.result[0][g].cytoband,l=c+j/2;if("acen"==a.result[0][g].stain){var m="",m=c+j;d?(m=c+",10 "+l+",10 "+m+",19 "+l+",28 "+c+",28",d=!1):m=c+",19 "+l+",10 "+m+",10 "+m+",28 "+l+",28";SVG.addChild(f,"polyline",{points:m,stroke:"black",opacity:0.8,fill:h})}else SVG.addChild(f,"rect",{x:c,y:10,width:j,height:18,stroke:"black",opacity:0.8,fill:h});SVG.addChild(b.svg,"text",{x:l,y:30,"font-size":10,transform:"rotate(90, "+l+", 30)",fill:"black"}).textContent=k;c+=j}a=b.tracksViewedRegion*
b.pixelBase;b.positionBox=SVG.addChild(f,"rect",{x:e-a/2,y:2,width:a,height:b.height-2,stroke:"orangered","stroke-width":2,opacity:0.5,fill:"orange"})};
ChromosomeWidget.prototype.setLocation=function(a){var b=!1;null!=a.species&&(this.species=a.species,b=!0);null!=a.chromosome&&(this.chromosome=a.chromosome,b=!0);if(null!=a.position){this.position=a.position;var a=this.position*this.pixelBase+20,c=parseFloat(this.positionBox.getAttribute("width"));this.positionBox.setAttribute("x",a-c/2)}if(b){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.drawChromosome()}};
ChromosomeWidget.prototype.setZoom=function(a){this.zoom=a;this.tracksViewedRegion=this.width/this._getPixelsbyBase(this.zoom);a=this.tracksViewedRegion*this.pixelBase;this.positionBox.setAttribute("width",a);this.positionBox.setAttribute("x",this.position*this.pixelBase+20-a/2)};ChromosomeWidget.prototype._getPixelsbyBase=function(a){return this.zoomLevels[a]};ChromosomeWidget.prototype._createPixelsbyBase=function(){this.zoomLevels=[];for(var a=10,b=100;-40<=b;b-=5)this.zoomLevels[b]=a,a/=2};
function CircularChromosomeWidget(a,b){var c=this;this.coord_x=400;this.coord_y=250;this.radius=200;this.stroke_width=20;if(null!=b&&(null!=b.coord_x&&(this.coord_x=b.coord_x),null!=b.coord_y&&(this.coord_y=b.coord_y),null!=b.radius&&(this.radius=b.radius),null!=b.stroke_width))this.stroke_width=b.stroke_width;this.circleLength=2*Math.PI*this.radius;this.y_point2=this.x_point2=this.y_point=this.x_point=this.angle_click=this.pixelRatio=this.chroLength=this.d=null;this.sep=27;this.angle_lines=Math.PI/
6;this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.mySvg=document.createElementNS("http://www.w3.org/2000/svg","svg");console.log(this.mySvg);this.mySvg.setAttribute("width","1000");this.mySvg.setAttribute("height","600");a.appendChild(this.mySvg);$.ajax({url:"http://ws-beta.bioinfo.cipf.es/cellbase/rest/latest/hsa/genomic/region/13/cytoband?of=json"}).done(function(a){c.d=
JSON.parse(a);c.chroLength=c.d[0][c.d[0].length-1].end;c.pixelRatio=c.chroLength/c.circleLength;$(c.mySvg).click(function(a){var d,h,k,l;d=c.coord_x;h=c.radius+c.coord_y+c.stroke_width/2;k=c.coord_x;l=c.radius+c.coord_y-c.stroke_width/2;d=Math.sqrt(Math.pow(d-c.coord_x,2)+Math.pow(h-c.coord_y,2));k=Math.sqrt(Math.pow(k-c.coord_x,2)+Math.pow(l-c.coord_y,2));l=Math.sqrt(Math.pow(a.clientX-c.coord_x,2)+Math.pow(a.clientY-c.coord_y,2));h=!1;l>=k&&l<=d&&(h=!0);if(h){c.angle_click=0;a.clientX>c.coord_x&&
a.clientY<c.coord_y?c.angle_click=Math.atan((a.clientX-c.coord_x)/(c.coord_y-a.clientY)):a.clientX>c.coord_x&&a.clientY>c.coord_y?c.angle_click=Math.PI/2+Math.atan((a.clientY-c.coord_y)/(a.clientX-c.coord_x)):a.clientX<c.coord_x&&a.clientY>c.coord_y?c.angle_click=Math.PI+Math.atan((c.coord_x-a.clientX)/(a.clientY-c.coord_y)):a.clientX<c.coord_x&&a.clientY<c.coord_y&&(c.angle_click=3*Math.PI/2+Math.atan((c.coord_y-a.clientY)/(c.coord_x-a.clientX)));a=2*Math.PI;d=c.angle_click*c.circleLength/a*c.pixelRatio;
k=0;for(l=!0;k<c.d[0].length&&l;)c.d[0][k].start<=d&&c.d[0][k].end>=d&&(l=!1),k++;console.log(parseInt(d));c.x_point=(c.radius+c.sep)*Math.cos(c.angle_click)+c.coord_x;c.y_point=(c.radius+c.sep)*Math.sin(c.angle_click)+c.coord_y;c.x_point2=(c.radius-c.sep)*Math.cos(c.angle_click)+c.coord_x;c.y_point2=(c.radius-c.sep)*Math.sin(c.angle_click)+c.coord_y;b.setAttribute("x1",c.x_point);b.setAttribute("y1",c.y_point);b.setAttribute("x2",c.x_point2);b.setAttribute("y2",c.y_point2);d=[];0>c.angle_click-c.angle_lines?
(d.push((c.angle_click+c.angle_lines)*c.circleLength/a),d.push((a-2*c.angle_lines)*c.circleLength/a),d.push((c.angle_lines-c.angle_click)*c.circleLength/a+2)):c.angle_click+c.angle_lines>a?(d.push((c.angle_lines-(a-c.angle_click))*c.circleLength/a),d.push((a-2*c.angle_lines)*c.circleLength/a),d.push((c.angle_lines+(a-c.angle_click))*c.circleLength/a+2)):(d.push(0),d.push((c.angle_click-c.angle_lines)*c.circleLength/a),d.push(2*c.angle_lines*c.circleLength/a),d.push((a-(c.angle_click-c.angle_lines)+
2*c.angle_lines)*c.circleLength/a));f.setAttribute("cx",c.coord_x);f.setAttribute("cy",c.coord_y);f.setAttribute("r",c.radius);f.setAttribute("stroke-dasharray",d.toString())}});var b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("stroke","red");b.setAttribute("stroke-width",1);b.setAttribute("transform","rotate(-90,"+c.coord_x+","+c.coord_y+")");c.mySvg.appendChild(b);c.drawChromosome();var f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("fill",
"transparent");f.setAttribute("stroke","orange");f.setAttribute("opacity","0.2");f.setAttribute("stroke-width",55);f.setAttribute("transform","rotate(-90,"+c.coord_x+","+c.coord_y+")");c.mySvg.appendChild(f)})}
CircularChromosomeWidget.prototype.drawChromosome=function(){this.chroLength=this.d[0][this.d[0].length-1].end;var a=[],b=0,c=[],d=!0;c.push(this.d[0][0].stain);for(b=1;b<=this.d[0].length-1;b++){for(var e=0;e<=c.length-1;e++)c[e]==this.d[0][b].stain&&(d=!1);d&&c.push(this.d[0][b].stain);d=!0}for(var d=null,f=!0,e=0;e<c.length;e++){for(var g=0;g<this.d[0].length;g++)this.d[0][g].stain==c[e]&&(f?(0==g&&1==this.d[0][g].start||(a.push(0),b=this.d[0][g].start-1,b/=this.pixelRatio,a.push(b)),b=this.d[0][g].end-
this.d[0][g].start,b/=this.pixelRatio,a.push(b),d=g,f=!1):(b=this.d[0][g].start-this.d[0][d].end,b/=this.pixelRatio,"blue"==this.colors[c[e]]?a.push(2):a.push(b),b=this.d[0][g].end-this.d[0][g].start,b/=this.pixelRatio,a.push(b),d=g));b=this.chroLength-this.d[0][d].end;b/=this.pixelRatio;a=a+","+b;b=e;f=c;g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("cx",this.coord_x);g.setAttribute("cy",this.coord_y);g.setAttribute("r",this.radius);g.setAttribute("fill","transparent");
g.setAttribute("stroke",this.colors[f[b]]);g.setAttribute("stroke-width",this.stroke_width);g.setAttribute("transform","rotate(-90,"+this.coord_x+","+this.coord_y+")");g.setAttribute("stroke-dasharray",a.toString());this.mySvg.appendChild(g);a=[];f=!0}};
function KaryotypeWidget(a,b){this.parent=a;this.id=Math.round(1E7*Math.random());if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.species&&(this.species=b.species),null!=b.chromosome&&(this.chromosome=b.chromosome),null!=b.position))this.position=b.position;this.onClick=new Event;this.afterRender=new Event;this.rendered=!1;this.svg=SVG.init(a,{width:this.width,height:this.height});this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"});this.colors=
{gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.data2=this.chromosomeList=null}KaryotypeWidget.prototype.setWidth=function(a){this.width=a;for(this.svg.setAttribute("width",a);this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this._drawSvg(this.chromosomeList,this.data2)};
KaryotypeWidget.prototype.drawKaryotype=function(){var a=this,b=function(a,b){for(var c=!0,g=0;g<a.length&&!0==c;g++)isNaN(a[g])&&(c=!1);return!c?1:a-b},c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){a.chromosomeList=e.result;a.chromosomeList.sort(b);var f=new CellBaseManager(a.species);f.success.addEventListener(function(b,c){a.data2=c;a._drawSvg(a.chromosomeList,c)});f.get("genomic","region",a.chromosomeList.toString(),"cytoband")});c.get("feature","karyotype","none",
"chromosome")};
KaryotypeWidget.prototype._drawSvg=function(a,b){for(var c=this,d=20,e=c.width/a.length,f=0,g=0,j=a.length;g<j;g++){var h=b.result[g][b.result[g].length-1].end;h>f&&(f=h)}c.pixelBase=(c.height-10)/f;c.chrOffsetY={};c.chrOffsetX={};g=0;for(j=a.length;g<j;g++){h=b.result[g][0].chromosome;chrSize=b.result[g][b.result[g].length-1].end*c.pixelBase;var k=2+f*c.pixelBase-chrSize;c.chrOffsetY[h]=k;var l=!0,m=c.position*c.pixelBase,n=SVG.addChild(c.svg,"g",{cursor:"pointer",chr:a[g]});$(n).click(function(a){var b=this.getAttribute("chr"),
a=a.pageY-$(c.svg).offset().top;c.positionBox.setAttribute("x1",c.chrOffsetX[b]-10);c.positionBox.setAttribute("x2",c.chrOffsetX[b]+23);c.positionBox.setAttribute("y1",a);c.positionBox.setAttribute("y2",a);a=parseInt((a-c.chrOffsetY[b])/c.pixelBase);c.chromosome=b;c.onClick.notify({chromosome:c.chromosome,position:a})});for(var o=0,p=b.result[g].length;o<p;o++){var r=c.pixelBase*(b.result[g][o].end-b.result[g][o].start),s=c.colors[b.result[g][o].stain];null==s&&(s="purple");if("acen"==b.result[g][o].stain){var t=
"",t=d+6.5,v=k+r/2,u=d+13,q=k+r;l?(t=d+","+k+" "+u+","+k+" "+u+","+v+" "+t+","+q+" "+d+","+v,l=!1):t=d+","+q+" "+d+","+v+" "+t+","+k+" "+u+","+v+" "+u+","+q;SVG.addChild(n,"polyline",{points:t,stroke:"black",opacity:0.8,fill:s})}else SVG.addChild(n,"rect",{x:d,y:k,width:13,height:r,stroke:"grey",opacity:0.8,fill:s});k+=r}SVG.addChild(c.svg,"text",{x:d+1,y:c.height,"font-size":9,fill:"black"}).textContent=h;c.chrOffsetX[h]=d;d+=e}c.positionBox=SVG.addChild(c.svg,"line",{x1:c.chrOffsetX[c.chromosome]-
10,y1:m+c.chrOffsetY[c.chromosome],x2:c.chrOffsetX[c.chromosome]+23,y2:m+c.chrOffsetY[c.chromosome],stroke:"orangered","stroke-width":2,opacity:0.5});c.rendered=!0;c.afterRender.notify()};
KaryotypeWidget.prototype.setLocation=function(a){var b=!1;null!=a.species&&(this.species=a.species,b=!0);null!=a.chromosome&&(this.chromosome=a.chromosome,null==a.species&&(this.positionBox.setAttribute("x1",this.chrOffsetX[this.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[this.chromosome]+23)));null!=a.position&&(this.position=a.position,null==a.species&&(a=this.position*this.pixelBase+this.chrOffsetY[this.chromosome],this.positionBox.setAttribute("y1",a),this.positionBox.setAttribute("y2",
a)));if(b){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.drawKaryotype()}};KaryotypeWidget.prototype.updatePositionBox=function(a){this.chromosome=a.chromosome;this.position=a.position;this.positionBox.setAttribute("x1",this.chrOffsetX[this.chromosome]-10);this.positionBox.setAttribute("x2",this.chrOffsetX[this.chromosome]+23);a=this.position*this.pixelBase+this.chrOffsetY[this.chromosome];this.positionBox.setAttribute("y1",a);this.positionBox.setAttribute("y2",a)};
KaryotypeWidget.prototype.addMark=function(a){var b=this,c=function(){if(null!=a.chromosome&&null!=a.start&&null!=b.chrOffsetX[a.chromosome]){var c=b.chrOffsetX[a.chromosome]-10,e=a.start*b.pixelBase+b.chrOffsetY[a.chromosome]-4;SVG.addChild(b.markGroup,"polyline",{points:c+","+e+" "+b.chrOffsetX[a.chromosome]+","+(a.start*b.pixelBase+b.chrOffsetY[a.chromosome])+" "+c+","+(a.start*b.pixelBase+b.chrOffsetY[a.chromosome]+4)+" "+c+","+e,stroke:"black",opacity:0.8,fill:"#33FF33"})}};this.rendered?c():
this.afterRender.addEventListener(function(){c()})};KaryotypeWidget.prototype.unmark=function(){for(;this.markGroup.firstChild;)this.markGroup.removeChild(this.markGroup.firstChild)};function DataSource(){}DataSource.prototype.fetch=function(){};
function CellBaseAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a){null!=a.host&&(this.host=a.host);null!=a.species&&(this.species=a.species);null!=a.category&&(this.category=a.category);null!=a.subCategory&&(this.subCategory=a.subCategory);null!=a.resource&&(this.resource=a.resource);if(null!=a.featureCache)var b=a.featureCache;null!=a.params&&(this.params=a.params)}this.featureCache=new FeatureCache(b);this.onGetData=new Event}
CellBaseAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);a.transcript&&(c="withTranscripts");for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var j=a.chromosome+":"+d;null==this.featureCache.cache[j]||null==this.featureCache.cache[j][c]?f.push(d):
(j=this.featureCache.getFeaturesByChunk(j,c),g=g.concat(j))}c=new CellBaseManager(this.species,{host:this.host});c.success.addEventListener(function(a,c){console.timeEnd("cellbase");console.time("insertCache "+c.resource);var d="data";c.params.histogram&&(d="histogram"+c.params.interval);c.params.transcript&&(d="withTranscripts");if(c.params.histogram==true)c.result=[c.result];for(var e=[],f=0;f<c.query.length;f++){var h=c.query[f].split(":"),j=h[1].split("-");e.push({chromosome:h[0],start:j[0],end:j[1]})}for(f=
0;f<c.result.length;f++){c.result[f].constructor!=Array&&(c.result[f]=[c.result[f]]);if(c.resource=="gene"&&c.params.transcript!=null){h=0;for(j=c.result[f].length;h<j;h++)for(var l=0,k=c.result[f][h].transcripts.length;l<k;l++){c.result[f][h].transcripts[l].featureType="transcript";for(var q=0,B=c.result[f][h].transcripts[l].exonToTranscripts.length;q<B;q++)c.result[f][h].transcripts[l].exonToTranscripts[q].exon.featureType="exon"}}b.featureCache.putFeaturesByRegion(c.result[f],e[f],c.resource,d);
h=b.featureCache.getFeaturesByRegion(e[f],d);console.timeEnd("insertCache "+c.resource);h!=null&&(g=g.concat(h))}g.length>0&&b.onGetData.notify({data:g,params:b.params,cached:false})});var e=[],h=j=!0;if(0<f.length){for(d=0;d<f.length;d++){if(j)var k=parseInt(f[d]*this.featureCache.chunkSize),j=!1;if(h)var l=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),h=!1;null!=f[d+1]?f[d]+1!=f[d+1]&&(j=a.chromosome+":"+k+"-"+l,e.push(j),j=!0):(j=a.chromosome+":"+k+"-"+l,e.push(j),j=
!0);h=!0}console.time("cellbase");c.get(this.category,this.subCategory,e,this.resource,this.params)}else 0<g.length&&this.onGetData.notify({data:g,params:this.params})};FileDataSource.prototype.fetch=DataSource.prototype.fetch;function FileDataSource(a){DataSource.prototype.constructor.call(this);this.file=a;this.success=new Event;this.error=new Event}FileDataSource.prototype.error=function(){alert("File is too big. Max file size is 100 Mbytes.")};
FileDataSource.prototype.fetch=function(a){var b=this;if(104857600>=this.file.size)if(a)a=new FileReader,a.onload=function(a){b.success.notify(a.target.result)},a.readAsText(this.file,"UTF-8");else return a=new FileReaderSync,a.readAsText(this.file,"UTF-8");else b.error(),b.error.notify()};StringDataSource.prototype.fetch=DataSource.prototype.fetch;function StringDataSource(a){DataSource.prototype.constructor.call(this);this.str=a;this.success=new Event}
StringDataSource.prototype.fetch=function(a){if(a)this.success.notify(this.str);else return this.str};UrlDataSource.prototype.fetch=DataSource.prototype.fetch;
function UrlDataSource(a,b){DataSource.prototype.constructor.call(this);this.url=a;this.proxy="http://ws-beta.bioinfo.cipf.es/cellbase/rest/v1/utils/proxy?url=";null!=b&&null!=b.proxy&&("boolean"==typeof b.proxy?!1==b.proxy?this.proxy=!1:this.url=this.proxy+a:"string"==typeof b.proxy&&(this.url=b.proxy+a));this.success=new Event;this.error=new Event}
UrlDataSource.prototype.fetch=function(a){var b=this,c=null;if(this.url)return $.ajax({type:"GET",url:this.url,async:a,success:function(d){a?b.success.notify(d):c=d},error:function(a,c,f){console.log("URL Data source: Ajax call returned : "+f+"\t"+c+"\t"+a.statusText+" END");b.error.notify()}}),c};VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function VCFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;debugger;this.featuresCount=0;this.featuresByChromosome={};this.header="";this.samples=[];null!=b&&null!=b.async&&(this.async=b.async);if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}}
VCFDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");if(null!=c&&0<c.length){var d=c.split("\t");"#"===c.substr(0,1)?"#"===c.substr(1,1)?this.header+=c.replace(/</gi,"&#60;").replace(/>/gi,"&#62;")+"<br>":this.samples=d.slice(9):(c={chromosome:d[0],position:parseInt(d[1]),start:parseInt(d[1]),end:parseInt(d[1]),id:d[2],ref:d[3],alt:d[4],quality:d[5],filter:d[6],info:d[7].replace(/;/gi,"<br>"),format:d[8],sampleData:c,featureType:"vcf"},
this.featureCache.putFeatures(c,"data"),null==this.featuresByChromosome[d[0]]&&(this.featuresByChromosome[d[0]]=0),this.featuresByChromosome[d[0]]++,this.featuresCount++)}}};GFF2DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function GFF2DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async);if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}}
GFF2DataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");if(null!=c&&0<c.length){var d=c.split("\t"),c=d[0].replace("chr",""),d={chromosome:c,label:d[2],start:parseInt(d[3]),end:parseInt(d[4]),score:parseFloat(d[5]),strand:d[6],frame:d[7],group:d[8],featureType:"gff2"};this.featureCache.putFeatures(d,"data");null==this.featuresByChromosome[c]&&(this.featuresByChromosome[c]=0);this.featuresByChromosome[c]++;this.featuresCount++}}};
GFF3DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;function GFF3DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async);if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}}
GFF3DataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");if(null!=c&&0<c.length){for(var d=c.split("\t"),e=c=d[0].replace("chr",""),f=d[2],g=parseInt(d[3]),j=parseInt(d[4]),h=parseFloat(d[5]),k=d[6],l=d[7],d=d[8].split(";"),m={},n=0,o=d.length;n<o;n++){var p=d[n].split("=");m[p[0]]=p[1]}this.featureCache.putFeatures({chromosome:e,label:f,start:g,end:j,score:h,strand:k,frame:l,attributes:m,featureType:"gff3"},"data");null==this.featuresByChromosome[c]&&
(this.featuresByChromosome[c]=0);this.featuresByChromosome[c]++;this.featuresCount++}}};GTFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function GTFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async);if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}}
GTFDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");if(null!=c&&0<c.length){for(var d=c.split("\t"),e=c=d[0].replace("chr",""),f=d[2],g=parseInt(d[3]),j=parseInt(d[4]),h=parseFloat(d[5]),k=d[6],l=d[7],d=d[8].split(";"),m={},n=0,o=d.length;n<o;n++){var p=d[n].split("=");m[p[0]]=p[1]}this.featureCache.putFeatures({chromosome:e,label:f,start:g,end:j,score:h,strand:k,frame:l,attributes:m,featureType:"gtf"},"data");null==this.featuresByChromosome[c]&&
(this.featuresByChromosome[c]=0);this.featuresByChromosome[c]++;this.featuresCount++}}};BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function BEDDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async);if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}}
BEDDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");if(null!=c&&0<c.length){var d=c.split("\t"),c=d[0].replace("chr",""),d={label:d[3],chromosome:c,start:parseFloat(d[1]),end:parseFloat(d[2]),score:d[4],strand:d[5],thickStart:d[6],thickEnd:d[7],itemRgb:d[8],blockCount:d[9],blockSizes:d[10],blockStarts:d[11],featureType:"bed"};this.featureCache.putFeatures(d,"data");null==this.featuresByChromosome[c]&&(this.featuresByChromosome[c]=
0);this.featuresByChromosome[c]++;this.featuresCount++}}};function TabularDataAdapter(a,b){var c=this;this.dataSource=a;this.async=!0;null!=b&&null!=b.async&&(this.async=b.async);this.fileLines=[];if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}this.onLoad=new Event}TabularDataAdapter.prototype.getLines=function(){return this.fileLines};
TabularDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,""),c=c.replace(/\//gi,"");null!=c&&(0<c.length&&"#"!=c.charAt(0))&&(c=c.split("\t"),this.fileLines.push(c))}};TabularDataAdapter.prototype.getLinesCount=function(){return this.fileLines.length};TabularDataAdapter.prototype.getValuesByColumnIndex=function(a){for(var b=[],c=0;c<this.getLinesCount();c++)null!=this.getLines()[c][a]&&b.push(this.getLines()[c][a]);return b};
TabularDataAdapter.prototype.getHeuristicTypeByColumnIndex=function(a){return this.getHeuristicTypeByValues(this.getValuesByColumnIndex(a))};TabularDataAdapter.prototype.getHeuristicTypeByValues=function(a){for(var b=/^[-+]?[0-9]*\.?[0-9]+$/,c=0;c<a.length;c++)if(!b.test((new String(a[c])).replace(",",".")))return"string";return"numeric"};
function DasAdapter(a){this.gzip=!0;this.proxy="http://ws-beta.bioinfo.cipf.es/cellbase/rest/v1/utils/proxy?url=";this.params={};if(null!=a){null!=a.url&&(this.url=a.url);null!=a.species&&(this.species=a.species);if(null!=a.featureCache)var b=a.featureCache;null!=a.params&&(this.params=a.params)}this.featureCache=new FeatureCache(b);this.onGetData=new Event;this.onCheckUrl=new Event;this.onError=new Event}
DasAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var j=a.chromosome+":"+d;null==this.featureCache.cache[j]||null==this.featureCache.cache[j][c]?f.push(d):(j=this.featureCache.getFeaturesByChunk(j,
c),g=g.concat(j))}0<g.length&&this.onGetData.notify({data:g,params:this.params,cached:!0});g=e=!0;if(0<f.length)for(d=0;d<f.length;d++){j=null;if(e)var h=parseInt(f[d]*this.featureCache.chunkSize),e=!1;if(g)var k=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),g=!1;null!=f[d+1]?f[d]+1!=f[d+1]&&(j=a.chromosome+":"+h+","+k,e=!0):(j=a.chromosome+":"+h+","+k,e=!0);g=!0;j&&(j=this.proxy+this.url+"?segment="+j,console.log("fullURL: "+j),$.ajax({url:j,type:"GET",dataType:"xml",error:function(){alert("error");
b.onError.notify("It is not allowed by Access-Control-Allow-Origin ")},success:function(d){b.xml=(new XMLSerializer).serializeToString(d);var e=(new XMLSerializer).serializeToString(d),d=xml2json.parser(e),e=[];if(typeof d.dasgff.gff.segment!="undefined")if(typeof d.dasgff.gff.segment.feature!="undefined")e=d.dasgff.gff.segment.feature;else if(typeof d.dasgff.gff.segment[0]!="undefined")if(d.dasgff.gff.segment[0].feature!=null)for(var f=0;f<d.dasgff.gff.segment.length;f++)for(var g=0;g<d.dasgff.gff.segment[f].feature.length;g++){d.dasgff.gff.segment[f].feature[g].chromosome=
a.chromosome;e.push(d.dasgff.gff.segment[f].feature[g])}else e.push([]);d={chromosome:a.chromosome,start:h,end:k};b.featureCache.putFeaturesByRegion(e,d,"das",c);console.log(b.featureCache.cache);e=b.featureCache.getFeaturesByRegion(d,c);e!=null&&b.onGetData.notify({data:e,params:this.params,cached:false})}}))}};
DasAdapter.prototype.checkUrl=function(){var a=this,b=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+b);$.ajax({url:b,type:"GET",dataType:"xml",error:function(){alert("error");a.onError.notify("It is not allowed by Access-Control-Allow-Origin ")},success:function(b){a.xml=(new XMLSerializer).serializeToString(b);a.onCheckUrl.notify({data:a.xml})}})};
function CellBaseAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a){null!=a.host&&(this.host=a.host);null!=a.species&&(this.species=a.species);null!=a.category&&(this.category=a.category);null!=a.subCategory&&(this.subCategory=a.subCategory);null!=a.resource&&(this.resource=a.resource);if(null!=a.featureCache)var b=a.featureCache;null!=a.params&&(this.params=a.params)}this.featureCache=new FeatureCache(b);this.onGetData=new Event}
CellBaseAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);a.transcript&&(c="withTranscripts");for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var j=a.chromosome+":"+d;null==this.featureCache.cache[j]||null==this.featureCache.cache[j][c]?f.push(d):
(j=this.featureCache.getFeaturesByChunk(j,c),g=g.concat(j))}c=new CellBaseManager(this.species,{host:this.host});c.success.addEventListener(function(a,c){console.timeEnd("cellbase");console.time("insertCache "+c.resource);var d="data";c.params.histogram&&(d="histogram"+c.params.interval);c.params.transcript&&(d="withTranscripts");if(c.params.histogram==true)c.result=[c.result];for(var e=[],f=0;f<c.query.length;f++){var h=c.query[f].split(":"),j=h[1].split("-");e.push({chromosome:h[0],start:j[0],end:j[1]})}for(f=
0;f<c.result.length;f++){c.result[f].constructor!=Array&&(c.result[f]=[c.result[f]]);if(c.resource=="gene"&&c.params.transcript!=null){h=0;for(j=c.result[f].length;h<j;h++)for(var k=0,l=c.result[f][h].transcripts.length;k<l;k++){c.result[f][h].transcripts[k].featureType="transcript";for(var q=0,B=c.result[f][h].transcripts[k].exonToTranscripts.length;q<B;q++)c.result[f][h].transcripts[k].exonToTranscripts[q].exon.featureType="exon"}}b.featureCache.putFeaturesByRegion(c.result[f],e[f],c.resource,d);
h=b.featureCache.getFeaturesByRegion(e[f],d);console.timeEnd("insertCache "+c.resource);h!=null&&(g=g.concat(h))}g.length>0&&b.onGetData.notify({data:g,params:b.params,cached:false})});var e=[],h=j=!0;if(0<f.length){for(d=0;d<f.length;d++){if(j)var k=parseInt(f[d]*this.featureCache.chunkSize),j=!1;if(h)var l=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),h=!1;null!=f[d+1]?f[d]+1!=f[d+1]&&(j=a.chromosome+":"+k+"-"+l,e.push(j),j=!0):(j=a.chromosome+":"+k+"-"+l,e.push(j),j=
!0);h=!0}console.time("cellbase");c.get(this.category,this.subCategory,e,this.resource,this.params)}else 0<g.length&&this.onGetData.notify({data:g,params:this.params})};VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;VCFFileWidget.prototype.draw=FileWidget.prototype.draw;VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;
VCFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;VCFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function VCFFileWidget(a){null==a&&(a={});a.title="VCF";a.tags=["vcf"];FileWidget.prototype.constructor.call(this,a)}
VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new VCFDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){console.log(b.adapter.featuresByChromosome);b._loadChartInfo();b.btnOk.enable()})};
VCFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};debugger;this.adapter=new VCFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GFFFileWidget.prototype.draw=FileWidget.prototype.draw;GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;
GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;GFFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;GFFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function GFFFileWidget(a){null==a&&(a={});this.version="2";null!=a.version&&(this.version=a.version);a.title="GFF"+this.version;a.tags=["gff"];FileWidget.prototype.constructor.call(this,a)}
GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;switch(this.version){case "2":this.adapter=new GFF2DataAdapter(new FileDataSource(a),{species:this.viewer.species});break;case "3":this.adapter=new GFF3DataAdapter(new FileDataSource(a),{species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new FileDataSource(a),{species:this.viewer.species})}this.adapter.onLoad.addEventListener(function(){b._loadChartInfo();b.btnOk.enable()})};
GFFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};switch(this.version){case "2":this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;case "3":this.adapter=new GFF3DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species})}this._loadChartInfo();this.btnOk.enable()};
GTFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GTFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GTFFileWidget.prototype.draw=FileWidget.prototype.draw;GTFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GTFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;GTFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;GTFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;
function GTFFileWidget(a){null==a&&(a={});a.title="GTF";a.tags=["gtf"];FileWidget.prototype.constructor.call(this,a)}GTFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new GTFDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){console.log(b.adapter.featuresByChromosome);b._loadChartInfo();b.btnOk.enable()})};
GTFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new GTFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;BEDFileWidget.prototype.draw=FileWidget.prototype.draw;BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;
BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;BEDFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;BEDFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function BEDFileWidget(a){null==a&&(a={});a.title="BED";a.tags=["bed"];FileWidget.prototype.constructor.call(this,a)}
BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new BEDDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){b._loadChartInfo();b.btnOk.enable()})};BEDFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new BEDDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};
function InfoWidget(a,b,c){this.id="InfoWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.species=b;this.featureId=this.title=null;this.width=800;this.height=430;this.adapter=this.query=this.feature=null;null!=a&&(this.targetId=a);if(null!=c&&(null!=c.title&&(this.title=c.title),null!=c.width&&(this.width=c.width),null!=c.height))this.height=c.height;switch(b){case "hsa":this.ensemblSpecie="Homo_sapiens";this.reactomeSpecie="48887";this.wikipathwaysSpecie="Homo+sapiens";this.haphapSpecie=
this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie="";break;case "mmu":this.ensemblSpecies="Mus_musculus";this.reactomeSpecies="48892";this.wikipathwaysSpecie="Mus+musculus";this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie="";break;case "dre":this.ensemblSpecie="Danio_rerio",this.reactomeSpecie="68323",this.wikipathwaysSpecie="Danio+rerio",this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie=""}this.notFoundPanel=
Ext.create("Ext.panel.Panel",{id:this.id+"notFoundPanel",cls:"panel-border-left",border:!1,flex:3,bodyPadding:"40",html:"No results found"})}InfoWidget.prototype.draw=function(a){console.log(a);this.query=a.query;this.feature=a.feature;this.adapter=a.adapter;this.panel=Ext.getCmp(this.title+" "+this.query);null==this.panel?(this.render(),this.panel.show(),this.getData()):this.panel.show()};
InfoWidget.prototype.render=function(){this.panel=Ext.create("Ext.ux.Window",{title:this.title+" "+this.query,id:this.title+" "+this.query,minimizable:!0,constrain:!0,closable:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[this.getTreePanel()],buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})};
InfoWidget.prototype.getTreePanel=function(){var a=this.getdataTypes();this.checkDataTypes(a);a=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Options",children:a}});return Ext.create("Ext.tree.Panel",{title:"Detailed information",bodyPadding:10,flex:1,border:!1,store:a,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,c){this.optionClick(c.data)}}})};
InfoWidget.prototype.doGrid=function(a,b,c,d){for(var e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{[values.name]} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!0}),f=[],g=0;g<b.length;g++)f.push({type:"string",dataIndex:b[g]});f={ftype:"filters",local:!0,filters:f};Ext.define(c,{extend:"Ext.data.Model",fields:b});b=Ext.create("Ext.data.Store",{groupField:d,model:c});return Ext.create("Ext.grid.Panel",{id:this.id+c,store:b,title:c,border:!1,cls:"panel-border-left",
flex:3,features:[e,f],viewConfig:{enableTextSelection:!0},columns:a,bbar:["->",{text:"Clear Grouping",handler:function(){e.disable()}}]})};InfoWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)};InfoWidget.prototype.getdataTypes=function(){return[]};InfoWidget.prototype.optionClick=function(){};InfoWidget.prototype.getData=function(){};
InfoWidget.prototype.getGeneTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{externalName}</span> &nbsp; <span class="emph s120"> {stableId} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Location/View?g={stableId}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',
"</p><br>",'<p><span class="w75 dis s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" dis s90">Strand: </span> {strand}</p>','<p><span class="w75 dis s90">Biotype: </span> {biotype}</p>','<p><span class="w75 dis s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></p>',"<br>",'<p><span class="w75 dis s90">Source: </span> <span class="s110">{source}</span></p>','<p><span class="w75 dis s90">External DB: </span> {externalDb}</p>',
'<p><span class="w75 dis s90">Status: </span> {status}</p>')};
InfoWidget.prototype.getTranscriptTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{externalName}</span> &nbsp; <span class="emph s120"> {stableId} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={stableId}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',
"</p><br>",'<p><span class="w100 dis s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" dis s90">Strand: </span> {strand}</p>','<p><span class="w100 dis s90">Biotype: </span> {biotype}</p>','<p><span class="w100 dis s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></p>',"<br>",'<p><span class="w100 dis s90">CDS &nbsp; (start-end): </span> {codingRegionStart}-{codingRegionEnd} <span style="margin-left:50px" class="w100 dis s90">CDNA (start-end): </span> {cdnaCodingStart}-{cdnaCodingEnd}</p>',
"<br>",'<p><span class="w100 dis s90">External DB: </span> {externalDb}</p>','<p><span class="w100 dis s90">Status: </span> {status}</p><br>')};
InfoWidget.prototype.getSnpTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{name}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Variation/Summary?v={name}">Ensembl</a>',"</p><br>",'<p><span class="w140 dis s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" dis s90">Strand: </span> {strand}</p>','<p><span class="w140 dis s90">Source: </span> <span class="s110">{source}</span></p>',
"<br>",'<p><span class="w140 dis s90">Map weight: </span> {mapWeight}</p>','<p><span class="w140 dis s90">Allele string: </span> {alleleString}</p>','<p><span class="w140 dis s90">Ancestral allele: </span> {ancestralAllele}</p>','<p><span class="w140 dis s90">Display So consequence: </span> {displaySoConsequence}</p>','<p><span class="w140 dis s90">So consequence type: </span> {soConsequenceType}</p>','<p><span class="w140 dis s90">Display consequence: </span> {displayConsequence}</p>','<p><span class="w140 dis s90">Sequence: </span> {sequence}</p>')};
InfoWidget.prototype.getExonTemplate=function(){return new Ext.XTemplate('<span><span class="panel-border-bottom"><span class="ssel s110">{stableId}</span></span></span>','<span><span style="margin-left:30px" class="dis s90"> Location: </span> <span class="">{chromosome}:{start}-{end} </span></span>','<span><span style="margin-left:30px" class="dis s90"> Strand: </span> {strand}</span>')};
InfoWidget.prototype.getProteinTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {primaryAccession} </span></span></p>',"<br>",'<p><span class="w100 dis s90">Full name: </span> <span class="">{fullName}</span></p>','<p><span class="w100 dis s90">Gene name: </span> <span class="">{geneName}</span></p>','<p><span class="w100 dis s90">Organism: </span> <span class="">{organism}</span></p>')};
InfoWidget.prototype.getVCFVariantTemplate=function(){return new Ext.XTemplate('<p><span><span class="panel-border-bottom"><span class="ssel s130">{chromosome}:{start}-{alt}</span> &nbsp; <span class="emph s120"> {label} </span></span></span></p><br>','<p><span class="w75 dis s90">Alt: </span> {alt}</p>','<p><span class="w75 dis s90">Ref: </span> {ref}</p>','<p><span class="w75 dis s90">Quality: </span> {quality}</p>','<p><span class="w75 dis s90">Format: </span> {format}</p>','<p><span class="w75 dis s90">Samples: </span> {samples}</p>',
'<p><span class="w75 dis s90">Info: <br></span> {info}</p>')};
InfoWidget.prototype.getPWMTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{accession}</span> &nbsp; <span class="emph s120"> {tfName} </span></span></p>',"<br>",'<p><span class="w100 dis s90">Type: </span> <span class="">{source}</span></p>','<p><span class="w100 dis s90">Source: </span> <span class="">{type}</span></p>','<p><span class="w100 dis s90">Description: </span> <span class="">{description}</span></p>','<p><span class="w100 dis s90">Length: </span> <span class="">{length}</span></p>',
'<p><span class="w100 dis s90">Frequencies: </span> <span class="">{[this.parseFrequencies(values.frequencies)]}</span></p>',{parseFrequencies:function(a){return"<p>"+a.replace(/,/gi,"<br>")+"</p>"}})};
InfoWidget.prototype.getProteinXrefTemplate=function(){return new Ext.XTemplate('<p><span class="w75 emph s100">{[values.source.toUpperCase()]}</span> &nbsp; <span class="emph w125 s100"> {[this.generateLink(values)]} <span class="info">&raquo;</span> </span></p>',{generateLink:function(a){if(null!=a.source)switch(a.source.toUpperCase()){case "GO":return'<a TARGET="_blank" href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a.name+'">'+a.name+"</a>";case "REACTOME":return'<a TARGET="_blank" href="http://www.reactome.org/cgi-bin/eventbrowser_st_id?ST_ID='+
a.name+'">'+a.name+"</a>";case "KEGG":return'<a TARGET="_blank" href="http://www.genome.jp/dbget-bin/www_bget?'+a.name+'">'+a.name+"</a>";case "INTACT":return'<a TARGET="_blank" href="http://www.ebi.ac.uk/intact/pages/interactions/interactions.xhtml?query='+a.name+'">'+a.name+"</a>";case "MINT":return'<a TARGET="_blank" href="http://mint.bio.uniroma2.it/mint/search/search.do?queryType=protein&interactorAc='+a.name+'">'+a.name+"</a>";case "DIP":return'<a TARGET="_blank" href="http://dip.doe-mbi.ucla.edu/dip/Browse.cgi?ID='+
a.name+'">'+a.name+"</a>";case "STRING":return'<a TARGET="_blank" href="http://string-db.org/newstring_cgi/show_network_section.pl?identifier=P51587">'+a.name+"</a>";case "MIM":return'<a TARGET="_blank" href="http://www.omim.org/entry/'+a.name+'">'+a.name+"</a>";case "PHARMGKB":return'<a TARGET="_blank" href="http://www.pharmgkb.org/do/serve?objId='+a.name+'&objCls=Gene">'+a.name+"</a>";case "ORPHANET":return'<a TARGET="_blank" href="http://www.orpha.net/consor/cgi-bin/OC_Exp.php?lng=EN&Expert='+
a.name+'">'+a.name+"</a>"}else return""}})};
InfoWidget.prototype.getSnpTranscriptTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{[this.getStableId(values)]}</span> &nbsp; <span class="emph s120"> {stableId} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={[this.getStableId(values)]}">Ensembl</a>',"</p><br>",'<p><span class="w140 dis s90">CDS &nbsp; (start : end): </span> {cdsStart} : {cdsEnd} <span style="margin-left:50px" class="w100 dis s90">cDNA (start : end): </span> {cdnaStart} : {cdnaEnd}</p>','<p><span class="w140 dis s90">Translation (start : end): </span> {translationStart} : {translationEnd}</p>',
'<p><span class="w140 dis s90">Peptide allele: </span> {peptideAlleleString}</p>','<p><span class="w140 dis s90">Alt. peptide allele: </span> {alternativePeptideAlleleString}</p>','<p><span class="w140 dis s90">Codon: </span> {codon}</p>','<p><span class="w140 dis s90">Reference codon: </span> {referenceCodon}</p>','<p><span class="w140 dis s90">Polyphen prediction: </span> {polyphenPrediction}','<span style="margin-left:50px" class="w140 dis s90">Polyphen score: </span> {polyphenScore}</p>','<p><span class="w140 dis s90">Sift prediction: </span> {siftPrediction}',
'<span style="margin-left:50px" class="w140 dis s90">Sift score: </span> {siftScore}</p>',{getStableId:function(a){return""!=a.transcript?a.transcript.stableId:"Intergenic SNP"}})};
InfoWidget.prototype.getConsequenceTypeTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{transcript.stableId}</span> &nbsp; <span class="emph s120"> {consequenceType.description} </span></span><br><br>','<p><span class="w100 dis s90">SO accesion: </span> {consequenceType.soAccession}</p>','<p><span class="w100 dis s90">SO term: </span> {consequenceType.soTerm}</p>','<p><span class="w100 dis s90">Feature So term: </span> {consequenceType.featureSoTerm}</p>',
'<p><span class="w100 dis s90">NCBI term: </span> {consequenceType.ncbiTerm}</p>','<p><span class="w100 dis s90">Rank: </span> {consequenceType.rank}</p><br>')};
InfoWidget.prototype.getPhenotypeTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{phenotypeDescription}</span> &nbsp; <span class="emph s120"> {source} </span></span><br><br>','<p><span class="w150 dis s90">PValue: </span>{PValue}</p>','<p><span class="w150 dis s90">Assoc. gene name: </span>{associatedGeneName}</p>','<p><span class="w150 dis s90">Assoc. variant risk allele: </span>{associatedVariantRiskAllele}</p>','<p><span class="w150 dis s90">Phenotype description: </span>{phenotypeDescription}</p>',
'<p><span class="w150 dis s90">Phenotype name: </span>{phenotypeName}</p>','<p><span class="w150 dis s90">Risk allele freq in controls: </span>{riskAlleleFrequencyInControls}</p>','<p><span class="w150 dis s90">Source: </span>{source}</p>','<p><span class="w150 dis s90">Study name: </span>{studyName}</p>','<p><span class="w150 dis s90">Study type: </span>{studyType}</p>','<p><span class="w150 dis s90">Study URL: </span>{studyUrl}</p>','<p><span class="w150 dis s90">Study description: </span>{studyDescription}</p>')};
InfoWidget.prototype.getPopulationTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{population}</span> &nbsp; <span class="emph s120"> {source} </span></span><br><br>','<p><span class="w140 dis s90">Ref allele:  </span>{refAllele} ({refAlleleFrequency})</p>','<p><span class="w140 dis s90">Other allele:  </span>{otherAllele} ({otherAlleleFrequency})</p>','<p><span class="w140 dis s90">Ref allele homozygote:  </span>{refAlleleHomozygote} ({refAlleleHomozygoteFrequency})</p>',
'<p><span class="w140 dis s90">Allele heterozygote:  </span>{alleleHeterozygote} ({alleleHeterozygoteFrequency})</p>','<p><span class="w140 dis s90">Other allele homozygote:  </span>{otherAlleleHomozygote} ({otherAlleleHeterozygoteFrequency})</p>','<p><span class="w140 dis s90">Source:  </span>{source}</p>','<p><span class="w140 dis s90">Population:  </span>{population}</p>')};InfoWidget.prototype.getVariantEffectTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{consequenceTypeObo}</span> &nbsp; <span class="emph s120"> {featureBiotype} </span></span><br><br>')};
GeneInfoWidget.prototype.draw=InfoWidget.prototype.draw;GeneInfoWidget.prototype.render=InfoWidget.prototype.render;GeneInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;GeneInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;GeneInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;GeneInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate;GeneInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate;
function GeneInfoWidget(a,b,c){null==c&&(c={});c.title="Gene Info";InfoWidget.prototype.constructor.call(this,a,b,c)}GeneInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Regulatory",children:[{text:"TFBS"},{text:"miRNA targets"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]};
GeneInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getGenePanel(this.data).show());break;case "Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case "GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case "Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());
break;case "Reactome":this.panel.add(this.getXrefGrid(this.data.reactome,"Reactome").show());break;case "TFBS":this.panel.add(this.getTfbsGrid(this.data.tfbs).show());break;case "miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case "Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case "3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}};
GeneInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel};
GeneInfoWidget.prototype.getTranscriptPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid};
GeneInfoWidget.prototype.getXrefGrid=function(a,b){if(0>=a.length)return this.notFoundPanel;null==this[b+"Grid"]&&(this[b+"Grid"]=this.doGrid([{header:"Display Id",dataIndex:"displayId",flex:1},{header:"Description",dataIndex:"description",flex:3}],["description","displayId"],b,""),this[b+"Grid"].store.loadData(a));return this[b+"Grid"]};
GeneInfoWidget.prototype.getTfbsGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.tfbsGrid&&(this.tfbsGrid=this.doGrid([{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",
dataIndex:"sequence",flex:1}],"chromosome start end strand tfName relativeStart relativeEnd targetGeneName score sequence".split(" "),"TFBS",""),this.tfbsGrid.store.loadData(a));return this.tfbsGrid};
GeneInfoWidget.prototype.getMirnaTargetGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.mirnaTargetGrid&&(this.mirnaTargetGrid=this.doGrid([{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}],"chromosome start end strand mirbaseId score experimentalMethod source".split(" "),
"miRNA targets",""),this.mirnaTargetGrid.store.loadData(a));return this.mirnaTargetGrid};
GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.proteinFeaturesGrid&&(this.proteinFeaturesGrid=this.doGrid([{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}],"identifier start end original type description".split(" "),
"Protein features",""),this.proteinFeaturesGrid.store.loadData(a));return this.proteinFeaturesGrid};
GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.proteinFeaturesGrid&&(this.proteinFeaturesGrid=this.doGrid([{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}],"identifier start end original type description".split(" "),
"Protein features",""),this.proteinFeaturesGrid.store.loadData(a));return this.proteinFeaturesGrid};
GeneInfoWidget.prototype.get3Dprotein=function(){var a=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var b=[];$.ajax({url:(new CellBaseManager).host+"/latest/"+a.species+"/feature/id/"+this.query+"/xref?dbname=pdb&header=false",async:!1,success:function(c){if(""!=c){b=c.trim().split("\n");for(c=0;c<b.length;c++){var d=b[c].trim(),d=Ext.create("Ext.panel.Panel",{title:d,bodyCls:"background-black",
html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+d+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){a=a.title;ChemDoodle.default_backgroundColor="#000000";var b=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+a,300,300);b.gl?(b.specs.set3DRepresentation("Ball and Stick"),b.specs.proteins_ribbonCartoonize=!0,b.handle=null,b.timeout=15,b.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,
b.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,b.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,b.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,b.nextFrame=function(a){var b=[];mat4.identity(b);var a=a/1E3,c=Math.PI/15;mat4.rotate(b,c*a,[1,0,0]);mat4.rotate(b,c*a,[0,1,0]);mat4.rotate(b,c*a,[0,0,1]);mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+a+".pdb",function(a){a=ChemDoodle.readPDB(a);b.loadMolecule(a);b.startAnimation()})):(b.emptyMessage=
"Your browser does not support WebGL",b.displayMessage())}}});a.p3dProtein.add(d)}}else a.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein};GeneInfoWidget.prototype.getEnsembleId=function(){};GeneInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(JSON.parse(d.result))});b.get("feature","gene",this.query,"fullinfo")};
GeneInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0];console.log(this.data);this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};ProteinInfoWidget.prototype.draw=InfoWidget.prototype.draw;ProteinInfoWidget.prototype.render=InfoWidget.prototype.render;ProteinInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;ProteinInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;ProteinInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
function ProteinInfoWidget(a,b,c){null==c&&(c={});c.title="Protein Info";InfoWidget.prototype.constructor.call(this,a,b,c)}ProteinInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Sumary",children:[{text:"Long"},{text:"Seq"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Interactions"},{text:"Variations"}]};
ProteinInfoWidget.prototype.optionClick=function(a){a.leaf&&null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1))};SnpInfoWidget.prototype.draw=InfoWidget.prototype.draw;SnpInfoWidget.prototype.render=InfoWidget.prototype.render;SnpInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;SnpInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;SnpInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
SnpInfoWidget.prototype.getSnpTemplate=InfoWidget.prototype.getSnpTemplate;SnpInfoWidget.prototype.getSnpTranscriptTemplate=InfoWidget.prototype.getSnpTranscriptTemplate;SnpInfoWidget.prototype.getConsequenceTypeTemplate=InfoWidget.prototype.getConsequenceTypeTemplate;SnpInfoWidget.prototype.getPhenotypeTemplate=InfoWidget.prototype.getPhenotypeTemplate;SnpInfoWidget.prototype.getPopulationTemplate=InfoWidget.prototype.getPopulationTemplate;
function SnpInfoWidget(a,b,c){null==c&&(c={});c.title="SNP Info";InfoWidget.prototype.constructor.call(this,a,b,c)}SnpInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Consequence type"},{text:"Annotated phenotype"},{text:"Population frequency"}]};
SnpInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Transcripts":this.panel.add(this.getSnpTranscriptPanel(this.data.snptotranscript).show());break;case "Consequence type":this.panel.add(this.getConsequenceTypePanel(this.data.snptotranscript).show());break;case "Annotated phenotype":this.panel.add(this.getPhenotypePanel(this.data.phenotype).show());
break;case "Population frequency":this.panel.add(this.getPopulationPanel(this.data.population).show())}};SnpInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getSnpTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
SnpInfoWidget.prototype.getSnpTranscriptPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.snpTranscriptGrid){for(var b=this.getSnpTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.snpTranscriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.snpTranscriptGrid};
SnpInfoWidget.prototype.getConsequenceTypePanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.consequencePanel){for(var b=this.getConsequenceTypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.consequencePanel=Ext.create("Ext.panel.Panel",{title:"Consequence type ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.consequencePanel};
SnpInfoWidget.prototype.getPhenotypePanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.phenotypePanel){for(var b=this.getPhenotypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.phenotypePanel=Ext.create("Ext.panel.Panel",{title:"Phenotype ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.phenotypePanel};
SnpInfoWidget.prototype.getPopulationPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.populationPanel){for(var b=this.getPopulationTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.populationPanel=Ext.create("Ext.panel.Panel",{title:"Population ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.populationPanel};
SnpInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(JSON.parse(d.result))});b.get("feature","snp",this.query,"fullinfo")};
SnpInfoWidget.prototype.dataReceived=function(a){for(var a=a[0],b=0;b<a.length;b++)a[b].chromosome==this.feature.chromosome&&(a[b].start==this.feature.start&&a[b].end==this.feature.end)&&(this.data=a[b],console.log(a[b]));this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};TranscriptInfoWidget.prototype.draw=InfoWidget.prototype.draw;TranscriptInfoWidget.prototype.render=InfoWidget.prototype.render;TranscriptInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;
TranscriptInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;TranscriptInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;TranscriptInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate;TranscriptInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate;TranscriptInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate;TranscriptInfoWidget.prototype.get3Dprotein=GeneInfoWidget.prototype.get3Dprotein;
TranscriptInfoWidget.prototype.getGenePanel=GeneInfoWidget.prototype.getGenePanel;TranscriptInfoWidget.prototype.getXrefGrid=GeneInfoWidget.prototype.getXrefGrid;TranscriptInfoWidget.prototype.getTfbsGrid=GeneInfoWidget.prototype.getTfbsGrid;TranscriptInfoWidget.prototype.getMirnaTargetGrid=GeneInfoWidget.prototype.getMirnaTargetGrid;TranscriptInfoWidget.prototype.getProteinFeaturesGrid=GeneInfoWidget.prototype.getProteinFeaturesGrid;
function TranscriptInfoWidget(a,b,c){null==c&&(c={});c.title="Transcript";InfoWidget.prototype.constructor.call(this,a,b,c)}
TranscriptInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Variation",children:[{text:"SNPs"},{text:"Mutations"}]},{text:"Regulatory",children:[{text:"TFBS"},{text:"miRNA targets"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]};
TranscriptInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case "Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case "GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case "Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,
"Interpro").show());break;case "Reactome":this.panel.add(this.getXrefGrid(this.data.reactome,"Reactome").show());break;case "SNPs":this.panel.add(this.getSnpsGrid(this.data.snps).show());break;case "Mutations":this.panel.add(this.getMutationsGrid(this.data.mutations).show());break;case "TFBS":this.panel.add(this.getTfbsGrid(this.data.tfbs).show());break;case "miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case "Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());
break;case "3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}};TranscriptInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel};
TranscriptInfoWidget.prototype.getExonsGrid=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid};
TranscriptInfoWidget.prototype.getSnpsGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.snpsGrid&&(this.snpsGrid=this.doGrid([{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:0.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}],"chromosome start end name strand alleleString displaySoConsequence".split(" "),
"SNPs",""),this.snpsGrid.store.loadData(a));return this.snpsGrid};
TranscriptInfoWidget.prototype.getMutationsGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.mutationsGrid&&(this.mutationsGrid=this.doGrid([{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}],"chromosome start end mutationAa mutationCds primaryHistology source".split(" "),
"Mutations",""),this.mutationsGrid.store.loadData(a));return this.mutationsGrid};TranscriptInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(JSON.parse(d.result))});b.get("feature","transcript",this.query,"fullinfo")};
TranscriptInfoWidget.prototype.dataReceived=function(a){this.data=a[0];console.log(this.data);this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};VCFVariantInfoWidget.prototype.draw=InfoWidget.prototype.draw;VCFVariantInfoWidget.prototype.render=InfoWidget.prototype.render;VCFVariantInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;VCFVariantInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;
VCFVariantInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;VCFVariantInfoWidget.prototype.getVCFVariantTemplate=InfoWidget.prototype.getVCFVariantTemplate;VCFVariantInfoWidget.prototype.getVariantEffectTemplate=InfoWidget.prototype.getVariantEffectTemplate;function VCFVariantInfoWidget(a,b,c){null==c&&(c={});c.title="VCF variant Info";InfoWidget.prototype.constructor.call(this,a,b,c)}
VCFVariantInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Variant effect"},{text:"Header"},{text:"Samples"}]}]};
VCFVariantInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data.feature).show());break;case "Variant effect":this.panel.add(this.getEffectPanel(this.data.consequenceType).show());break;case "Header":this.panel.add(this.getHeaderPanel(this.data.header).show());break;case "Samples":this.panel.add(this.getSamplesGrid(this.data.feature.sampleData,
this.data.samples,this.data.feature.format).show())}};VCFVariantInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getVCFVariantTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
VCFVariantInfoWidget.prototype.getEffectPanel=function(a){if(0>=a.length)return this.notFoundPanel;for(var b=0;b<a.length;b++)if(a[b].consequence=a[b].consequenceType+" - "+a[b].consequenceTypeObo,""==a[b].featureName&&(a[b].featureName="-"),""==a[b].geneId&&(a[b].geneId="-"),""==a[b].transcriptId&&(a[b].transcriptId="-"),""==a[b].featureBiotype&&(a[b].featureBiotype="-"),""==a[b].aaPosition&&(a[b].aaPosition="-"),""==a[b].aminoacidChange)a[b].aminoacidChange="-";null==this.effectGrid&&(this.effectGrid=
this.doGrid([{header:"Feature",dataIndex:"featureName",flex:1},{header:"Gene Id",dataIndex:"geneId",flex:1.5},{header:"Transcript Id",dataIndex:"transcriptId",flex:1.5},{header:"Feat.Biotype",dataIndex:"featureBiotype",flex:1},{header:"aa Position",dataIndex:"aaPosition",flex:1},{header:"aa Change",dataIndex:"aminoacidChange",flex:1}],"featureName geneId transcriptId featureBiotype aaPosition aminoacidChange consequence".split(" "),"effectGridModel","consequence"),this.effectGrid.store.loadData(a));
return this.effectGrid};VCFVariantInfoWidget.prototype.getHeaderPanel=function(a){if(""==a)return this.notFoundPanel;null==this.headerPanel&&(this.headerPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,html:a}));return this.headerPanel};
VCFVariantInfoWidget.prototype.getSamplesGrid=function(a,b,c){a=a.split("\t").slice(9);if(0>=a.length)return this.notFoundPanel;for(var d=Array(b.length),e=0,f=d.length;e<f;e++)d[e]={id:b[e],info:a[e]};null==this.samplesGrid&&(this.samplesGrid=this.doGrid([{header:"Identifier",dataIndex:"id",flex:1},{header:c,dataIndex:"info",flex:5}],["id","info"],"VCF samples",""),this.samplesGrid.store.loadData(d));return this.samplesGrid};
VCFVariantInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(d.result)});b.get("genomic","variant",this.feature.chromosome+":"+this.feature.start+":"+this.feature.ref+":"+this.feature.alt,"consequence_type")};
VCFVariantInfoWidget.prototype.dataReceived=function(a){this.data={};this.data.header=this.adapter.header;this.data.samples=this.adapter.samples;this.data.feature=this.feature;this.data.consequenceType=a;this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};
function CellBaseManager(a,b){this.host=CELLBASE_HOST;this.version="latest";this.species=a;this.subcategory=this.category=null;this.contentformat="json";this.fileformat="";this.outputcompress=!1;this.dataType="script";this.resource=this.originalQuery=this.query="";this.params={};this.async=!0;this.maxQuery=30;this.numberQueries=0;this.results=[];this.resultsCount=[];this.batching=!1;null!=b&&null!=b.host&&(this.host=b.host);this.completed=new Event;this.success=new Event;this.batchSuccessed=new Event;
this.error=new Event;this.setVersion=function(a){this.version=a};this.setSpecies=function(a){this.species=a};this.getVersion=function(){return this.version};this.getSpecies=function(){return this.species};this.setAsync=function(a){this.async=a};this.getUrl=function(){return this.query!=null?this.host+"/"+this.version+"/"+this.species+"/"+this.category+"/"+this.subcategory+"/"+this.query+"/"+this.resource:this.host+"/"+this.version+"/"+this.species+"/"+this.category+"/"+this.subcategory+"/"+this.resource};
this.get=function(a,b,e,f,g,j){if(g!=null)this.params=g;if(e instanceof Array){this.originalQuery=e;this.batching=true;this.results=[];this.getMultiple(a,b,e,f)}else{e=new String(e);e=e.replace(/\s/g,"");this.originalQuery=g=e.split(",");if(this.maxQuery<g.length){this.batching=true;this.getMultiple(a,b,g,f,j)}else{this.batching=false;this.getSingle(a,b,e,f,j)}}};this._joinToResults=function(a){this.resultsCount.push(true);this.results[a.id]=a.data;if(this.numberQueries==this.resultsCount.length){for(var a=
[],b=0;b<this.results.length;b++)for(var e=0;e<this.results[b].length;e++)a.push(this.results[b][e]);this.success.notify({result:a,category:this.category,subcategory:this.subcategory,query:this.originalQuery,resource:this.resource,params:this.params,error:""})}};this.getSingle=function(a,b,e,f,g,j){this.category=a;this.subcategory=b;this.query=e;this.resource=f;a=this.getUrl();this._callServer(a,g,j)};this.getMultiple=function(a,b,e,f){var g=[];if(e.length>this.maxQuery)for(var j=0;j<e.length;j=j+
this.maxQuery)g.push(e.slice(j,j+this.maxQuery));else g.push(e);this.numberQueries=g.length;var h=this;this.batchSuccessed.addEventListener(function(a,b){h._joinToResults(b)});for(j=0;j<g.length;j++){this.results.push([]);this.getSingle(a,b,g[j].toString(),f,j)}};this._callServer=function(a,b){var e=this;this.params.of=this.contentformat;a=a+this.getQuery(this.params,a);$.ajax({type:"GET",url:a,async:this.async,success:function(a){if(a==""){console.log("data is empty");a="[]"}a=JSON.parse(a);e.batching?
e.batchSuccessed.notify({data:a,id:b}):e.success.notify({result:a,category:e.category,subcategory:e.subcategory,query:e.originalQuery,resource:e.resource,params:e.params,error:""})},complete:function(){e.completed.notify()},error:function(a,b,c){console.log("CellBaseManager: Ajax call returned : "+c+"\t"+b+"\t"+a.statusText+" END");e.error.notify()}});console.log(a)}}
CellBaseManager.prototype.getQuery=function(a,b){var c="?";-1!=b.indexOf("?")&&(c="&");var d="",e;for(e in a)null!=a[e]&&(d+=e+"="+a[e]+"&");""!=d&&(d=c+d.substring(0,d.length-1));return d};
Ext.define("Ext.ux.Window",{extend:"Ext.window.Window",minimizable:!0,constrain:!0,collapsible:!0,initComponent:function(){this.callParent();null!=this.taskbar&&(this.zIndexManager=this.taskbar.winMgr,this.iconCls="icon-grid",this.button=Ext.create("Ext.button.Button",{text:this.title,window:this,iconCls:this.iconCls,handler:function(){this.window.zIndexManager.front==this.window?this.window.minimize():this.window.show()}}),this.taskbar.add(this.button),this.contextMenu=new Ext.menu.Menu({items:[{text:"Close",
window:this,iconCls:"tools-icons x-tool-close",handler:function(){this.window.close()}}]}),this.button.getEl().on("contextmenu",function(a){a.preventDefault();this.contextMenu.showAt(a.getX(),a.getY()-10-25*this.contextMenu.items.length)},this),this.button.on("destroy",function(){this.window.close()}),this.on("destroy",function(){!0!=this.button.destroying&&this.button.destroy()}),this.on("minimize",function(){this.hide()}),this.on("deactivate",function(){this.zIndexManager&&this.zIndexManager.front.ghostPanel&&
this.zIndexManager.unregister(this.zIndexManager.front.ghostPanel);this.button.toggle(!1)}),this.on("activate",function(){this.button.toggle(!0)}))}});
function GenomicAttributesWidget(a,b){var c=this;this.id="GenomicAttributesWidget"+Math.round(1E4*Math.random());this.species=a;this.args=b;this.title="None";this.featureType="gene";this.columnsCount=null;if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.columnsCount&&(this.columnsCount=b.columnsCount),null!=b.featureType&&(this.featureType=b.featureType),null!=b.viewer))this.viewer=b.viewer,b.listWidgetArgs.viewer=b.viewer;this.listWidget=new ListWidget(this.species,b.listWidgetArgs);this.attributesPanel=
new AttributesPanel({height:240,columnsCount:this.columnsCount,wum:b.wum,tags:b.tags});this.onMarkerClicked=new Event(this);this.onTrackAddAction=new Event(this);this.attributesPanel.onDataChange.addEventListener(function(a,b){c.dataChange(b)})}
GenomicAttributesWidget.prototype.draw=function(){var a=this;null==this.panel&&(this.karyotypePanel=Ext.create("Ext.panel.Panel",{id:this.id+"karyotypePanel",height:350,maxHeight:350,border:0,padding:"0 0 0 0",html:'<div id="'+this.id+'karyotypeDiv" ><div>'}),this.karyotypePanel.on("afterrender",function(){var b=$("#"+a.id+"karyotypeDiv")[0];console.log(b);a.karyotypeWidget=new KaryotypeWidget(b,{width:1E3,height:340,species:a.viewer.species,chromosome:a.viewer.chromosome,position:a.viewer.position});
a.karyotypeWidget.onClick.addEventListener(function(b,d){a.viewer.onLocationChange.notify({position:d.position,chromosome:d.chromosome,sender:"KaryotypePanel"})});a.karyotypeWidget.drawKaryotype()}),this.filtersButton=Ext.create("Ext.button.Button",{text:"Additional Filters",disabled:!0,listeners:{scope:this,click:function(){this.onAdditionalInformationClick()}}}),this.addTrackButton=Ext.create("Ext.button.Button",{text:"Add Track",disabled:!0,handler:function(){a.onTrackAddAction.notify({adapter:a.adapter,
fileName:a.attributesPanel.fileName})}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,minimizable:!0,constrain:!0,closable:!0,bodyStyle:"background:#fff;",taskbar:Ext.getCmp(this.args.viewer.id+"uxTaskbar"),items:[this.attributesPanel.getPanel(),this.karyotypePanel],width:1035,height:653,buttonAlign:"left",buttons:[this.addTrackButton,"->",{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),
this.attributesPanel.barField.add(this.filtersButton),this.panel.setLoading());this.panel.show()};GenomicAttributesWidget.prototype.dataChange=function(a){try{this.karyotypePanel.setLoading("Connecting to Database");this.karyotypeWidget.unmark();for(var b=[],c=0;c<a.length;c++)b.push(a[c].data[0]);0<a.length?this.fill(b):this.karyotypePanel.setLoading(!1)}catch(d){alert(d)}finally{this.karyotypePanel.setLoading(!1)}};
GenomicAttributesWidget.prototype.onAdditionalInformationClick=function(){var a=this;this.listWidget.draw(this.cbResponse,!1);this.listWidget.onFilterResult.addEventListener(function(b,c){a.karyotypeWidget.unmark();for(var d=0;d<c.length;d++)a.karyotypeWidget.addMark(c[d].data);a.attributesPanel.store.clearFilter();a.attributesPanel.store.filter(function(a){return a.data.cellBase})})};ExpressionGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;
ExpressionGenomicAttributesWidget.prototype.getMainPanel=GenomicAttributesWidget.prototype.getMainPanel;ExpressionGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;ExpressionGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;ExpressionGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;ExpressionGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;
ExpressionGenomicAttributesWidget.prototype.onAdditionalInformationClick=GenomicAttributesWidget.prototype.onAdditionalInformationClick;function ExpressionGenomicAttributesWidget(a,b){null==b&&(b={});b.columnsCount=2;b.title="Expression";b.tags=["expression"];b.featureType="gene";b.listWidgetArgs={title:"Filter",action:"filter"};GenomicAttributesWidget.prototype.constructor.call(this,a,b)}
ExpressionGenomicAttributesWidget.prototype.fill=function(a){for(var b=this,c=Normalizer.normalizeArray(values),d=[],e=0;e<c.length;e++)isNaN(parseFloat(values[e]))?d.push("#000000"):d.push(Colors.getColorByScoreValue(c[e]).HexString());if(null==this.cbResponse){var c=new CellBaseManager(this.species),f=new FeatureDataAdapter(null,{species:this.species});c.success.addEventListener(function(a,c){b.karyotypePanel.setLoading("Retrieving data");for(var e=0;e<c.result.length;e++){b.attributesPanel.store.data.items[e].data.cellBase=
0<c.result[e].length?!0:!1;for(var k=0;k<c.result[e].length;k++){var l=c.result[e][k];l.featureType="gene";b.karyotypeWidget.addMark(l,d[e]);f.addFeatures(l)}}b.adapter=f;b.filtersButton.enable();b.addTrackButton.enable();b.karyotypePanel.setLoading(!1);b.cbResponse=c;b.karyotypePanel.setLoading(!1)});this.karyotypePanel.setLoading("Connecting to Database");c.get("feature","gene",a.toString(),"info")}};
ExpressionGenomicAttributesWidget.prototype.dataChange=function(a){try{var b=[];values=[];for(var c=0;c<a.length;c++)b.push(a[c].data[0]),values.push(a[c].data[1]);0<a.length&&this.fill(b,values)}catch(d){alert(d),this.panel.setLoading(!1)}};GenotypeGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;GenotypeGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;GenotypeGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;
GenotypeGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;GenotypeGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;GenotypeGenomicAttributesWidget.prototype.dataChange=GenomicAttributesWidget.prototype.dataChange;GenotypeGenomicAttributesWidget.prototype.fill=GenomicAttributesWidget.prototype.fill;GenotypeGenomicAttributesWidget.prototype.onAdditionalInformationClick=GenomicAttributesWidget.prototype.onAdditionalInformationClick;
function GenotypeGenomicAttributesWidget(a,b){null==b&&(b={});b.title="Genotype";b.tags=["genotype"];b.featureType="snp";b.listWidgetArgs={title:"Filter",action:"filter",gridFields:"name variantAlleles ancestralAllele mapWeight position sequence".split(" ")};GenomicAttributesWidget.prototype.constructor.call(this,a,b)}
function AttributesWidget(a){this.id="AttributesWidget_"+Math.random();this.title="";this.width=1025;this.height=628;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height;this.attributesPanel=new AttributesPanel({borderCls:a.borderCls,height:325})}AttributesWidget.prototype.draw=function(){this.render()};AttributesWidget.prototype.getDetailPanel=function(){return{}};
AttributesWidget.prototype.getButtons=function(){var a=this;return[{text:"Close",handler:function(){a.panel.close()}}]};
AttributesWidget.prototype.render=function(){null==this.panel&&(this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,collapsible:!0,layout:{type:"vbox",align:"stretch"},items:[this.attributesPanel.getPanel(),this.getDetailPanel()],width:this.width,height:this.height,buttonAlign:"right",buttons:this.getButtons(),listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.panel.setLoading());this.panel.show()};
function AttributesPanel(a){var b=this;this.targetId=null;this.id="AttributesPanel_"+Math.round(1E7*Math.random());this.title=null;this.width=1023;this.height=628;this.wum=!0;this.tags=[];this.borderCls="panel-border-bottom";this.columnsCount=null;if(null!=a&&(null!=a.wum&&(this.wum=a.wum),null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.columnsCount&&(this.columnsCount=a.columnsCount),
null!=a.borderCls&&(this.borderCls=a.borderCls),null!=a.tags))this.tags=a.tags;this.browserData=new BrowserDataWidget;this.onDataChange=new Event(this);this.onFileRead=new Event(this);this.browserData.adapter.onReadData.addEventListener(function(a,d){var e=new TabularDataAdapter(new StringDataSource(d.data),{async:!1}),f=e.getLines();b.makeGrid(e);b.uptadeTotalFilteredRowsInfo(f.length);b.uptadeTotalRowsInfo(f.length);b.fileName=d.filename;b.fileNameLabel.setText('<span class="emph">'+d.filename+
'</span> <span class="info">(server)</span>',!1)})}AttributesPanel.prototype.draw=function(){var a=this.getPanel();null!=this.targetId&&a.render(this.targetId)};AttributesPanel.prototype.uptadeTotalRowsInfo=function(a){this.infoLabel.setText('<span class="dis">Total rows: </span><span class="emph">'+a+"</span>",!1)};AttributesPanel.prototype.uptadeTotalFilteredRowsInfo=function(a){this.infoLabel2.setText('<span class="dis">Filtered rows: </span><span class="emph">'+a+"</span>",!1)};
AttributesPanel.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};AttributesPanel.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
AttributesPanel.prototype.getPanel=function(){var a=this;null==this.panel&&(this.expresionAnalysisUploadFieldFile=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{scope:this,change:function(){a.panel.setLoading("Reading file");try{var b=new TabularFileDataAdapter({comment:"#"}),c=document.getElementById(this.expresionAnalysisUploadFieldFile.fileInputEl.id).files[0];a.fileName=c.name;a.fileNameLabel.setText('<span class="emph">'+
c.name+'</span> <span class="info">(local)</span>',!1);b.loadFromFile(c);b.onRead.addEventListener(function(){a.makeGrid(b);a.uptadeTotalFilteredRowsInfo(b.lines.length);a.uptadeTotalRowsInfo(b.lines.length);a.panel.setLoading(!1);a.onFileRead.notify()})}catch(d){alert(d),a.panel.setLoading(!1)}}}}),this.barField=Ext.create("Ext.toolbar.Toolbar"),this.barInfo=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom"}),this.barHelp=Ext.create("Ext.toolbar.Toolbar",{dock:"top"}),this.clearFilter=Ext.create("Ext.button.Button",
{text:"Clear filters",disabled:!0,listeners:{scope:this,click:function(){null!=this.grid.filters&&(this.grid.filters.clearFilters(),this.store.clearFilter())}}}),this.helpLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">Click on the header down arrow to filter by column</span>'}),this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'}),this.infoLabel=
Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"}),this.infoLabel2=Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"}),this.barField.add(this.expresionAnalysisUploadFieldFile),this.barInfo.add("->",this.infoLabel,this.infoLabel2),this.barHelp.add(this.fileNameLabel,"->",this.helpLabel),this.store=Ext.create("Ext.data.Store",{fields:["1","2"],data:[]}),this.grid=Ext.create("Ext.grid.Panel",{store:this.store,disabled:!0,border:0,columns:[{header:"Column 1",dataIndex:"1"},{header:"Column 2",dataIndex:"2"}]}),
this.panel=Ext.create("Ext.panel.Panel",{title:this.title,border:!1,layout:"fit",cls:this.borderCls,items:[this.grid],tbar:this.barField,width:this.width,height:this.height,maxHeight:this.height,buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.panel.addDocked(this.barInfo),this.panel.addDocked(this.barHelp));this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,listeners:{scope:this,
click:function(){this.browserData.draw($.cookie("bioinfo_sid"),this.tags)}}}),this.barField.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished());this.barField.add("-",this.clearFilter);return this.panel};AttributesPanel.prototype.getData=function(){return this.data};
AttributesPanel.prototype.makeGrid=function(a){this.data=a.getLines();var b=[],c=[],d=[];null==this.columnsCount&&(this.columnsCount=this.data[0].length);for(var e=0;e<this.columnsCount;e++){var f=a.getHeuristicTypeByColumnIndex(e);b.push({name:e.toString(),type:f});c.push({header:"Column "+e.toString(),dataIndex:e.toString(),flex:1,filterable:!0,filter:{type:f}});d.push({type:f,dataIndex:e.toString()})}this.store=Ext.create("Ext.data.Store",{fields:b,data:this.data,listeners:{scope:this,datachanged:function(a){a.getRange();
this.uptadeTotalFilteredRowsInfo(a.getRange().length);this.onDataChange.notify(a.getRange())}}});a={ftype:"filters",local:!0,filters:d};null!=this.grid&&this.panel.remove(this.grid);this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:c,border:0,features:[a]});this.panel.insert(0,this.grid);this.clearFilter.enable()};
function ListPanel(a,b){this.targetId=null;this.id="ListPanel"+Math.round(1E5*Math.random());this.species=a;this.args=b;this.title="List of Genes";this.width=1E3;this.height=500;this.borderCls="panel-border-bottom";this.gridFields="externalName stableId biotype position strand description chromosome start end".split(" ");if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.targetId&&(this.targetId=b.targetId),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.gridFields&&
(this.gridFields=b.gridFields),null!=b.borderCls&&(this.borderCls=b.borderCls),null!=b.viewer&&(this.viewer=b.viewer),null!=b.featureType))this.featureType=b.featureType;this.onSelected=new Event(this);this.onFilterResult=new Event(this)}
ListPanel.prototype._getGeneGrid=function(){for(var a=this,b=this.gridFields,c=[],d=[],e=0;e<b.length;e++)c.push({type:"string",dataIndex:b[e]}),d.push({header:this.gridFields[e],dataIndex:this.gridFields[e],flex:1});this.store=Ext.create("Ext.data.Store",{fields:b,groupField:"biotype",autoload:!1});c={ftype:"filters",local:!0,filters:c};this.infoToolBar=Ext.create("Ext.toolbar.Toolbar");this.infoLabelOk=Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"});this.infoLabelNotFound=Ext.create("Ext.toolbar.TextItem",
{text:"&nbsp;"});this.clearFilter=Ext.create("Ext.button.Button",{text:"Clear filters",listeners:{scope:this,click:function(){null!=this.grid.filters&&this.grid.filters.clearFilters()}}});this.found=Ext.create("Ext.button.Button",{text:"Features found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features found",headerInfo:"This features were found in the database",viewer:this.viewer})).draw(this.queriesFound.join("\n"))}}});this.notFound=Ext.create("Ext.button.Button",
{text:"Features not found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features not found",headerInfo:"This features were not found in the database",viewer:this.viewer})).draw(this.queriesNotFound.join("\n"))}}});this.exportButton=Ext.create("Ext.button.Button",{text:"Export to Text",handler:function(){(new InputListWidget({width:1100,title:"VCS content",headerInfo:"Export results",viewer:a.args.viewer})).draw(a._getStoreContent())}});this.localizeButton=Ext.create("Ext.button.Button",
{text:"Localize on karyotype",handler:function(){a._localize()}});this.infoToolBar.add(["->",this.exportButton,this.localizeButton,"-",this.found,this.notFound,this.clearFilter]);return this.grid=Ext.create("Ext.grid.Panel",{border:0,store:this.store,features:[c],bbar:this.infoToolBar,columns:d,selModel:{mode:"SINGLE"}})};
ListPanel.prototype._localize=function(){var a=this,b=Ext.create("Ext.window.Window",{id:this.id+"karyotypePanel",title:"Karyotype",width:1020,height:410,bodyStyle:"background:#fff;",html:'<div id="'+this.id+'karyotypeDiv" ><div>',buttons:[{text:"Close",handler:function(){b.close()}}],listeners:{afterrender:function(){var b=$("#"+a.id+"karyotypeDiv")[0],b=new KaryotypeWidget(b,{width:1E3,height:340,species:a.viewer.species,chromosome:a.viewer.chromosome,position:a.viewer.position});b.onClick.addEventListener(function(b,
c){a.viewer.onLocationChange.notify({position:c.position,chromosome:c.chromosome,sender:"KaryotypePanel"})});b.drawKaryotype();for(var d=0;d<a.features.length;d++)b.addMark(a.features[d])}}}).show()};ListPanel.prototype.setTextInfoBar=function(a,b,c){this.found.setText('<span class="dis">'+a+" results found </span> ");this.found.show();0<c&&(this.notFound.setText('<span class="err">'+c+" features not found</span>"),this.notFound.show())};
ListPanel.prototype._getStoreContent=function(){for(var a=new String,b=0;b<this.store.data.items.length;b++){var c=new String;if(0==b){for(var d=0;d<this.gridFields.length;d++)c=c+this.gridFields[d]+"\t";c+="\n"}for(d=0;d<this.gridFields.length;d++)c=c+this.store.data.items[b].data[this.gridFields[d]]+"\t";c+="\n";a+=c}return a};
ListPanel.prototype._render=function(){null==this.panel&&(this.panel=Ext.create("Ext.panel.Panel",{height:240,layout:"fit",cls:this.borderCls,title:this.title,border:!1}));this.panel.add(this._getGeneGrid())};
ListPanel.prototype.draw=function(a,b){this._render();this.queriesNotFound=[];this.queriesFound=[];this.features=[];if(!1!=b){this.adapter=new FeatureDataAdapter(null,{species:this.species});for(var c=0;c<a.result.length;c++){a.result[c].constructor!=Array&&(a.result[c]=[a.result[c]]);for(var d=0;d<a.result[c].length;d++){var e=a.result[c][d];e.position=e.chromosome+":"+e.start+"-"+e.end;e.featureType=a.resource;this.features.push(e)}0==a.result[c].length?this.queriesNotFound.push(a.query[c]):(this.queriesFound.push(a.query[c]),
this.adapter.addFeatures(a.result[c]))}}else for(c=0;c<a.result.length;c++){a.result[c].constructor!=Array&&(a.result[c]=[a.result[c]]);for(d=0;d<a.result[c].length;d++)e=a.result[c][d],e.position=e.chromosome+":"+e.start+"-"+e.end,e.featureType=a.resource,this.features.push(e);0==a.result[c].length?this.queriesNotFound.push(a.query[c]):this.queriesFound.push(a.query[c])}this.store.loadData(this.features);this.setTextInfoBar(this.queriesFound.length,this.queriesFound.length,this.queriesNotFound.length)};
function ListWidget(a,b){this.targetId=null;this.id="ListWidget"+Math.round(1E7*Math.random());this.species=a;this.width=1E3;this.height=500;this.action="localize";this.title="";this.args=b;if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.targetId&&(this.targetId=b.targetId),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.action&&(this.action=b.action),null!=b.viewer))this.viewer=b.viewer;this.listPanel=new ListPanel(this.species,{title:!1,gridFields:b.gridFields,
viewer:this.args.viewer});this.onSelected=this.listPanel.onSelected;this.onFilterResult=this.listPanel.onFilterResult}
ListWidget.prototype._render=function(){var a=this;null==this.panel&&(this.localizeButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",disabled:!0,handler:function(){a.listPanel.onSelected.notify(a.listPanel.grid.getSelectionModel().getSelection()[0].data);a.panel.hide()}}),this.filterButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",handler:function(){a.listPanel.onFilterResult.notify(a.listPanel.store.getRange());a.panel.hide()}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,
taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),resizable:!1,constrain:!0,closable:!0,layout:"fit",minimizable:!0,width:this.width,height:this.height,items:[this.listPanel.grid],buttonAlign:"right",buttons:[this.getActionButton(this.action),{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}))};
ListWidget.prototype.draw=function(a,b){var c=this;this.listPanel.draw(a,b);this.listPanel.grid.getSelectionModel().on("selectionchange",function(){c.listPanel.grid.getSelectionModel().hasSelection()?c.localizeButton.enable():c.localizeButton.disable()});this._render();this.panel.show()};ListWidget.prototype.getActionButton=function(a){switch(a){case "localize":return this.localizeButton;case "filter":return this.listPanel.localizeButton.disable().hide(),this.filterButton}};
GenomicListPanel.prototype._getGeneGrid=ListPanel.prototype._getGeneGrid;GenomicListPanel.prototype._localize=ListPanel.prototype._localize;GenomicListPanel.prototype.setTextInfoBar=ListPanel.prototype.setTextInfoBar;GenomicListPanel.prototype._getStoreContent=ListPanel.prototype._getStoreContent;GenomicListPanel.prototype._render=ListPanel.prototype._render;GenomicListPanel.prototype.draw=ListPanel.prototype.draw;function GenomicListPanel(a){ListPanel.prototype.constructor.call(this,a)}
GenomicListWidget.prototype.draw=ListWidget.prototype.draw;GenomicListWidget.prototype.getActionButton=ListWidget.prototype.getActionButton;function GenomicListWidget(a,b){ListWidget.prototype.constructor.call(this,a,b);this.onSelected=this.listPanel.onSelected;this.onFilterResult=this.listPanel.onFilterResult;this.onTrackAddAction=new Event}
GenomicListWidget.prototype._render=function(){var a=this;null==this.panel&&(this.localizeButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",disabled:!0,handler:function(){a.listPanel.onSelected.notify(a.listPanel.grid.getSelectionModel().getSelection()[0].data);a.panel.hide()}}),this.filterButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",handler:function(){a.listPanel.onFilterResult.notify(a.listPanel.store.getRange());a.panel.hide()}}),this.panel=Ext.create("Ext.ux.Window",
{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),resizable:!1,constrain:!0,closable:!0,layout:"fit",minimizable:!0,width:this.width,height:this.height,items:[this.listPanel.grid],buttonAlign:"left",buttons:[{text:"Add Track",handler:function(){var b="Search "+Math.round(1E3*Math.random());a.onTrackAddAction.notify({adapter:a.listPanel.adapter,fileName:b})}},"->",this.getActionButton(this.action),{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},
destroy:function(){delete this.panel}}}))};function InputListWidget(a){this.id="InputListWidget"+Math.round(1E7*Math.random());this.title="List";this.width=500;this.height=350;this.headerInfo="Write a list separated only by lines";this.args=a;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.headerInfo&&(this.headerInfo=a.headerInfo),null!=a.viewer))this.viewer=a.viewer;this.onOk=new Event(this)}
InputListWidget.prototype.draw=function(a){var b=this;null==a&&(a=new String);null==this.panel&&(this.infobar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"}),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{text:this.headerInfo}),this.infobar.add(this.infoLabel),this.editor=Ext.create("Ext.form.field.TextArea",{id:this.id+"genelist_preview",xtype:"textarea",name:"file",margin:"-1",width:this.width,height:this.height,enableKeyEvents:!0,cls:"dis",style:"normal 6px tahoma, arial, verdana, sans-serif",
value:a,listeners:{scope:this,change:function(){this.validate()}}}),a=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.editor]}),this.okButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,listeners:{scope:this,click:function(){var a=Ext.getCmp(this.id+"genelist_preview").getValue().split("\n");this.onOk.notify(a);b.panel.close()}}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),layout:"fit",resizable:!1,collapsible:!0,
constrain:!0,closable:!0,items:[a],buttons:[this.okButton,{text:"Cancel",handler:function(){b.panel.close()}}],listeners:{scope:this,destroy:function(){delete this.panel}}}));this.panel.show()};InputListWidget.prototype.validate=function(){""!=this.editor.getValue()?this.okButton.enable():this.okButton.disable()};
function ChartWidget(a){this.id="ChartWidget_"+Math.round(1E7*Math.random());this.title=null;this.width=750;this.height=300;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height}ChartWidget.prototype.getStore=function(){return this.store};
ChartWidget.prototype.getChart=function(a){Ext.define("ChromosomeChart",{extend:"Ext.data.Model",fields:a});this.store=Ext.create("Ext.data.Store",{model:"ChromosomeChart",autoLoad:!1});return Ext.create("Ext.chart.Chart",{animate:!0,shadow:!0,store:this.store,width:this.width,height:this.height,axes:[{position:"left",fields:[a[0]],title:a[0],grid:!0,type:"Numeric",minimum:0},{title:a[1],type:"category",position:"bottom",fields:[a[1]],label:{rotate:{degrees:270}}}],series:[{type:"column",axis:"left",
gutter:10,yField:a[0],xField:a[1],style:{fill:"#38B8BF"}}]})};
function GenomeMaps(a,b){var c=this;this.id="GenomeMaps"+Math.round(1E4*Math.random());this.suiteId=9;this.title="Genome Maps";this.description="RC";this.wum=!0;this.version="2.1.3";this.args=b;this.width=$(window).width();this.height=$(window).height();this.targetId=document.body;null!=a&&(this.targetId=a);if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.wum))this.wum=b.wum;var d=$.url(),e=d.param("CELLBASE_HOST");null!=e&&(CELLBASE_HOST=e);e=d.param("location");
if(null!=e)var f=e.split(":")[1],g=e.split(":")[0];e=DEFAULT_SPECIES;d=d.param("species");if(null!=d)for(var j=0;j<AVAILABLE_SPECIES.length;j++)if(AVAILABLE_SPECIES[j].species==d){e=AVAILABLE_SPECIES[j];break}console.log(e);this.headerWidget=new HeaderWidget({appname:this.title,description:this.description,version:this.version,suiteId:this.suiteId});this.genomeViewer=new GenomeViewer(this.id+"gvDiv",e,{position:f,chromosome:g,toolbar:this.getMenuBar(),version:this.version,availableSpecies:AVAILABLE_SPECIES,
height:this.height-this.headerWidget.height,width:this.width});this.headerWidget.onLogin.addEventListener(function(){Ext.example.msg("Welcome","You logged in")});this.headerWidget.onLogout.addEventListener(function(){Ext.example.msg("Good bye","You logged out")});this.genomeViewer.onSpeciesChange.addEventListener(function(){c._setTracks();c.setTracksMenu();c.headerWidget.setDescription(c.genomeViewer.speciesName)});$(window).smartresize(function(){c.setSize($(window).width(),$(window).height())});
$(window).unload(function(){$.cookie("gm_settings",JSON.stringify({species:{name:c.genomeViewer.speciesName,species:c.genomeViewer.species,chromosome:c.genomeViewer.chromosome,position:c.genomeViewer.position}}),{expires:365})})}
GenomeMaps.prototype.draw=function(){var a=this;if(null==this._panel){var b=Ext.create("Ext.container.Container",{id:this.id+"gvContainer",html:'<div id="'+this.id+'gvDiv"></div>'});this._panel=Ext.create("Ext.panel.Panel",{id:this.id+"_panel",renderTo:this.targetId,border:!1,width:this.width,height:this.height,items:[this.headerWidget.getPanel(),b]})}this.headerWidget.setDescription(this.genomeViewer.speciesName);$("#"+this.headerWidget.id+"appTextItem").qtip({content:'<span class="info">'+this.version+
"</span>",position:{my:"bottom center",at:"top center",adjust:{y:0,x:-25}}});this.genomeViewer.afterRender.addEventListener(function(){Ext.getCmp(a.genomeViewer.id+"versionLabel").setText('<span class="info">Genome Maps v'+a.version+"</span>");a._setTracks();a._setRegionTracks();a.genomeViewer.onSvgRemoveTrack.addEventListener(function(b,d){Ext.getCmp(a.id+d+"menu").setChecked(!1)})});this.setTracksMenu();this.setPluginsMenu();this.genomeViewer.draw()};
GenomeMaps.prototype.setSize=function(a,b){500>a&&(a=500);2400<a&&(a=2400);this.width=a;this.height=b;this._panel.setSize(a,b);this.genomeViewer.setSize(a,b-this.headerWidget.height);this.headerWidget.setWidth(a)};
GenomeMaps.prototype._setRegionTracks=function(){var a=new TrackData("gene",{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.trackSvgLayout2.addTrack(a,{id:"gene",type:"gene",featuresRender:"MultiFeatureRender",histogramZoom:10,labelZoom:20,height:150,visibleRange:{start:0,end:100},titleVisibility:"hidden",featureTypes:FEATURE_TYPES})};
GenomeMaps.prototype._setTracks=function(){for(var a=this.genomeViewer.species,b=TRACKS[SPECIES_TRACKS_GROUP[a]],c=0,d=b.length;c<d;c++)for(var e=0,f=b[c].tracks.length;e<f;e++){var g=b[c].tracks[e].id,j=b[c].tracks[e].checked,h=b[c].tracks[e].disabled;j&&!h&&!this.genomeViewer.checkRenderedTrack(g)?this.addTrack(g):(!j||h)&&this.genomeViewer.checkRenderedTrack(g)&&this.removeTrack(g)}b=DAS_TRACKS;c=0;for(d=b.length;c<d;c++)if(b[c].species==a){e=0;for(f=b[c].categories.length;e<f;e++){g=0;for(h=b[c].categories[e].sources.length;g<
h;g++)a=b[c].categories[e].sources[g].name,d=b[c].categories[e].sources[g].url,(j=b[c].categories[e].sources[g].checked)&&this.addDASTrack(a,d)}break}};GenomeMaps.prototype.removeTrack=function(a){this.genomeViewer.removeTrack(a)};
GenomeMaps.prototype.addTrack=function(a){console.log(a);switch(a){case "Gene/Transcript":var b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"GeneTranscriptRender",histogramZoom:20,transcriptZoom:50,height:24,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Sequence":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",
subCategory:"region",resource:"sequence",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E3}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"SequenceRender",height:50,visibleRange:{start:100,end:100}});break;case "CpG islands":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"cpg_island",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",
histogramZoom:10,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "SNP":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",histogramZoom:70,labelZoom:80,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Mutation":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",
subCategory:"region",resource:"mutation",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Structural variation (<20Kb)":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"structural_variation",species:this.genomeViewer.species,params:{min_length:1,max_length:2E4},
featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",histogramZoom:40,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Structural variation (>20Kb)":b=new TrackData(track>Id,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"structural_variation",species:this.genomeViewer.species,params:{min_length:2E4,max_length:3E8},featureCache:{gzip:!0,chunkSize:5E6}})});this.genomeViewer.addTrack(b,
{id:a,featuresRender:"MultiFeatureRender",histogramZoom:40,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "miRNA targets":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"mirna_target",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});
break;case "TFBS":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"tfbs",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Conserved regions":b=new TrackData(a,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"conserved_region",
species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})}),this.genomeViewer.addTrack(b,{id:a,featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})}};
GenomeMaps.prototype.addDASTrack=function(a,b){var c=new TrackData("das",{adapter:new DasAdapter({url:b,species:this.genomeViewer.species,featureCache:{gzip:!1,chunkSize:1E4}})});this.genomeViewer.addTrack(c,{id:a,type:"das",featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},settings:{height:10}})};
GenomeMaps.prototype.getMenuBar=function(){Ext.create("Ext.menu.Menu",{items:[]});var a=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[{text:"Zoom",menu:this.getZoomMenu()},"-",{text:"Gene legend",handler:function(){(new LegendWidget({title:"Gene legend"})).draw(GENE_BIOTYPE_COLORS)}}]}),b=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[{text:"Feature",menu:this.getFeatureSearchMenu()},{text:"Functional",menu:this.getFunctionalSearchMenu()},{text:"Regulatory",menu:this.getRegulatorySearchMenu()}]});
return Ext.create("Ext.toolbar.Toolbar",{cls:"bio-menubar",height:27,padding:"0 0 0 10",items:[{text:"View",menu:a},{text:"Search",menu:b},{id:this.id+"tracksMenu",text:"Tracks",menu:[]},{text:"Plugins",menu:this.getPluginsMenu()}]})};
GenomeMaps.prototype.getZoomMenu=function(){for(var a=this,b=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[]}),c=0;100>=c;c+=10)b.add({text:c+"%",group:"zoom",checked:!1,handler:function(){Ext.getCmp(a.genomeViewer.id+"zoomSlider").setValue(this.text.replace("%",""))}});return b};
GenomeMaps.prototype.getLabelMenu=function(){var a=this;return Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[{text:"None",handler:function(){a.genomeViewer.genomeWidgetProperties.setLabelHeight(0);a.genomeViewer.refreshMasterGenomeViewer()}},{text:"Small",handler:function(){a.genomeViewer.genomeWidgetProperties.setLabelHeight(8);a.genomeViewer.refreshMasterGenomeViewer()}},{text:"Medium",handler:function(){a.genomeViewer.genomeWidgetProperties.setLabelHeight(10);a.genomeViewer.refreshMasterGenomeViewer()}},
{text:"Large",handler:function(){a.genomeViewer.genomeWidgetProperties.setLabelHeight(12);a.genomeViewer.refreshMasterGenomeViewer()}},{text:"x-Large",handler:function(){a.genomeViewer.genomeWidgetProperties.setLabelHeight(14);a.genomeViewer.refreshMasterGenomeViewer()}}]})};
GenomeMaps.prototype.getFeatureSearchMenu=function(){var a=this;return Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[{text:"Genes",handler:function(){var b=new InputListWidget({title:"Gene List",viewer:a.genomeViewer});b.onOk.addEventListener(function(b,d){a.genomeViewer.openGeneListWidget(d)});b.draw()}},{text:"SNP",handler:function(){var b=new InputListWidget({title:"SNP List",viewer:a.genomeViewer});b.onOk.addEventListener(function(b,d){a.genomeViewer.openSNPListWidget(d)});
b.draw()}}]})};GenomeMaps.prototype.getFunctionalSearchMenu=function(){var a=this;return Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[{text:"GO",handler:function(){var b=new InputListWidget({title:"Gene Ontology",viewer:a.genomeViewer});b.onOk.addEventListener(function(b,d){a.genomeViewer.openGOListWidget(d)});b.draw()}},{text:"Reactome",disabled:!0,handler:function(){alert("Not yet implemented")}}]})};
GenomeMaps.prototype.getRegulatorySearchMenu=function(){return Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",floating:!0,items:[{text:"miRNA Target",disabled:!0,handler:function(){alert("Not yet implemented")}},{text:"TFBS",disabled:!0,handler:function(){alert("Not yet implemented")}}]})};
GenomeMaps.prototype.getTracksMenuOLD=function(){var a=this;null!=this.tracksMenu&&this.tracksMenu.destroy();return this.tracksMenu=Ext.create("Ext.menu.Menu",{id:this.id+"tracksMenuInit",margin:"0 0 10 0",floating:!0,items:[{id:this.id+"tracksMenuCore",text:"Core",menu:[{id:"Gene/Transcript",text:"Gene/Transcript",checked:!0,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Cytoband",text:"Cytoband",
checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Sequence",text:"Sequence",checked:!1,disabled:!0,handler:function(){}},{id:"CpG islands",text:"CpG islands",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}}]},{id:this.id+"tracksMenuVariation",text:"Variation",menu:[{id:"SNP",text:"SNP",
checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Mutation",text:"Mutation",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Structural variation",text:"Structural variation",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;
a.genomeViewer.refreshMasterGenomeViewer()}}]},{id:this.id+"tracksMenuRegulatory",text:"Regulatory",menu:[{id:"miRNA targets",text:"miRNA targets",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"TFBS",text:"TFBS",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Histone",text:"Histone",
checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Polymerase",text:"Polymerase",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Open Chromatin",text:"Open Chromatin",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;
a.genomeViewer.refreshMasterGenomeViewer()}},{id:"Conserved regions",text:"Conserved regions",checked:!1,disabled:!0,handler:function(){a.genomeViewer.genomeWidgetProperties.tracks[this.text]=this.checked;a.genomeViewer.refreshMasterGenomeViewer()}}]},"-",{id:this.id+"tracksMenuDAS",text:"DAS",menu:this.getDASMenu()}]})};GenomeMaps.prototype.setTracksMenu=function(){Ext.getCmp(this.id+"tracksMenu").menu=this.getTracksMenu()};
GenomeMaps.prototype.getTracksMenu=function(){var a=this;null!=this._TracksMenu&&this._TracksMenu.destroy();for(var b=TRACKS[SPECIES_TRACKS_GROUP[this.genomeViewer.species]],c=[],d=0,e=b.length;d<e;d++){for(var f=[],g=0,j=b[d].tracks.length;g<j;g++)f.push({id:this.id+b[d].tracks[g].id+"menu",text:b[d].tracks[g].id,disabled:b[d].tracks[g].disabled,checked:b[d].tracks[g].checked,handler:function(){this.checked?a.addTrack(this.text):a.removeTrack(this.text)}});c.push({text:b[d].category,menu:f})}c.push("-");
c.push({id:this.id+"tracksMenuDAS",text:"DAS",menu:this.getDASMenu()});return this._TracksMenu=Ext.create("Ext.menu.Menu",{id:this.id_panel+"_TracksMenu",margin:"0 0 10 0",floating:!0,items:c})};
GenomeMaps.prototype.getDASMenu=function(){for(var a=this,b=DAS_TRACKS,c=this.genomeViewer.species,d=[],e=0,f=b.length;e<f;e++)if(b[e].species==c){c=0;for(f=b[e].categories.length;c<f;c++){for(var g=[],j=0,h=b[e].categories[c].sources.length;j<h;j++)g.push({id:this.id+b[e].categories[c].sources[j].name+"menu",text:b[e].categories[c].sources[j].name,sourceName:b[e].categories[c].sources[j].name,sourceUrl:b[e].categories[c].sources[j].url,checked:b[e].categories[c].sources[j].checked,handler:function(){this.checked?
a.addDASTrack(this.sourceName,this.sourceUrl):a.removeTrack(this.sourceName)}});d.push({text:b[e].categories[c].name,menu:g})}break}d.push("-",{text:"Add custom...",handler:function(){var b=new UrlWidget({title:"Add a DAS track"});b.onAdd.addEventListener(function(b,c){a.addDASTrack(c.name,c.url);a.setCustomDASMenu(c.name)});b.draw()},menu:{id:this.id+"_customDASMenu",margin:"0 0 10 0",floating:!0,items:[]}});return this._DASMenu=Ext.create("Ext.menu.Menu",{id:this.id_panel+"_DASMenu",margin:"0 0 10 0",
floating:!0,items:d})};GenomeMaps.prototype.setCustomDASMenu=function(a){var b=this;Ext.getCmp(this.id+"_customDASMenu").add({text:a,checked:!0,handler:function(){this.checked?b.genomeViewer.showTrack(this.text):b.genomeViewer.hideTrack(this.text)}})};GenomeMaps.prototype.getPluginsMenu=function(){null==this._pluginsMenu&&(this._pluginsMenu=Ext.create("Ext.menu.Menu",{id:this.id+"_pluginsMenu",margin:"0 0 10 0",floating:!0,items:[]}));return this._pluginsMenu};
GenomeMaps.prototype.setPluginsMenu=function(){var a=this,b=GENOME_MAPS_AVAILABLE_PLUGINS,c=this.getPluginsMenu();c.removeAll();c.add([{id:this.id+"tracksMenuPlugins",text:"Load",menu:[{id:this.id+"tracksMenuGFF2",text:"GFF2",handler:function(){var b=new GFFFileWidget({version:2,viewer:a.genomeViewer});b.draw();a.wum&&(a.headerWidget.onLogin.addEventListener(function(){b.sessionInitiated()}),a.headerWidget.onLogout.addEventListener(function(){b.sessionFinished()}));b.onOk.addEventListener(function(b,
c){var d=new TrackData(c.fileName,{adapter:c.adapter});a.genomeViewer.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}},{id:this.id+"tracksMenuGFF3",text:"GFF3",handler:function(){var b=new GFFFileWidget({version:3,viewer:a.genomeViewer});b.draw();a.wum&&(a.headerWidget.onLogin.addEventListener(function(){b.sessionInitiated()}),a.headerWidget.onLogout.addEventListener(function(){b.sessionFinished()}));b.onOk.addEventListener(function(b,
c){var d=new TrackData(c.fileName,{adapter:c.adapter});a.genomeViewer.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}},{id:this.id+"tracksMenuGTF",text:"GTF",handler:function(){var b=new GTFFileWidget({viewer:a.genomeViewer});b.draw();a.wum&&(a.headerWidget.onLogin.addEventListener(function(){b.sessionInitiated()}),a.headerWidget.onLogout.addEventListener(function(){b.sessionFinished()}));b.onOk.addEventListener(function(b,
c){var d=new TrackData(c.fileName,{adapter:c.adapter});a.genomeViewer.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}},{id:this.id+"tracksMenuBED",text:"BED",handler:function(){var b=new BEDFileWidget({viewer:a.genomeViewer});b.draw();a.wum&&(a.headerWidget.onLogin.addEventListener(function(){b.sessionInitiated()}),a.headerWidget.onLogout.addEventListener(function(){b.sessionFinished()}));b.onOk.addEventListener(function(b,
c){var d=new TrackData(c.fileName,{adapter:c.adapter});a.genomeViewer.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}},{id:this.id+"tracksMenuVCF",text:"VCF4",handler:function(){var b=new VCFFileWidget({viewer:a.genomeViewer});b.draw();a.wum&&(a.headerWidget.onLogin.addEventListener(function(){b.sessionInitiated()}),a.headerWidget.onLogout.addEventListener(function(){b.sessionFinished()}));b.onOk.addEventListener(function(b,
c){console.log(c.fileName);var d=new TrackData(c.fileName,{adapter:c.adapter});a.genomeViewer.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}}]}]);for(var d=0,e=b.length;d<e;d++)if(""==b[d].category)for(var f=0,g=b[d].plugins.length;f<g;f++)c.add({text:b[d].plugins[f].name,pluginName:b[d].plugins[f].name,handler:function(){GENOME_MAPS_REGISTERED_PLUGINS[this.pluginName].setViewer(a.genomeViewer);GENOME_MAPS_REGISTERED_PLUGINS[this.pluginName].draw()}});
else{for(var j=[],f=0,g=b[d].plugins.length;f<g;f++)j.push({text:b[d].plugins[f].name,pluginName:b[d].plugins[f].name,handler:function(){GENOME_MAPS_REGISTERED_PLUGINS[this.pluginName].setViewer(a.genomeViewer);GENOME_MAPS_REGISTERED_PLUGINS[this.pluginName].draw()}});c.add({text:b[d].category,menu:j})}};
